{"version":3,"mappings":"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","names":["ReferenceSwiper","React","__vitePreload","CATEGORIES","Reference","references","docContents","setDocContents","useState","loading","setLoading","activeCategory","setActiveCategory","lightboxImg","setLightboxImg","useEffect","fetchCount","ref","res","text","prev","getAssetUrl","url","handleDownload","filename","blob","objectUrl","link","error","handleOpenLink","SkeletonCard","jsxs","jsx","renderReferenceCard","reference","Image","e","getSlidesPerView","filteredReferences","FaBookOpen","cat","FiChevronDown","_","i","Suspense","SiriButton","containerId","container","ctx","rect","dpr","size","dotColor","x","y","grad","offsetX","offsetY","angle","gradX","gradY","outerGradient","breath","ripple","pulseRadius","volumeBoost","rings","baseRadius","dist","p","percent","color","shown","min","sec","timeStr","flash","bars","baseR","amp","x1","y1","x2","y2","isMobile","listening","level","seconds","target","SiriCallButton","isListening","volumeLevel","buttonRef","useRef","ReferenceService","response","content","normalizedContent","matches","item","keyword","m","key","referenceService","Interface2","isActive","transcripts","callDetails","callDuration","contextEndCall","isMuted","toggleMute","setCurrentInterface","micLevel","modelOutput","language","useAssistant","visibleChars","setVisibleChars","animationFrames","conversationTurns","setConversationTurns","setReferences","localDuration","setLocalDuration","conversationRef","showRealtimeConversation","setShowRealtimeConversation","cleanupAnimations","frameId","loadAllReferences","allRefs","sortedTranscripts","a","b","turns","currentTurn","message","turn","currentChar","animate","handleCancel","useCallback","finalDuration","handleNext","t","formatDuration","minutes","secs","timer","turnIdx","msg","idx"],"ignoreList":[],"sources":["../../../client/src/components/Reference.tsx","../../../client/src/components/SiriButton.ts","../../../client/src/components/SiriCallButton.tsx","../../../client/src/services/ReferenceService.ts","../../../client/src/components/Interface2.tsx"],"sourcesContent":["/// <reference types=\"react\" />\nimport React, { useState, useEffect, Suspense } from 'react';\nimport type { ReferenceItem } from '@/services/ReferenceService';\nimport { Swiper, SwiperSlide } from 'swiper/react';\nimport { Navigation, Pagination, A11y } from 'swiper/modules';\nimport 'swiper/css';\nimport 'swiper/css/navigation';\nimport 'swiper/css/pagination';\nimport { ChevronDown } from 'lucide-react';\nimport { FaBookOpen } from 'react-icons/fa';\nimport { FiChevronDown } from 'react-icons/fi';\nimport { Image } from './ui/Image';\nconst ReferenceSwiper = React.lazy(() => import('./ReferenceSwiper'));\n\nconst CATEGORIES = [\n  'Landmark',\n  'Hotel Amenities',\n  'Local Cuisine',\n  'Area Map',\n  'Activity and Experiences',\n  'Tours',\n  'Transportation',\n  'Dining'\n];\n\ninterface ReferenceProps {\n  references: ReferenceItem[];\n}\n\ninterface DocContents {\n  [key: string]: string;\n}\n\nconst Reference = ({ references }: ReferenceProps): JSX.Element => {\n  const [docContents, setDocContents] = useState<DocContents>({});\n  const [loading, setLoading] = useState(true);\n  const [activeCategory, setActiveCategory] = useState(CATEGORIES[0]);\n  const [lightboxImg, setLightboxImg] = useState<string | null>(null);\n\n  useEffect(() => {\n    setLoading(true);\n    let fetchCount = 0;\n    if (references.length === 0) {\n      setLoading(false);\n      return;\n    }\n    references.forEach((ref: ReferenceItem) => {\n      if ((ref as any).type === 'document' && ref.url.endsWith('.txt') && !docContents[ref.url]) {\n        fetch(ref.url)\n          .then(res => res.text())\n          .then(text => {\n            setDocContents((prev: DocContents) => ({ ...prev, [ref.url]: text }));\n            fetchCount++;\n            if (fetchCount === references.length) setLoading(false);\n          })\n          .catch(() => {\n            fetchCount++;\n            if (fetchCount === references.length) setLoading(false);\n          });\n      } else {\n        fetchCount++;\n        if (fetchCount === references.length) setLoading(false);\n      }\n    });\n    if (references.every(ref => (ref as any).type !== 'document' || !ref.url.endsWith('.txt'))) {\n      setLoading(false);\n    }\n  }, [references]);\n\n  const getAssetUrl = (url: string) => {\n    if (/^https?:\\/\\//.test(url)) return url;\n    const path = url.replace(/^\\//, '');\n    return `${import.meta.env.BASE_URL}${path}`;\n  };\n\n  const handleDownload = async (url: string, filename: string) => {\n    try {\n      const response = await fetch(getAssetUrl(url));\n      const blob = await response.blob();\n      const objectUrl = URL.createObjectURL(blob);\n      const link = document.createElement('a');\n      link.href = objectUrl;\n      link.download = filename;\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n      URL.revokeObjectURL(objectUrl);\n    } catch (error) {\n      console.error('Error downloading file:', error);\n    }\n  };\n\n  const handleOpenLink = (url: string) => {\n    window.open(getAssetUrl(url), '_blank');\n  };\n\n  // Skeleton loading card\n  const SkeletonCard = () => (\n    <div className=\"animate-pulse bg-white/80 rounded-xl shadow-md h-[180px] flex flex-col p-4 gap-2\">\n      <div className=\"bg-gray-200 rounded w-full h-2/3 mb-2\"></div>\n      <div className=\"bg-gray-200 rounded w-2/3 h-4 mb-1\"></div>\n      <div className=\"bg-gray-100 rounded w-1/2 h-3\"></div>\n    </div>\n  );\n\n  // Card rendering\n  const renderReferenceCard = (reference: ReferenceItem) => {\n    return (\n      <div\n        className=\"group bg-white/90 rounded-xl shadow-md h-[180px] flex flex-col justify-between cursor-pointer transition-transform duration-200 hover:scale-[1.03] active:scale-95 border border-white/40 backdrop-blur-md\"\n        style={{ minWidth: 220, maxWidth: 260 }}\n        onClick={() => (reference as any).type === 'link' ? handleOpenLink(reference.url) : undefined}\n      >\n        {/* Thumbnail */}\n        <div className=\"flex-1 flex items-center justify-center overflow-hidden rounded-t-xl\" style={{ height: '60%' }}>\n          {(reference as any).type === 'image' && (\n            <picture>\n              <source srcSet={getAssetUrl(reference.url).replace(/\\.(jpe?g)$/i, '.webp')} type=\"image/webp\" />\n              <Image\n                src={getAssetUrl(reference.url)}\n                alt={reference.title}\n                className=\"object-cover w-full h-full rounded-t-xl hover:opacity-80 transition cursor-zoom-in\"\n                width={240}\n                height={108}\n                loading=\"lazy\"\n                onClick={e => { e.stopPropagation(); setLightboxImg(getAssetUrl(reference.url)); }}\n                tabIndex={0}\n                onKeyDown={e => { if (e.key === 'Enter' || e.key === ' ') { setLightboxImg(getAssetUrl(reference.url)); } }}\n              />\n            </picture>\n          )}\n          {(reference as any).type === 'document' && reference.url.endsWith('.pdf') && (\n            <span className=\"material-icons text-5xl text-blue-700/80\">picture_as_pdf</span>\n          )}\n          {(reference as any).type === 'document' && reference.url.endsWith('.txt') && (\n            <span className=\"material-icons text-5xl text-green-700/80\">description</span>\n          )}\n          {(reference as any).type === 'link' && (\n            <span className=\"material-icons text-5xl text-yellow-700/80\">link</span>\n          )}\n        </div>\n        {/* Text content */}\n        <div className=\"flex flex-col gap-1 px-3 py-2\">\n          <div className=\"flex items-center gap-2\">\n            <span className=\"text-base font-medium text-gray-900 truncate\">{reference.title}</span>\n            {(reference as any).type === 'document' && (\n              <button\n                onClick={e => { e.stopPropagation(); handleDownload(reference.url, reference.title); }}\n                className=\"ml-auto p-1 rounded-full hover:bg-yellow-100 text-yellow-700 transition-colors\"\n              >\n                <span className=\"material-icons text-base\">download</span>\n              </button>\n            )}\n            {(reference as any).type === 'link' && (\n              <span className=\"material-icons text-xs text-gray-400 ml-1\">open_in_new</span>\n            )}\n          </div>\n          {reference.description && (\n            <span className=\"text-xs text-gray-500 truncate\">{reference.description}</span>\n          )}\n          {/* Inline preview for .txt */}\n          {reference.url.endsWith('.txt') && docContents[reference.url] && (\n            <pre className=\"mt-1 max-h-12 overflow-auto whitespace-pre-wrap text-xs text-gray-700 bg-gray-50 rounded p-1\">{docContents[reference.url].slice(0, 120)}...</pre>\n          )}\n        </div>\n      </div>\n    );\n  };\n\n  // Responsive breakpoints\n  const getSlidesPerView = () => {\n    if (window.innerWidth < 640) return 'auto'; // mobile: cuốn auto\n    if (window.innerWidth < 1024) return 2;\n    if (window.innerWidth < 1280) return 3;\n    return 4;\n  };\n\n  // Lọc reference theo category, không phân biệt hoa thường và loại bỏ dấu cách thừa\n  const filteredReferences = references.filter(ref => (ref as any).category && (ref as any).category.trim().toLowerCase() === activeCategory.trim().toLowerCase());\n\n  // Main render\n  return (\n    <div className=\"w-full max-w-5xl mx-auto mt-2 mb-2 px-2 py-3 rounded-2xl\" style={{ background: 'rgba(85,154,154,0.85)', minHeight: 260 }}>\n      {/* Lightbox modal */}\n      {lightboxImg && (\n        <div\n          className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm\"\n          onClick={() => setLightboxImg(null)}\n        >\n          <div className=\"relative max-w-3xl w-full flex flex-col items-center\">\n            <button\n              className=\"absolute top-2 right-2 bg-white/80 hover:bg-white text-gray-800 rounded-full p-2 shadow-lg z-10\"\n              onClick={e => { e.stopPropagation(); setLightboxImg(null); }}\n            >\n              <span className=\"material-icons text-2xl\">close</span>\n            </button>\n            <picture>\n              <source srcSet={lightboxImg.replace(/\\.(jpe?g)$/i, '.webp')} type=\"image/webp\" />\n              <Image\n                src={lightboxImg}\n                alt=\"Phóng to ảnh reference\"\n                className=\"max-w-full max-h-full object-contain\"\n                width={800}\n                height={600}\n                loading=\"lazy\"\n              />\n            </picture>\n          </div>\n        </div>\n      )}\n      \n      {/* Dropdown category - phong cách mới giống Interface1 */}\n      <div className=\"flex items-center mb-4 px-2\">\n        <div className=\"flex items-center px-3 py-2 sm:py-1.5 gap-2 transition-all duration-300 mx-auto sm:mx-0\"\n          style={{\n            background: 'linear-gradient(135deg, #4e5ab7 0%, #3f51b5 100%)',\n            boxShadow: '0px 4px 8px rgba(0, 0, 0, 0.15)', \n            borderRadius: '8px',\n            minWidth: '150px',\n            maxWidth: '95%',\n            width: 'auto',\n            border: '1px solid rgba(255, 255, 255, 0.1)'\n          }}>\n          <FaBookOpen className=\"text-[#F9BF3B] text-xl mr-1.5\"\n            style={{ filter: 'drop-shadow(0px 2px 3px rgba(0, 0, 0, 0.2))' }}\n          />\n          <label className=\"mr-2 font-semibold font-sans text-white whitespace-nowrap text-sm sm:text-base\">Category:</label>\n          <div className=\"relative flex-1\">\n            <select\n              value={activeCategory}\n              onChange={e => setActiveCategory(e.target.value)}\n              className=\"appearance-none w-full pl-6 sm:pl-8 pr-6 py-1 sm:py-1.5 font-sans bg-transparent focus:outline-none transition-all duration-200\"\n              style={{\n                fontWeight: 600,\n                color: '#fff',\n                textShadow: '0px 1px 2px rgba(0, 0, 0, 0.2)',\n                borderRadius: '8px'\n              }}\n            >\n              {CATEGORIES.map(cat => (\n                <option key={cat} value={cat} className=\"bg-blue-800 text-white\">{cat}</option>\n              ))}\n            </select>\n            <FiChevronDown className=\"absolute right-2 top-1/2 -translate-y-1/2 text-[#F9BF3B] pointer-events-none text-lg\" />\n          </div>\n        </div>\n      </div>\n\n      {/* Loading state */}\n      {loading ? (\n        <div className=\"flex gap-4 overflow-x-auto pb-2\">\n          {[...Array(3)].map((_, i) => <SkeletonCard key={i} />)}\n        </div>\n      ) : filteredReferences.length === 0 ? (\n        <div className=\"flex items-center justify-center h-[120px] text-white/80 text-base font-medium\">No references available</div>\n      ) : (\n        <Suspense fallback={<div className=\"flex items-center justify-center h-[120px] text-white/80 text-base font-medium\">Loading slider...</div>}>\n          <ReferenceSwiper\n            filteredReferences={filteredReferences}\n            renderReferenceCard={renderReferenceCard}\n            getSlidesPerView={getSlidesPerView}\n          />\n        </Suspense>\n      )}\n    </div>\n  );\n};\n\nexport default Reference;","export class SiriButton {\n  private canvas: HTMLCanvasElement;\n  private ctx: CanvasRenderingContext2D;\n  private width: number;\n  private height: number;\n  private centerX: number;\n  private centerY: number;\n  private radius: number;\n  private ripples: Array<{\n    radius: number;\n    alpha: number;\n    speed: number;\n  }>;\n  private isListening: boolean;\n  private pulsePhase: number;\n  private volumeLevel: number;\n  private animationFrameId: number;\n  private gradientRotation: number = 0;\n  private isHovered: boolean = false;\n  private isActive: boolean = false;\n  private waveformPhase: number = 0;\n  private particles: Array<{x: number, y: number, alpha: number, size: number, speed: number}> = [];\n  private mouseX: number = 0;\n  private mouseY: number = 0;\n  private isDarkMode: boolean = false;\n  private elapsedTime: number = 0;\n  private displayedTime: number = 0;\n  private timeTarget: number = 60;\n  private idleFrame: number = 0;\n  private lastActiveTime: number = Date.now();\n  private idleFlash: number = 0;\n\n  constructor(containerId: string) {\n    // Create canvas element\n    this.canvas = document.createElement('canvas');\n    const container = document.getElementById(containerId);\n    if (!container) throw new Error('Container element not found');\n    \n    container.appendChild(this.canvas);\n    \n    // Get context\n    const ctx = this.canvas.getContext('2d');\n    if (!ctx) throw new Error('Could not get canvas context');\n    this.ctx = ctx;\n    \n    // Initialize properties\n    this.width = 200;\n    this.height = 200;\n    this.centerX = this.width / 2;\n    this.centerY = this.height / 2;\n    this.radius = 40;\n    this.ripples = [];\n    this.isListening = false;\n    this.pulsePhase = 0;\n    this.volumeLevel = 0;\n    this.animationFrameId = 0;\n\n    // Set canvas size\n    this.resize();\n\n    // Start animation loop\n    this.animate();\n\n    // Add resize listener\n    window.addEventListener('resize', this.resize.bind(this));\n\n    // Add mouse event listeners for hover/active\n    if (container) {\n      container.addEventListener('mouseenter', () => { this.isHovered = true; this.lastActiveTime = Date.now(); });\n      container.addEventListener('mouseleave', () => { this.isHovered = false; this.isActive = false; });\n      container.addEventListener('mousedown', () => { this.isActive = true; this.lastActiveTime = Date.now(); });\n      container.addEventListener('mouseup', () => { this.isActive = false; });\n      container.addEventListener('mousemove', (e) => {\n        const rect = container.getBoundingClientRect();\n        this.mouseX = e.clientX - rect.left;\n        this.mouseY = e.clientY - rect.top;\n        this.lastActiveTime = Date.now();\n      });\n    }\n\n    // Detect dark mode\n    this.isDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;\n    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {\n      this.isDarkMode = e.matches;\n    });\n  }\n\n  private resize() {\n    // Get container size\n    const container = this.canvas.parentElement;\n    if (!container) return;\n\n    // Set canvas size to be a perfect square (use min of width/height)\n    const dpr = window.devicePixelRatio || 1;\n    const size = Math.min(container.clientWidth, container.clientHeight);\n    this.width = this.height = size;\n    this.canvas.width = this.canvas.height = size * dpr;\n    this.canvas.style.width = this.canvas.style.height = `${size}px`;\n    // Ensure canvas is perfectly round\n    this.canvas.style.borderRadius = '50%';\n    this.canvas.style.overflow = 'hidden';\n    // Scale context\n    this.ctx.setTransform(1, 0, 0, 1, 0, 0); // Reset transform\n    this.ctx.scale(dpr, dpr);\n    // Update center coordinates\n    this.centerX = this.width / 2;\n    this.centerY = this.height / 2;\n  }\n\n  private drawTexturePattern() {\n    // Boutique subtle pattern: draw small gold dots in a grid\n    const dotColor = 'rgba(232,181,84,0.18)';\n    const step = 14;\n    for (let x = -this.radius; x < this.radius; x += step) {\n      for (let y = -this.radius; y < this.radius; y += step) {\n        if (x * x + y * y < this.radius * this.radius * 0.85) {\n          this.ctx.save();\n          this.ctx.beginPath();\n          this.ctx.arc(this.centerX + x, this.centerY + y, 1.2, 0, Math.PI * 2);\n          this.ctx.fillStyle = dotColor;\n          this.ctx.fill();\n          this.ctx.restore();\n        }\n      }\n    }\n  }\n\n  private drawLightBeam() {\n    if (!(this.isHovered || this.isActive)) return;\n    this.ctx.save();\n    const grad = this.ctx.createLinearGradient(this.centerX, this.centerY - this.radius * 1.3, this.centerX, this.centerY + this.radius * 0.5);\n    grad.addColorStop(0, 'rgba(255,255,255,0.22)');\n    grad.addColorStop(0.5, 'rgba(255,255,255,0.08)');\n    grad.addColorStop(1, 'rgba(255,255,255,0)');\n    this.ctx.beginPath();\n    this.ctx.ellipse(this.centerX, this.centerY - this.radius * 0.7, this.radius * 0.7, this.radius * 0.22, 0, 0, 2 * Math.PI);\n    this.ctx.fillStyle = grad;\n    this.ctx.filter = 'blur(2.5px)';\n    this.ctx.fill();\n    this.ctx.filter = 'none';\n    this.ctx.restore();\n  }\n\n  private drawBaseCircle() {\n    // Parallax: offset center by mouse position (subtle)\n    let offsetX = 0, offsetY = 0;\n    if (this.isHovered) {\n      offsetX = (this.mouseX - this.centerX) * 0.07;\n      offsetY = (this.mouseY - this.centerY) * 0.07;\n    }\n    // Gradient rotation effect\n    this.gradientRotation += 0.0025;\n    const angle = this.gradientRotation % (2 * Math.PI);\n    const gradX = this.centerX + Math.cos(angle) * this.radius * 1.2;\n    const gradY = this.centerY + Math.sin(angle) * this.radius * 1.2;\n    const outerGradient = this.ctx.createLinearGradient(\n      this.centerX - this.radius * 1.2 + offsetX, this.centerY - this.radius * 1.2 + offsetY,\n      gradX + offsetX, gradY + offsetY\n    );\n    outerGradient.addColorStop(0, this.isDarkMode ? '#559A9A' : '#5DB6B9');\n    outerGradient.addColorStop(1, this.isDarkMode ? '#559A9A' : '#5DB6B9');\n    this.ctx.save();\n    this.ctx.globalAlpha = 0.85;\n    this.ctx.beginPath();\n    this.ctx.arc(this.centerX + offsetX, this.centerY + offsetY, this.radius * 1.25, 0, Math.PI * 2);\n    this.ctx.strokeStyle = outerGradient;\n    this.ctx.lineWidth = 12;\n    this.ctx.shadowColor = this.isHovered ? '#559A9A' : '#559A9A';\n    this.ctx.shadowBlur = this.isHovered ? 32 : 16;\n    this.ctx.stroke();\n    this.ctx.restore();\n\n    // Glassmorphism effect\n    this.ctx.save();\n    this.ctx.beginPath();\n    this.ctx.arc(this.centerX + offsetX, this.centerY + offsetY, this.radius * 1.13, 0, Math.PI * 2);\n    this.ctx.fillStyle = this.isDarkMode ? 'rgba(40,50,80,0.18)' : 'rgba(255,255,255,0.10)';\n    this.ctx.filter = 'blur(2.5px)';\n    this.ctx.fill();\n    this.ctx.filter = 'none';\n    this.ctx.restore();\n\n    // Inner gold circle\n    this.ctx.save();\n    this.ctx.beginPath();\n    this.ctx.arc(this.centerX + offsetX, this.centerY + offsetY, this.radius * 0.98, 0, Math.PI * 2);\n    this.ctx.fillStyle = this.isDarkMode ? '#bfa133' : '#E8B554';\n    this.ctx.shadowColor = this.isDarkMode ? 'rgba(85,154,154,0.18)' : 'rgba(85,154,154,0.25)';\n    this.ctx.shadowBlur = 10;\n    this.ctx.fill();\n    this.ctx.restore();\n\n    // Boutique pattern/texture\n    this.drawTexturePattern();\n\n    // Neumorphism shadow\n    this.ctx.save();\n    this.ctx.beginPath();\n    this.ctx.arc(this.centerX + offsetX, this.centerY + offsetY, this.radius * 0.98, 0, Math.PI * 2);\n    this.ctx.shadowColor = this.isDarkMode ? 'rgba(85,154,154,0.10)' : 'rgba(85,154,154,0.18)';\n    this.ctx.shadowBlur = 24;\n    this.ctx.globalAlpha = 0.7;\n    this.ctx.strokeStyle = 'rgba(0,0,0,0)';\n    this.ctx.lineWidth = 8;\n    this.ctx.stroke();\n    this.ctx.restore();\n\n    // Light beam/flare\n    this.drawLightBeam();\n\n    // Draw modern mic icon in the center\n    this.drawMicIcon(offsetX, offsetY);\n  }\n\n  private drawMicIcon(offsetX: number = 0, offsetY: number = 0) {\n    let breath = 0.85 + 0.15 * Math.sin(this.pulsePhase * 1.5);\n    if (this.isHovered) breath *= 1.08;\n    if (this.isActive) breath *= 0.95;\n    this.ctx.save();\n    this.ctx.translate(this.centerX + offsetX, this.centerY + offsetY);\n    this.ctx.scale(breath, breath);\n    this.ctx.shadowColor = this.isHovered ? 'rgba(255,255,255,0.95)' : 'rgba(255,255,255,0.7)';\n    this.ctx.shadowBlur = 16 + 8 * breath + (this.isHovered ? 8 : 0);\n    this.ctx.beginPath();\n    this.ctx.moveTo(0, 18);\n    this.ctx.arc(0, 0, 18, Math.PI * 0.15, Math.PI * 1.85, false);\n    this.ctx.lineTo(0, 18);\n    this.ctx.closePath();\n    this.ctx.fillStyle = 'rgba(255,255,255,0.92)';\n    this.ctx.fill();\n    this.ctx.beginPath();\n    this.ctx.moveTo(-4, 18);\n    this.ctx.lineTo(-4, 28);\n    this.ctx.lineTo(4, 28);\n    this.ctx.lineTo(4, 18);\n    this.ctx.closePath();\n    this.ctx.fillStyle = 'rgba(255,255,255,0.92)';\n    this.ctx.fill();\n    this.ctx.beginPath();\n    this.ctx.arc(0, 28, 6, 0, Math.PI, true);\n    this.ctx.fillStyle = 'rgba(255,255,255,0.7)';\n    this.ctx.fill();\n    this.ctx.restore();\n  }\n\n  private drawRipples() {\n    // Update and draw ripples\n    for (let i = this.ripples.length - 1; i >= 0; i--) {\n      const ripple = this.ripples[i];\n      ripple.radius += ripple.speed;\n      ripple.alpha -= 0.01;\n\n      if (ripple.alpha <= 0) {\n        this.ripples.splice(i, 1);\n        continue;\n      }\n\n      this.ctx.beginPath();\n      this.ctx.arc(this.centerX, this.centerY, ripple.radius, 0, Math.PI * 2);\n      this.ctx.strokeStyle = `rgba(85,154,154, ${ripple.alpha})`;\n      this.ctx.lineWidth = 2;\n      this.ctx.stroke();\n    }\n  }\n\n  private drawPulsingRing() {\n    // Draw pulsing ring when listening\n    if (this.isListening) {\n      const pulseRadius = this.radius + 10 + Math.sin(this.pulsePhase) * 5;\n      const volumeBoost = this.volumeLevel * 20;\n      \n      this.ctx.beginPath();\n      this.ctx.arc(this.centerX, this.centerY, pulseRadius + volumeBoost, 0, Math.PI * 2);\n      this.ctx.strokeStyle = 'rgba(33, 150, 243, 0.5)';\n      this.ctx.lineWidth = 3;\n      this.ctx.stroke();\n      \n      this.pulsePhase += 0.1;\n    }\n  }\n\n  private drawWaveform() {\n    if (!this.isListening) return;\n    // Draw concentric waveform rings\n    const rings = 4;\n    this.waveformPhase += 0.08 + this.volumeLevel * 0.12;\n    for (let i = 1; i <= rings; i++) {\n      const baseRadius = this.radius * 0.98 + i * 10 + Math.sin(this.waveformPhase + i) * 3 * (1 + this.volumeLevel);\n      this.ctx.save();\n      this.ctx.beginPath();\n      this.ctx.arc(this.centerX, this.centerY, baseRadius, 0, Math.PI * 2);\n      this.ctx.strokeStyle = `rgba(232,181,84,${0.18 + 0.08 * (rings-i)})`;\n      this.ctx.lineWidth = 2 + this.volumeLevel * 2;\n      this.ctx.shadowColor = 'rgba(85,154,154,0.22)';\n      this.ctx.shadowBlur = 8;\n      this.ctx.stroke();\n      this.ctx.restore();\n    }\n  }\n\n  private drawParticles() {\n    // Add new particles when listening\n    if (this.isListening && Math.random() < 0.18) {\n      const angle = Math.random() * 2 * Math.PI;\n      const dist = this.radius * 1.18 + Math.random() * 16;\n      this.particles.push({\n        x: this.centerX + Math.cos(angle) * dist,\n        y: this.centerY + Math.sin(angle) * dist,\n        alpha: 0.7 + Math.random() * 0.3,\n        size: 2 + Math.random() * 2,\n        speed: 0.5 + Math.random() * 0.7\n      });\n    }\n    // Draw and update particles\n    for (let i = this.particles.length - 1; i >= 0; i--) {\n      const p = this.particles[i];\n      p.alpha -= 0.012;\n      p.size *= 0.98;\n      p.y -= p.speed * 0.5;\n      p.x += Math.sin(p.y * 0.1) * 0.2;\n      if (p.alpha <= 0.05 || p.size < 0.5) {\n        this.particles.splice(i, 1);\n        continue;\n      }\n      this.ctx.save();\n      this.ctx.beginPath();\n      this.ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);\n      this.ctx.fillStyle = `rgba(232,181,84,${p.alpha})`;\n      this.ctx.shadowColor = 'rgba(85,154,154,0.22)';\n      this.ctx.shadowBlur = 6;\n      this.ctx.fill();\n      this.ctx.restore();\n    }\n  }\n\n  private drawTimeRing() {\n    // Draw thin progress ring around the button\n    const percent = Math.min(1, this.elapsedTime / this.timeTarget);\n    const color = percent < 0.5 ? '#E8B554' : percent < 1 ? '#d4af37' : '#e53935';\n    this.ctx.save();\n    this.ctx.beginPath();\n    this.ctx.arc(this.centerX, this.centerY, this.radius * 1.32, -Math.PI/2, -Math.PI/2 + percent * 2 * Math.PI);\n    this.ctx.strokeStyle = color;\n    this.ctx.lineWidth = 4;\n    this.ctx.shadowColor = color;\n    this.ctx.shadowBlur = percent > 0.95 ? 16 : 6;\n    this.ctx.globalAlpha = 0.85;\n    this.ctx.stroke();\n    this.ctx.restore();\n  }\n\n  private drawTimeText() {\n    // Animate displayedTime for smooth counting\n    this.displayedTime += (this.elapsedTime - this.displayedTime) * 0.18;\n    const shown = Math.round(this.displayedTime);\n    const min = Math.floor(shown / 60).toString().padStart(2, '0');\n    const sec = (shown % 60).toString().padStart(2, '0');\n    const timeStr = `${min}:${sec}`;\n    this.ctx.save();\n    this.ctx.font = '600 1.25rem Montserrat, Raleway, Arial, sans-serif';\n    this.ctx.textAlign = 'center';\n    this.ctx.textBaseline = 'top';\n    this.ctx.shadowColor = 'rgba(85,154,154,0.22)';\n    this.ctx.shadowBlur = 8;\n    this.ctx.fillStyle = '#fff';\n    if (this.isDarkMode) this.ctx.fillStyle = '#e8e8e8';\n    this.ctx.globalAlpha = 0.95;\n    this.ctx.fillText(timeStr, this.centerX, this.centerY + this.radius * 1.45);\n    this.ctx.restore();\n  }\n\n  private drawIdleFlash() {\n    // Hiệu ứng nhấp nháy nhẹ khi không hoạt động lâu\n    const idleMs = Date.now() - this.lastActiveTime;\n    if (idleMs > 6000) {\n      this.idleFlash += 0.08;\n      const flash = 0.7 + 0.3 * Math.abs(Math.sin(this.idleFlash * 1.2));\n      this.ctx.save();\n      this.ctx.globalAlpha = 0.18 * flash;\n      this.ctx.beginPath();\n      this.ctx.arc(this.centerX, this.centerY, this.radius * 1.18, 0, Math.PI * 2);\n      this.ctx.fillStyle = '#E8B554';\n      this.ctx.filter = 'blur(2.5px)';\n      this.ctx.fill();\n      this.ctx.filter = 'none';\n      this.ctx.restore();\n    } else {\n      this.idleFlash = 0;\n    }\n  }\n\n  private drawVolumeVisualization() {\n    // Visualization sóng âm động quanh nút khi listening\n    if (!this.isListening) return;\n    const bars = 16;\n    const baseR = this.radius * 1.08;\n    for (let i = 0; i < bars; i++) {\n      const angle = (2 * Math.PI * i) / bars;\n      const amp = 8 + Math.sin(this.waveformPhase + i) * 4 + this.volumeLevel * 18;\n      const x1 = this.centerX + Math.cos(angle) * baseR;\n      const y1 = this.centerY + Math.sin(angle) * baseR;\n      const x2 = this.centerX + Math.cos(angle) * (baseR + amp);\n      const y2 = this.centerY + Math.sin(angle) * (baseR + amp);\n      this.ctx.save();\n      this.ctx.strokeStyle = `rgba(232,181,84,${0.18 + 0.18 * this.volumeLevel})`;\n      this.ctx.lineWidth = 2.2;\n      this.ctx.beginPath();\n      this.ctx.moveTo(x1, y1);\n      this.ctx.lineTo(x2, y2);\n      this.ctx.shadowColor = 'rgba(85,154,154,0.22)';\n      this.ctx.shadowBlur = 6;\n      this.ctx.stroke();\n      this.ctx.restore();\n    }\n  }\n\n  private animate() {\n    // Responsive: update radius based on container size\n    const isMobile = Math.min(this.width, this.height) < 340;\n    this.radius = isMobile ? Math.max(32, Math.min(this.width, this.height) / 2.8) : Math.max(36, Math.min(this.width, this.height) / 5.2);\n    // Clear canvas\n    this.ctx.clearRect(0, 0, this.width, this.height);\n    // Draw all elements\n    this.drawBaseCircle();\n    this.drawWaveform();\n    this.drawParticles();\n    this.drawRipples();\n    this.drawPulsingRing();\n    this.drawTimeRing();\n    this.drawTimeText();\n    this.drawIdleFlash();\n    this.drawVolumeVisualization();\n    // Add new ripples when listening\n    if (this.isListening && Math.random() < (isMobile ? 0.05 : 0.1)) {\n      this.ripples.push({\n        radius: this.radius,\n        alpha: 0.4,\n        speed: 1 + this.volumeLevel * 2\n      });\n    }\n    // Request next frame\n    this.animationFrameId = requestAnimationFrame(this.animate.bind(this));\n  }\n\n  public setListening(listening: boolean) {\n    this.isListening = listening;\n    if (listening) {\n      // Reset ripples when starting to listen\n      this.ripples = [];\n    }\n  }\n\n  public setVolumeLevel(level: number) {\n    // Clamp volume level between 0 and 1\n    this.volumeLevel = Math.max(0, Math.min(1, level));\n  }\n\n  public setTime(seconds: number, target: number = 60) {\n    this.elapsedTime = seconds;\n    this.timeTarget = target;\n  }\n\n  public getTime() {\n    return this.elapsedTime;\n  }\n\n  public cleanup() {\n    // Remove event listeners and stop animation\n    window.removeEventListener('resize', this.resize);\n    if (this.animationFrameId) {\n      cancelAnimationFrame(this.animationFrameId);\n    }\n    \n    // Remove canvas from DOM\n    this.canvas.remove();\n  }\n} ","import React, { useEffect, useRef } from 'react';\nimport { SiriButton } from './SiriButton';\n\ninterface SiriCallButtonProps {\n  isListening: boolean;\n  volumeLevel: number;\n  containerId: string;\n}\n\nconst SiriCallButton: React.FC<SiriCallButtonProps> = ({ \n  isListening, \n  volumeLevel,\n  containerId \n}) => {\n  const buttonRef = useRef<SiriButton | null>(null);\n\n  useEffect(() => {\n    // Initialize SiriButton\n    buttonRef.current = new SiriButton(containerId);\n\n    // Cleanup on unmount\n    return () => {\n      if (buttonRef.current) {\n        buttonRef.current.cleanup();\n        buttonRef.current = null;\n      }\n    };\n  }, [containerId]);\n\n  useEffect(() => {\n    // Update listening state\n    if (buttonRef.current) {\n      buttonRef.current.setListening(isListening);\n    }\n  }, [isListening]);\n\n  useEffect(() => {\n    // Update volume level\n    if (buttonRef.current) {\n      buttonRef.current.setVolumeLevel(volumeLevel);\n    }\n  }, [volumeLevel]);\n\n  return (\n    <div \n      id={containerId}\n      className=\"w-[220px] h-[220px] relative rounded-full overflow-visible\"\n      style={{ cursor: 'pointer', borderRadius: '50%' }}\n    />\n  );\n};\n\nexport default SiriCallButton; ","interface ReferenceItem {\n  type: 'image' | 'document' | 'link';\n  title: string;\n  url: string;\n  description?: string;\n  keywords: string[];\n}\n\ninterface ReferenceMap {\n  [key: string]: ReferenceItem;\n}\n\nclass ReferenceService {\n  private referenceMap: ReferenceMap = {};\n\n  async initialize() {\n    try {\n      const response = await fetch('/assets/references/reference-map.json');\n      this.referenceMap = await response.json();\n      console.log('Loaded referenceMap:', this.referenceMap);\n    } catch (error) {\n      console.error('Error loading reference map:', error);\n    }\n  }\n\n  findReferences(content: string): ReferenceItem[] {\n    const normalizedContent = content.toLowerCase();\n    const matches: ReferenceItem[] = [];\n\n    // Check each reference item for matching keywords\n    Object.values(this.referenceMap).forEach(item => {\n      const hasMatch = item.keywords.some(keyword => \n        normalizedContent.includes(keyword.toLowerCase())\n      );\n\n      if (hasMatch && !matches.find(m => m.url === item.url)) {\n        matches.push(item);\n      }\n    });\n\n    return matches;\n  }\n\n  async addReference(key: string, reference: ReferenceItem) {\n    this.referenceMap[key] = reference;\n    // Optionally save to backend\n    try {\n      await fetch('/api/references', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          ...reference,\n          id: key\n        })\n      });\n    } catch (error) {\n      console.error('Error saving reference:', error);\n    }\n  }\n}\n\nexport const referenceService = new ReferenceService();\nexport type { ReferenceItem, ReferenceMap }; ","import React, { useRef, useEffect, useState, useCallback } from 'react';\nimport { useAssistant } from '@/context/AssistantContext';\nimport Reference from './Reference';\nimport SiriCallButton from './SiriCallButton';\nimport { referenceService, ReferenceItem } from '@/services/ReferenceService';\nimport InfographicSteps from './InfographicSteps';\nimport { t } from '@/i18n';\n\ninterface Interface2Props {\n  isActive: boolean;\n}\n\n// Interface cho trạng thái hiển thị của mỗi message\ninterface VisibleCharState {\n  [messageId: string]: number;\n}\n\n// Interface cho một turn trong cuộc hội thoại\ninterface ConversationTurn {\n  id: string;\n  role: 'user' | 'assistant';\n  timestamp: Date;\n  messages: Array<{\n    id: string;\n    content: string;\n    timestamp: Date;\n  }>;\n}\n\nconst Interface2: React.FC<Interface2Props> = ({ isActive }) => {\n  const { \n    transcripts, \n    callDetails,\n    callDuration,\n    endCall: contextEndCall,\n    isMuted,\n    toggleMute,\n    setCurrentInterface,\n    micLevel,\n    modelOutput,\n    language\n  } = useAssistant();\n  \n  // State cho Paint-on effect\n  const [visibleChars, setVisibleChars] = useState<VisibleCharState>({});\n  const animationFrames = useRef<{[key: string]: number}>({});\n  \n  // State để lưu trữ các turns đã được xử lý\n  const [conversationTurns, setConversationTurns] = useState<ConversationTurn[]>([]);\n  \n  // Add state for references\n  const [references, setReferences] = useState<ReferenceItem[]>([]);\n  \n  // Local duration state for backup timer functionality\n  const [localDuration, setLocalDuration] = useState(0);\n  \n  const conversationRef = useRef<HTMLDivElement>(null);\n\n  // NEW: State để ẩn/hiện khung realtime conversation\n  const [showRealtimeConversation, setShowRealtimeConversation] = useState(true);\n  \n  // Cleanup function for animations\n  const cleanupAnimations = () => {\n    Object.values(animationFrames.current).forEach(frameId => {\n      cancelAnimationFrame(frameId);\n    });\n    animationFrames.current = {};\n  };\n  \n  // Load all references on mount\n  useEffect(() => {\n    async function loadAllReferences() {\n      await referenceService.initialize();\n      // Lấy toàn bộ referenceMap\n      const allRefs = Object.values((referenceService as any).referenceMap || {}) as ReferenceItem[];\n      console.log('All references loaded:', allRefs);\n      setReferences(allRefs);\n    }\n    loadAllReferences();\n  }, []);\n  \n  // Process transcripts into conversation turns\n  useEffect(() => {\n    const sortedTranscripts = [...transcripts].sort((a, b) => \n      a.timestamp.getTime() - b.timestamp.getTime()\n    );\n\n    const turns: ConversationTurn[] = [];\n    let currentTurn: ConversationTurn | null = null;\n\n    sortedTranscripts.forEach((message) => {\n      if (message.role === 'user') {\n        // Always create a new turn for user messages\n        currentTurn = {\n          id: message.id.toString(),\n          role: 'user',\n          timestamp: message.timestamp,\n          messages: [{ \n            id: message.id.toString(), \n            content: message.content,\n            timestamp: message.timestamp \n          }]\n        };\n        turns.push(currentTurn);\n      } else {\n        // For assistant messages\n        if (!currentTurn || currentTurn.role === 'user') {\n          // Start new assistant turn\n          currentTurn = {\n            id: message.id.toString(),\n            role: 'assistant',\n            timestamp: message.timestamp,\n            messages: []\n          };\n          turns.push(currentTurn);\n        }\n        // Add message to current assistant turn\n        currentTurn.messages.push({\n          id: message.id.toString(),\n          content: message.content,\n          timestamp: message.timestamp\n        });\n      }\n    });\n\n    setConversationTurns(turns);\n  }, [transcripts]);\n\n  // Paint-on animation effect\n  useEffect(() => {\n    // Get all assistant messages from all turns\n    const assistantMessages = conversationTurns\n      .filter(turn => turn.role === 'assistant')\n      .flatMap(turn => turn.messages);\n    \n    assistantMessages.forEach(message => {\n      // Skip if already animated\n      if (visibleChars[message.id] === message.content.length) return;\n      \n      let currentChar = visibleChars[message.id] || 0;\n      const content = message.content;\n      \n      const animate = () => {\n        if (currentChar < content.length) {\n          setVisibleChars(prev => ({\n            ...prev,\n            [message.id]: currentChar + 1\n          }));\n          currentChar++;\n          animationFrames.current[message.id] = requestAnimationFrame(animate);\n        } else {\n          delete animationFrames.current[message.id];\n        }\n      };\n      \n      animationFrames.current[message.id] = requestAnimationFrame(animate);\n    });\n    \n    // Cleanup on unmount or when turns change\n    return () => cleanupAnimations();\n  }, [conversationTurns]);\n\n  // Handler for Cancel button - End call and go back to interface1\n  const handleCancel = useCallback(() => {\n    // Capture the current duration for the email\n    const finalDuration = callDuration > 0 ? callDuration : localDuration;\n    console.log('Canceling call with duration:', finalDuration);\n    \n    // Call the context's endCall and switch to interface1\n    contextEndCall();\n    setCurrentInterface('interface1');\n  }, [callDuration, localDuration, contextEndCall, setCurrentInterface]);\n\n  // Handler for Next button - End call and proceed to interface3\n  const handleNext = useCallback(() => {\n    // Nếu chưa có hội thoại thì không cho xác nhận\n    if (!transcripts || transcripts.length === 0) {\n      alert(t('need_conversation', language));\n      return;\n    }\n    // Capture the current duration for the email\n    const finalDuration = callDuration > 0 ? callDuration : localDuration;\n    console.log('Ending call with duration:', finalDuration);\n    // Call the context's endCall and switch to interface3, interface3fr (French), hoặc interface3vi (Vietnamese)\n    contextEndCall();\n    if (language === 'fr') {\n      setCurrentInterface('interface3fr');\n    } else if (language === 'vi') {\n      setCurrentInterface('interface3vi');\n    } else {\n      setCurrentInterface('interface3');\n    }\n  }, [callDuration, localDuration, contextEndCall, setCurrentInterface, transcripts, language]);\n  \n  // Format duration for display\n  const formatDuration = (seconds: number) => {\n    const minutes = Math.floor(seconds / 60).toString().padStart(2, '0');\n    const secs = (seconds % 60).toString().padStart(2, '0');\n    return `${minutes}:${secs}`;\n  };\n  \n  // Local timer as a backup to ensure we always have a working timer\n  useEffect(() => {\n    let timer: NodeJS.Timeout | null = null;\n    \n    // Only start the timer when this interface is active\n    if (isActive) {\n      console.log('Interface2 is active, starting local timer');\n      // Initialize with the current duration from context\n      setLocalDuration(callDuration || 0);\n      \n      // Start the local timer\n      timer = setInterval(() => {\n        setLocalDuration(prev => prev + 1);\n      }, 1000);\n    }\n    \n    return () => {\n      if (timer) {\n        console.log('Cleaning up local timer in Interface2');\n        clearInterval(timer);\n      }\n    };\n  }, [isActive, callDuration]);\n  \n  // Auto scroll to top when new transcript arrives\n  useEffect(() => {\n    if (conversationRef.current && isActive) {\n      conversationRef.current.scrollTop = 0;\n    }\n  }, [conversationTurns, isActive]);\n  \n  return (\n    <div \n      className={`absolute w-full min-h-screen h-full transition-opacity duration-500 ${\n        isActive ? 'opacity-100' : 'opacity-0 pointer-events-none'\n      } z-20 overflow-y-auto`} id=\"interface2\"\n      style={{\n        backgroundImage: \"linear-gradient(rgba(85,154,154,0.7), rgba(121, 219, 220, 0.6)), url('/assets/courtyard.webp')\",\n        backgroundSize: 'cover',\n        backgroundPosition: 'center'\n      }}\n    >\n      <div className=\"container mx-auto flex flex-col md:flex-row p-2 h-full gap-2\">\n        {/* Left: Call indicator & Realtime conversation side by side, Reference below */}\n        <div className=\"w-full md:w-3/4 lg:w-2/3 flex flex-col items-center space-y-1 sm:space-y-4 mt-1\">\n          {/* Replace old orb with new SiriCallButton */}\n          <div className=\"relative flex flex-col items-center justify-center mb-1 sm:mb-6 w-full max-w-xs mx-auto\">\n            {/* SiriCallButton ở trên */}\n            <SiriCallButton\n              containerId=\"siri-button\"\n              isListening={!isMuted}\n              volumeLevel={micLevel}\n            />\n            {/* Duration bar với các nút hai bên, căn giữa tuyệt đối */}\n            <div className=\"flex items-center justify-center mt-2 w-full gap-2 sm:gap-3\">\n              {/* Nút Mute bên trái */}\n              <button\n                className=\"flex items-center justify-center transition-colors\"\n                title={isMuted ? t('unmute', language) : t('mute', language)}\n                onClick={toggleMute}\n                style={{fontSize: 22, padding: 0, background: 'none', border: 'none', color: '#d4af37', width: 28, height: 28}}\n                onMouseOver={e => (e.currentTarget.style.color = '#ffd700')}\n                onMouseOut={e => (e.currentTarget.style.color = '#d4af37')}\n              >\n                <span className=\"material-icons\">{isMuted ? 'mic_off' : 'mic'}</span>\n              </button>\n              {/* Nút Cancel (chỉ mobile) */}\n              <button\n                id=\"cancelButton\"\n                onClick={handleCancel}\n                className=\"flex items-center justify-center px-4 py-3 bg-white/80 hover:bg-blue-100 text-blue-900 rounded-full text-base font-semibold border-2 border-blue-200 shadow transition-colors sm:hidden active:scale-95 active:bg-blue-100\"\n                style={{\n                  fontFamily: 'inherit',\n                  letterSpacing: 0.2,\n                  minHeight: 56,\n                  minWidth: 120,\n                  touchAction: 'manipulation',\n                  zIndex: 10\n                }}\n              >\n                <span className=\"material-icons text-lg mr-2\">cancel</span>{t('cancel', language)}\n              </button>\n              {/* Duration ở giữa, luôn căn giữa */}\n              <div className=\"flex-1 flex justify-center\">\n                <div className=\"text-white text-xs sm:text-sm bg-blue-900/80 rounded-full px-3 sm:px-4 py-1 shadow-lg border border-white/30 flex items-center justify-center\" style={{backdropFilter:'blur(2px)'}}>\n                  {formatDuration(localDuration)}\n                </div>\n              </div>\n              {/* Nút Confirm (chỉ mobile) */}\n              <button\n                id=\"confirmButton\"\n                onClick={handleNext}\n                className=\"flex items-center justify-center px-4 py-3 bg-[#ffd700] hover:bg-[#ffe066] text-blue-900 rounded-full text-base font-bold border-4 border-[#d4af37] shadow-2xl transition-all duration-200 sm:hidden active:scale-95 active:bg-[#ffe066]\"\n                style={{\n                  fontFamily: 'inherit',\n                  letterSpacing: 0.2,\n                  boxShadow: '0 6px 24px 0 rgba(212,175,55,0.25), 0 1.5px 4px 0 rgba(0,0,0,0.12)',\n                  borderWidth: 4,\n                  borderColor: '#d4af37',\n                  background: 'linear-gradient(180deg, #ffe066 0%, #ffd700 100%)',\n                  textShadow: '0 1px 2px #fff, 0 1px 8px #ffd700',\n                  minHeight: 56,\n                  minWidth: 200,\n                  touchAction: 'manipulation',\n                  zIndex: 10\n                }}\n              >\n                <span className=\"material-icons text-lg mr-2\">send</span>{t('confirm', language)}\n              </button>\n              {/* Nút MicLevel bên phải */}\n              <button\n                className=\"flex items-center justify-center transition-colors\"\n                title=\"Mic Level\"\n                style={{fontSize: 22, padding: 0, background: 'none', border: 'none', color: '#d4af37', width: 28, height: 28}}\n                tabIndex={-1}\n                disabled\n                onMouseOver={e => (e.currentTarget.style.color = '#ffd700')}\n                onMouseOut={e => (e.currentTarget.style.color = '#d4af37')}\n              >\n                <span className=\"material-icons\">graphic_eq</span>\n                <span className=\"ml-1 flex items-end h-4 w-6\">\n                  {[...Array(4)].map((_, i) => (\n                    <span key={i} style={{\n                      display: 'inline-block',\n                      width: 2,\n                      height: `${4 + Math.round((micLevel/100)*12) * ((i%2)+1)}px`,\n                      background: '#d4af37',\n                      marginLeft: 1,\n                      borderRadius: 1\n                    }} />\n                  ))}\n                </span>\n              </button>\n            </div>\n          </div>\n          \n          {/* Realtime conversation container spans full width */}\n          {showRealtimeConversation && (\n            <div\n              id=\"realTimeConversation\"\n              ref={conversationRef}\n              className=\"w-full flex flex-col-reverse gap-1 pr-2 relative max-w-full sm:max-w-2xl mx-auto min-h-[60px] max-h-[12vh] overflow-y-auto mb-1\"\n              style={{\n                background: 'rgba(255,255,255,0.88)',\n                borderRadius: 12,\n                border: '1px solid rgba(255,255,255,0.35)',\n                boxShadow: '0px 4px 10px rgba(0,0,0,0.15)',\n                padding: '8px',\n                transition: 'box-shadow 0.3s, background 0.3s',\n                fontFamily: 'SF Pro Text, Roboto, Open Sans, Arial, sans-serif',\n                fontSize: window.innerWidth < 640 ? 14 : 16,\n                lineHeight: 1.5,\n                color: '#222',\n                fontWeight: 400,\n                backdropFilter: 'blur(2px)',\n                display: 'flex',\n                flexDirection: 'column',\n                justifyContent: 'flex-end',\n              }}\n            >\n              {/* Nút đóng transcript (ẩn realtime conversation) */}\n              <button\n                className=\"absolute top-1.5 right-1.5 w-5 h-5 flex items-center justify-center rounded-full bg-white/40 hover:bg-white/70 text-gray-400 hover:text-gray-700 shadow z-10 opacity-60 hover:opacity-90 transition-all\"\n                style={{fontSize: 14, display: 'block'}}\n                title=\"Ẩn realtime conversation\"\n                onClick={() => setShowRealtimeConversation(false)}\n              >\n                <span className=\"material-icons\" style={{fontSize: 16}}>close</span>\n              </button>\n              {/* Display conversation turns */}\n              <div className=\"w-full flex flex-col gap-1 pr-2\" style={{overflowY: 'auto', maxHeight: '28vh'}}>\n                {conversationTurns.length === 0 && (\n                  <div className=\"text-gray-400 text-base text-center select-none\" style={{opacity: 0.7}}>\n                    {t('tap_to_speak', language)}\n                  </div>\n                )}\n                {[...conversationTurns].reverse().map((turn, turnIdx) => (\n                  <div key={turn.id} className=\"mb-1\">\n                    <div className=\"flex items-start\">\n                      <div className=\"flex-grow\">\n                        {turn.role === 'user' ? (\n                          <p className=\"text-base md:text-lg font-medium text-gray-900\" style={{marginBottom: 2}}>\n                            {turn.messages[0].content}\n                          </p>\n                        ) : (\n                          <p\n                            className=\"text-base md:text-lg font-medium\"\n                            style={{\n                              marginBottom: 2,\n                              position: 'relative',\n                              background: 'linear-gradient(90deg, #FF512F, #F09819, #FFD700, #56ab2f, #43cea2, #1e90ff, #6a11cb, #FF512F)',\n                              WebkitBackgroundClip: 'text',\n                              WebkitTextFillColor: 'transparent',\n                              fontWeight: 600,\n                              letterSpacing: 0.2,\n                              transition: 'background 0.5s'\n                            }}\n                          >\n                            <span className=\"inline-flex flex-wrap\">\n                              {turn.messages.map((msg, idx) => {\n                                const content = msg.content.slice(0, visibleChars[msg.id] || 0);\n                                return (\n                                  <span key={msg.id} style={{ whiteSpace: 'pre' }}>\n                                    {content}\n                                    {/* Blinking cursor cho từ cuối cùng khi đang xử lý */}\n                                    {idx === turn.messages.length - 1 && turnIdx === 0 && visibleChars[msg.id] < msg.content.length && (\n                                      <span className=\"animate-blink text-yellow-500\" style={{marginLeft: 1}}>|</span>\n                                    )}\n                                  </span>\n                                );\n                              })}\n                            </span>\n                            {/* 3 chấm nhấp nháy khi assistant đang nghe */}\n                            {turnIdx === 0 && turn.role === 'assistant' && visibleChars[turn.messages[turn.messages.length-1].id] === turn.messages[turn.messages.length-1].content.length && (\n                              <span className=\"ml-2 animate-ellipsis text-yellow-500\">...</span>\n                            )}\n                          </p>\n                        )}\n                      </div>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </div>\n          )}\n          {/* Reference container below (full width, auto height) */}\n          <div className=\"w-full mt-1\">\n            <div className=\"w-full flex flex-row items-center gap-x-2 mb-3 px-2\">\n              <Reference references={references} />\n            </div>\n          </div>\n        </div>\n        {/* Right: Control buttons */}\n        <div className=\"w-1/4 lg:w-1/3 flex-col items-center lg:items-end p-2 space-y-4 overflow-auto hidden sm:flex\" style={{ maxHeight: '100%' }}>\n          <div className=\"flex flex-col gap-4 w-full md:w-auto\">\n            <button\n              id=\"endCallButton\"\n              onClick={handleNext}\n              className=\"w-full md:w-auto bg-[#ffd700] hover:bg-[#ffe066] text-blue-900 font-bold py-3 px-8 rounded-full shadow-2xl flex items-center justify-center space-x-2 transition-all duration-200 border-4 border-[#d4af37] text-base sm:text-lg active:scale-95 active:bg-[#ffe066]\"\n              style={{\n                fontFamily: 'inherit',\n                letterSpacing: 0.5,\n                boxShadow: '0 6px 24px 0 rgba(212,175,55,0.25), 0 1.5px 4px 0 rgba(0,0,0,0.12)',\n                borderWidth: 4,\n                borderColor: '#d4af37',\n                background: 'linear-gradient(180deg, #ffe066 0%, #ffd700 100%)',\n                textShadow: '0 1px 2px #fff, 0 1px 8px #ffd700',\n                minHeight: 56,\n                minWidth: 220,\n                touchAction: 'manipulation',\n                zIndex: 10\n              }}\n            >\n              <span className=\"material-icons\">send</span>\n              <span className=\"whitespace-nowrap\">{t('confirm_request', language)}</span>\n            </button>\n            <button\n              id=\"cancelButtonDesktop\"\n              onClick={handleCancel}\n              className=\"w-full md:w-auto bg-white hover:bg-blue-100 text-blue-900 font-semibold py-3 px-8 rounded-full shadow flex items-center justify-center space-x-2 transition-all duration-200 border-2 border-blue-200 text-base sm:text-lg active:scale-95 active:bg-blue-100\"\n              style={{\n                fontFamily: 'inherit',\n                letterSpacing: 0.2,\n                minHeight: 56,\n                minWidth: 120,\n                touchAction: 'manipulation',\n                zIndex: 10\n              }}\n            >\n              <span className=\"material-icons text-lg mr-2\">cancel</span>{t('cancel', language)}\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default Interface2;\n"],"file":"assets/Interface2-c2s3JLeu.js"}