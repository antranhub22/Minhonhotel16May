{"version":3,"file":"CallDetails-CHM_Q-IP.js","sources":["../../../client/src/pages/CallDetails.tsx"],"sourcesContent":["import React, { useState } from 'react';\nimport { useQuery } from '@tanstack/react-query';\nimport { useParams, Link } from 'wouter';\nimport { Transcript } from '@/types';\n\nconst CallDetails: React.FC = () => {\n  const { callId } = useParams();\n  const [copying, setCopying] = useState(false);\n  \n  // Fetch call summary\n  const { data: summary, isLoading: summaryLoading, isError: summaryError } = useQuery({\n    queryKey: ['summary', callId],\n    queryFn: async () => {\n      const response = await fetch(`/api/summaries/${callId}`);\n      if (!response.ok) {\n        throw new Error('Failed to fetch call summary');\n      }\n      return response.json();\n    },\n  });\n  \n  // Fetch call transcripts\n  const { data: transcripts, isLoading: transcriptsLoading, isError: transcriptsError } = useQuery({\n    queryKey: ['transcripts', callId],\n    queryFn: async () => {\n      const response = await fetch(`/api/transcripts/${callId}`);\n      if (!response.ok) {\n        throw new Error('Failed to fetch call transcripts');\n      }\n      return response.json();\n    },\n  });\n  \n  // Format date for display\n  const formatDate = (dateObj: Date | string | undefined) => {\n    if (!dateObj) return 'Unknown';\n    \n    const date = dateObj instanceof Date ? dateObj : new Date(dateObj);\n    return date.toLocaleString('en-US', {\n      year: 'numeric',\n      month: 'numeric',\n      day: 'numeric',\n      hour: '2-digit',\n      minute: '2-digit',\n      second: '2-digit'\n    });\n  };\n  \n  // Format duration for display\n  const formatDuration = (duration: string | undefined) => {\n    if (!duration) return '00:00';\n    return duration;\n  };\n  \n  // Handle copy to clipboard\n  const handleCopyTranscript = async () => {\n    if (!transcripts?.length) return;\n    \n    try {\n      setCopying(true);\n      const transcriptText = transcripts.map((t: Transcript) => \n        `${t.role === 'assistant' ? 'Assistant' : 'Guest'}: ${t.content}`\n      ).join('\\n\\n');\n      \n      await navigator.clipboard.writeText(transcriptText);\n      \n      // Show success animation\n      setTimeout(() => {\n        setCopying(false);\n      }, 1500);\n    } catch (error) {\n      console.error('Could not copy text: ', error);\n      setCopying(false);\n    }\n  };\n  \n  const isLoading = summaryLoading || transcriptsLoading;\n  const isError = summaryError || transcriptsError;\n  \n  return (\n    <div className=\"container mx-auto p-5\">\n      <header className=\"mb-8\">\n        <div className=\"flex items-center justify-between mb-4\">\n          <h1 className=\"text-3xl font-bold text-primary\">Call Details</h1>\n          <div className=\"flex space-x-3\">\n            <Link to=\"/call-history\">\n              <button className=\"px-4 py-2 rounded-md bg-gray-200 text-gray-700 hover:bg-gray-300 transition-colors flex items-center\">\n                <span className=\"material-icons align-middle mr-1 text-sm\">history</span>\n                Call History\n              </button>\n            </Link>\n            <Link to=\"/\">\n              <button className=\"px-4 py-2 rounded-md bg-gray-200 text-gray-700 hover:bg-gray-300 transition-colors flex items-center\">\n                <span className=\"material-icons align-middle mr-1 text-sm\">home</span>\n                Home\n              </button>\n            </Link>\n          </div>\n        </div>\n      </header>\n      \n      <main className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n        {isLoading ? (\n          <div className=\"col-span-1 lg:col-span-3 bg-white p-6 rounded-lg shadow-sm flex justify-center items-center h-64\">\n            <div className=\"flex flex-col items-center\">\n              <div className=\"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500 mb-4\"></div>\n              <p className=\"text-gray-500\">Loading call details...</p>\n            </div>\n          </div>\n        ) : isError ? (\n          <div className=\"col-span-1 lg:col-span-3 bg-red-50 p-6 rounded-lg shadow-sm flex justify-center items-center h-64\">\n            <div className=\"flex flex-col items-center text-center\">\n              <span className=\"material-icons text-red-500 text-4xl mb-3\">error_outline</span>\n              <p className=\"text-red-700 mb-2\">Unable to load call details</p>\n              <p className=\"text-red-500 text-sm\">The call may not exist or has been deleted.</p>\n              <Link to=\"/call-history\">\n                <button className=\"mt-4 px-4 py-2 bg-red-100 text-red-700 rounded-md hover:bg-red-200 transition-colors\">\n                  Return to Call History\n                </button>\n              </Link>\n            </div>\n          </div>\n        ) : (\n          <>\n            {/* Call Summary Section */}\n            <div className=\"col-span-1 lg:col-span-3\">\n              <div className=\"bg-white p-6 rounded-lg shadow-sm\">\n                <div className=\"flex justify-between items-start mb-4\">\n                  <h2 className=\"text-xl font-bold text-gray-800\">Call Information</h2>\n                  <div className=\"bg-blue-100 px-3 py-1 rounded-full text-blue-700 text-xs font-medium\">\n                    ID: {callId}\n                  </div>\n                </div>\n                \n                <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6\">\n                  <div className=\"bg-gray-50 p-3 rounded-lg\">\n                    <p className=\"text-xs text-gray-500 mb-1\">Time</p>\n                    <p className=\"text-sm font-medium\">{formatDate(summary?.timestamp)}</p>\n                  </div>\n                  <div className=\"bg-gray-50 p-3 rounded-lg\">\n                    <p className=\"text-xs text-gray-500 mb-1\">Room</p>\n                    <p className=\"text-sm font-medium\">{summary?.roomNumber || 'Unknown'}</p>\n                  </div>\n                  <div className=\"bg-gray-50 p-3 rounded-lg\">\n                    <p className=\"text-xs text-gray-500 mb-1\">Duration</p>\n                    <p className=\"text-sm font-medium\">{formatDuration(summary?.duration)}</p>\n                  </div>\n                  <div className=\"bg-gray-50 p-3 rounded-lg\">\n                    <p className=\"text-xs text-gray-500 mb-1\">Messages</p>\n                    <p className=\"text-sm font-medium\">{transcripts?.length || 0}</p>\n                  </div>\n                </div>\n              </div>\n            </div>\n            \n            {/* Transcript Section */}\n            <div className=\"col-span-1 lg:col-span-2\">\n              <div className=\"bg-white p-6 rounded-lg shadow-sm h-full\">\n                <div className=\"flex justify-between items-center mb-4\">\n                  <h2 className=\"text-xl font-bold text-gray-800\">Conversation History</h2>\n                  <button \n                    onClick={handleCopyTranscript}\n                    disabled={copying || !transcripts?.length}\n                    className={`px-3 py-1 rounded-md text-sm flex items-center ${\n                      copying \n                        ? 'bg-green-100 text-green-700' \n                        : 'bg-gray-100 text-gray-700 hover:bg-gray-200'\n                    }`}\n                  >\n                    <span className=\"material-icons text-sm mr-1\">\n                      {copying ? 'check' : 'content_copy'}\n                    </span>\n                    {copying ? 'Copied' : 'Copy'}\n                  </button>\n                </div>\n                \n                {transcripts?.length ? (\n                  <div className=\"space-y-4 overflow-y-auto max-h-[500px] pr-2\">\n                    {transcripts.map((transcript: Transcript) => (\n                      <div \n                        key={transcript.id} \n                        className={`flex ${transcript.role === 'assistant' ? 'justify-start' : 'justify-end'}`}\n                      >\n                        <div \n                          className={`max-w-[75%] p-3 rounded-lg relative ${\n                            transcript.role === 'assistant' \n                              ? 'bg-blue-50 text-blue-900' \n                              : 'bg-gray-100 text-gray-900'\n                          }`}\n                        >\n                          <div className=\"text-xs text-gray-500 mb-1\">\n                            {transcript.role === 'assistant' ? 'Assistant' : 'Guest'} â€¢ {\n                              formatDate(transcript.timestamp)\n                            }\n                          </div>\n                          <p className=\"text-sm\">{transcript.content}</p>\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                ) : (\n                  <div className=\"flex flex-col items-center justify-center h-64 text-center\">\n                    <span className=\"material-icons text-gray-300 text-4xl mb-2\">chat</span>\n                    <p className=\"text-gray-500\">No conversation data</p>\n                    <p className=\"text-gray-400 text-sm\">Conversation details may have been deleted or not recorded.</p>\n                  </div>\n                )}\n              </div>\n            </div>\n            \n            {/* Summary Section */}\n            <div className=\"col-span-1\">\n              <div className=\"bg-white p-6 rounded-lg shadow-sm h-full\">\n                <h2 className=\"text-xl font-bold text-gray-800 mb-4\">Call Summary</h2>\n                \n                {summary?.content ? (\n                  <div className=\"p-4 bg-blue-50 rounded-lg overflow-y-auto\" style={{ maxHeight: '500px' }}>\n                    <div className=\"text-sm text-blue-900 whitespace-pre-line\">\n                      {summary.content}\n                    </div>\n                    <div className=\"mt-3 text-right\">\n                      <span className=\"text-xs text-gray-500\">\n                        Generated at {formatDate(summary.timestamp)}\n                      </span>\n                    </div>\n                  </div>\n                ) : (\n                  <div className=\"flex flex-col items-center justify-center h-64 text-center\">\n                    <span className=\"material-icons text-gray-300 text-4xl mb-2\">summarize</span>\n                    <p className=\"text-gray-500\">No summary available</p>\n                    <p className=\"text-gray-400 text-sm\">Call summary could not be generated.</p>\n                  </div>\n                )}\n              </div>\n            </div>\n          </>\n        )}\n      </main>\n      \n      <div className=\"mt-6 text-center text-gray-500 text-sm\">\n        <p>Call history is stored for the last 24 hours</p>\n      </div>\n    </div>\n  );\n};\n\nexport default CallDetails;"],"names":["CallDetails","callId","useParams","copying","setCopying","useState","summary","summaryLoading","summaryError","useQuery","response","transcripts","transcriptsLoading","transcriptsError","formatDate","dateObj","formatDuration","duration","handleCopyTranscript","transcriptText","t","error","isLoading","isError","jsxs","jsx","Link","Fragment","transcript"],"mappings":"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"}