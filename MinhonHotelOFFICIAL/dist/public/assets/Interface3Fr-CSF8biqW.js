import{r as w,j as r}from"./react-BlJs-Rj_.js";import{u as I,t as a}from"./index-B87HseW6.js";import"./@daily-co-CRt2XSsO.js";import"./react-dom-qFx4IFJ8.js";import"./scheduler-DYLXRpC5.js";import"./wouter-DSgBA37d.js";import"./regexparam-CPXopyEH.js";import"./use-sync-external-store-T8uco2Ip.js";import"./@radix-ui-QlMI2MB_.js";import"./react-remove-scroll-BI7w_Xav.js";import"./tslib-CDuPK5Eb.js";import"./react-remove-scroll-bar-BrVopqW4.js";import"./react-style-singleton-QOKzqUsk.js";import"./get-nonce-C-Z93AgS.js";import"./use-sidecar-1JKJ7J1d.js";import"./use-callback-ref-5JKzev4p.js";import"./aria-hidden-DQ5UC2Eg.js";import"./class-variance-authority-Dp3B9jqt.js";import"./clsx-B-dksMZM.js";import"./tailwind-merge-D696Ktp4.js";import"./lucide-react-CxnTV3od.js";import"./@vapi-ai-DrvmIiYL.js";import"./events-CXH2uRM3.js";import"./react-icons-du4cCclG.js";import"./react-router-DvHbwIsR.js";import"./@remix-run-DBo92Irb.js";import"./react-router-dom-BMXKYxTf.js";import"./@tanstack-H40tjzcj.js";const ne=({isActive:u})=>{const{callSummary:m,orderSummary:i,setCurrentInterface:b,setOrderSummary:h,setOrder:j,serviceRequests:c,emailSentForCurrentSession:S,setEmailSentForCurrentSession:T,callDetails:g,callDuration:y,language:_}=I(),[v,$]=w.useState(""),D=(s,n)=>{i&&h({...i,[s]:n})};w.useEffect(()=>{var s,n;if(u&&c&&c.length>0&&i){const d=c.map((e,x)=>{let E=1,p=10;e.serviceType==="housekeeping"&&(p=8),e.serviceType==="technical-support"&&(p=0),(e.serviceType.includes("food")||e.serviceType==="room-service")&&(p=15),e.serviceType==="wake-up"&&(p=0);let l="";const t=e.details;return t.roomNumber&&t.roomNumber!=="unknown"&&t.roomNumber!=="Not specified"&&(l+=`${a("room_number","fr")}: ${t.roomNumber}
`),t.date&&t.date!=="Not specified"&&(l+=`${a("time","fr")}: ${t.date}
`),t.time&&t.time!=="Not specified"&&(l+=`${a("time","fr")}: ${t.time}
`),t.people&&(l+=`Nombre de personnes: ${t.people}
`),t.location&&t.location!=="Not specified"&&(l+=`Lieu: ${t.location}
`),t.amount&&t.amount!=="Not specified"&&(l+=`Montant: ${t.amount}
`),l+=`
Demande: ${e.requestText}`,t.otherDetails&&t.otherDetails!=="Not specified"&&t.otherDetails!=="None"&&!t.otherDetails.includes("Not specified")&&(l+=`

Informations supplémentaires: ${t.otherDetails}`),{id:(x+1).toString(),name:e.requestText.length>60?e.requestText.substring(0,57)+"...":e.requestText,description:l,quantity:E,price:p,serviceType:e.serviceType}}),f=Array.from(new Set(c.map(e=>e.serviceType))).join(",");let o=i.deliveryTime;c.some(e=>e.details&&e.details.time&&typeof e.details.time=="string"&&e.details.time.toLowerCase().includes("immediate"))&&(o="asap");const C=(n=(s=c.find(e=>e.details&&e.details.roomNumber&&e.details.roomNumber!=="unknown"&&e.details.roomNumber!=="Not specified"))==null?void 0:s.details)==null?void 0:n.roomNumber;h({...i,items:d,totalAmount:d.reduce((e,x)=>e+x.price*x.quantity,0),orderType:f,roomNumber:C||i.roomNumber,deliveryTime:o})}},[c,u,i,h]);const k=async()=>{if(!i)return;const s=`#ORD-${Math.floor(1e4+Math.random()*9e4)}`;if(j({reference:s,estimatedTime:"15-20 minutes",summary:i}),S){b("interface4");return}try{const n=y?`${Math.floor(y/60)}:${(y%60).toString().padStart(2,"0")}`:"0:00",d=`call-${Date.now()}`,f={toEmail:"tuans2@gmail.com",callDetails:{callId:(g==null?void 0:g.id)||d,roomNumber:i.roomNumber||"À confirmer",summary:m?m.content:"Aucun résumé",timestamp:m?m.timestamp:new Date,duration:n,serviceRequests:i.items.map(o=>o.name),orderReference:s,note:v}};setTimeout(async()=>{try{const o=await fetch("/api/send-call-summary-email",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(f),cache:"no-cache",credentials:"same-origin"});if(!o.ok)throw new Error(`Le serveur a répondu avec le statut: ${o.status}`);await o.json(),T(!0)}catch(o){console.error("Erreur lors de l'envoi de l'email:",o)}},500)}catch(n){console.error("Erreur lors de l'envoi de l'email:",n)}b("interface4")};return i?r.jsx("div",{className:`absolute w-full min-h-screen h-full transition-opacity duration-500 ${u?"opacity-100 active":"opacity-0 pointer-events-none"} z-30 overflow-y-auto`,id:"interface3fr","data-interface":"interface3fr","data-active":u.toString(),style:{backgroundImage:"linear-gradient(rgba(26, 35, 126, 0.7), rgba(63, 81, 181, 0.7))",backgroundSize:"cover",backgroundPosition:"center",fontFamily:"SF Pro Text, Roboto, Open Sans, Arial, sans-serif"},children:r.jsx("div",{className:"container mx-auto h-full flex flex-col p-2 sm:p-4 md:p-8",children:r.jsxs("div",{className:"mx-auto w-full max-w-3xl bg-white/90 rounded-2xl shadow-xl p-3 sm:p-6 md:p-10 mb-4 sm:mb-6 flex-grow border border-white/40 backdrop-blur-md",style:{minHeight:420},children:[r.jsx("div",{className:"mb-3 sm:mb-4 pb-2 sm:pb-3 border-b border-gray-200",children:r.jsx("p",{className:"font-poppins font-bold text-xl sm:text-2xl text-blue-900 tracking-wide",children:a("order_summary","fr")})}),r.jsx("div",{id:"summary-container",className:"mb-3 sm:mb-4",children:m?r.jsxs("div",{className:"p-3 sm:p-5 bg-white/80 rounded-xl shadow border border-white/30 mb-3 sm:mb-4 relative",style:{backdropFilter:"blur(2px)"},children:[r.jsx("h3",{className:"font-semibold text-base sm:text-lg mb-1 sm:mb-2 text-blue-800",children:a("summary","fr")}),r.jsx("div",{className:"text-xs sm:text-base leading-relaxed text-gray-800 whitespace-pre-line",style:{fontWeight:400},children:(m.content||"").split(`
`).map((n,d)=>{let N=n.replace(/^Room Number:/i,`${a("room_number","fr")}:`).replace(/^Guest's Name.*:/i,`${a("guest_name","fr")}:`).replace(/^REQUEST (\d+):/i,(f,o)=>`DEMANDE ${o} :`).replace(/^• Service Timing:/i,"• Heure de service :").replace(/^• Order Details:/i,"• Détails de la commande :").replace(/^• Special Requirements:/i,"• Exigences spéciales :").replace(/^Next Step:/i,"Étape suivante :").replace(/Not specified/gi,"Non spécifié").replace(/Details:/gi,"Détails :").replace(/Assistance or reservation for golf activity requested/gi,"Assistance ou réservation pour une activité de golf demandée");return r.jsx("div",{children:N},d)})}),r.jsx("div",{className:"mt-2 sm:mt-3 flex justify-end",children:r.jsxs("div",{className:"text-xs text-gray-500",children:[a("generated_at","fr")," ",new Date(m.timestamp).toLocaleTimeString()]})})]}):null}),r.jsxs("div",{className:"flex flex-col md:flex-row items-center gap-3 sm:gap-4 mb-4 sm:mb-6 w-full",children:[r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx("label",{className:"text-xs sm:text-base text-gray-600 font-medium",children:a("room_number","fr")}),r.jsx("input",{type:"text",className:"w-20 sm:w-32 p-2 border border-white/30 rounded-xl focus:ring-2 focus:ring-[#d4af37] focus:border-[#d4af37] bg-white/70 text-gray-900 font-semibold",value:i.roomNumber,onChange:s=>D("roomNumber",s.target.value)})]}),r.jsxs("button",{className:"h-full px-3 sm:px-4 bg-white/70 text-blue-900 rounded-full text-xs sm:text-base font-semibold border border-white/30 shadow flex items-center justify-center",onClick:()=>b("interface3"),style:{fontFamily:"inherit",letterSpacing:.2},children:[r.jsx("span",{className:"material-icons text-base mr-2",children:"translate"}),a("english","fr")]}),r.jsxs("button",{id:"confirmOrderButton",className:"h-full px-4 sm:px-8 py-2 sm:py-4 bg-[#d4af37] hover:bg-[#ffd700] text-blue-900 font-bold rounded-full shadow-lg text-base sm:text-xl transition-colors border border-white/30 flex items-center justify-center",onClick:k,style:{fontFamily:"inherit",letterSpacing:.5},children:[r.jsx("span",{className:"material-icons mr-2 text-lg sm:text-2xl",children:"check_circle"}),a("send_to_reception","fr")]})]}),r.jsx("textarea",{placeholder:a("enter_notes","fr"),className:"w-full p-2 border border-white/30 rounded-xl text-xs sm:text-sm bg-white/60 focus:bg-white/90 focus:ring-2 focus:ring-[#d4af37] transition italic font-light text-gray-500",value:v,onChange:s=>$(s.target.value),rows:3,style:{fontFamily:"inherit"}})]})})}):null};export{ne as default};
//# sourceMappingURL=Interface3Fr-CSF8biqW.js.map
