import{l as I,r as w,o,j as r}from"./index-Bmwy3-fU.js";const O=({isActive:f})=>{const{callSummary:m,orderSummary:s,setCurrentInterface:b,setOrderSummary:h,setOrder:j,serviceRequests:c,emailSentForCurrentSession:S,setEmailSentForCurrentSession:T,callDetails:g,callDuration:y,language:_}=I(),[v,$]=w.useState(""),D=(i,n)=>{s&&h({...s,[i]:n})};w.useEffect(()=>{var i,n;if(f&&c&&c.length>0&&s){const d=c.map((e,x)=>{let E=1,u=10;e.serviceType==="housekeeping"&&(u=8),e.serviceType==="technical-support"&&(u=0),(e.serviceType.includes("food")||e.serviceType==="room-service")&&(u=15),e.serviceType==="wake-up"&&(u=0);let l="";const t=e.details;return t.roomNumber&&t.roomNumber!=="unknown"&&t.roomNumber!=="Not specified"&&(l+=`${o("room_number","fr")}: ${t.roomNumber}
`),t.date&&t.date!=="Not specified"&&(l+=`${o("time","fr")}: ${t.date}
`),t.time&&t.time!=="Not specified"&&(l+=`${o("time","fr")}: ${t.time}
`),t.people&&(l+=`Nombre de personnes: ${t.people}
`),t.location&&t.location!=="Not specified"&&(l+=`Lieu: ${t.location}
`),t.amount&&t.amount!=="Not specified"&&(l+=`Montant: ${t.amount}
`),l+=`
Demande: ${e.requestText}`,t.otherDetails&&t.otherDetails!=="Not specified"&&t.otherDetails!=="None"&&!t.otherDetails.includes("Not specified")&&(l+=`

Informations supplémentaires: ${t.otherDetails}`),{id:(x+1).toString(),name:e.requestText.length>60?e.requestText.substring(0,57)+"...":e.requestText,description:l,quantity:E,price:u,serviceType:e.serviceType}}),p=Array.from(new Set(c.map(e=>e.serviceType))).join(",");let a=s.deliveryTime;c.some(e=>e.details&&e.details.time&&typeof e.details.time=="string"&&e.details.time.toLowerCase().includes("immediate"))&&(a="asap");const C=(n=(i=c.find(e=>e.details&&e.details.roomNumber&&e.details.roomNumber!=="unknown"&&e.details.roomNumber!=="Not specified"))==null?void 0:i.details)==null?void 0:n.roomNumber;h({...s,items:d,totalAmount:d.reduce((e,x)=>e+x.price*x.quantity,0),orderType:p,roomNumber:C||s.roomNumber,deliveryTime:a})}},[c,f,s,h]);const k=async()=>{if(!s)return;const i=`#ORD-${Math.floor(1e4+Math.random()*9e4)}`;if(j({reference:i,estimatedTime:"15-20 minutes",summary:s}),S){b("interface4");return}try{const n=y?`${Math.floor(y/60)}:${(y%60).toString().padStart(2,"0")}`:"0:00",d=`call-${Date.now()}`,p={toEmail:"tuans2@gmail.com",callDetails:{callId:(g==null?void 0:g.id)||d,roomNumber:s.roomNumber||"À confirmer",summary:m?m.content:"Aucun résumé",timestamp:m?m.timestamp:new Date,duration:n,serviceRequests:s.items.map(a=>a.name),orderReference:i,note:v}};setTimeout(async()=>{try{const a=await fetch("/api/send-call-summary-email",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(p),cache:"no-cache",credentials:"same-origin"});if(!a.ok)throw new Error(`Le serveur a répondu avec le statut: ${a.status}`);await a.json(),T(!0)}catch(a){console.error("Erreur lors de l'envoi de l'email:",a)}},500)}catch(n){console.error("Erreur lors de l'envoi de l'email:",n)}b("interface4")};return s?r.jsx("div",{className:`absolute w-full min-h-screen h-full transition-opacity duration-500 ${f?"opacity-100 active":"opacity-0 pointer-events-none"} z-30 overflow-y-auto`,id:"interface3fr","data-interface":"interface3fr","data-active":f.toString(),style:{backgroundImage:"linear-gradient(rgba(26, 35, 126, 0.7), rgba(63, 81, 181, 0.7))",backgroundSize:"cover",backgroundPosition:"center",fontFamily:"SF Pro Text, Roboto, Open Sans, Arial, sans-serif"},children:r.jsx("div",{className:"container mx-auto h-full flex flex-col p-2 sm:p-4 md:p-8",children:r.jsxs("div",{className:"mx-auto w-full max-w-3xl bg-white/90 rounded-2xl shadow-xl p-3 sm:p-6 md:p-10 mb-4 sm:mb-6 flex-grow border border-white/40 backdrop-blur-md",style:{minHeight:420},children:[r.jsx("div",{className:"mb-3 sm:mb-4 pb-2 sm:pb-3 border-b border-gray-200",children:r.jsx("p",{className:"font-poppins font-bold text-xl sm:text-2xl text-blue-900 tracking-wide",children:o("order_summary","fr")})}),r.jsx("div",{id:"summary-container",className:"mb-3 sm:mb-4",children:m?r.jsxs("div",{className:"p-3 sm:p-5 bg-white/80 rounded-xl shadow border border-white/30 mb-3 sm:mb-4 relative",style:{backdropFilter:"blur(2px)"},children:[r.jsx("h3",{className:"font-semibold text-base sm:text-lg mb-1 sm:mb-2 text-blue-800",children:o("summary","fr")}),r.jsx("div",{className:"text-xs sm:text-base leading-relaxed text-gray-800 whitespace-pre-line",style:{fontWeight:400},children:(m.content||"").split(`
`).map((n,d)=>{let N=n.replace(/^Room Number:/i,`${o("room_number","fr")}:`).replace(/^Guest's Name.*:/i,`${o("guest_name","fr")}:`).replace(/^REQUEST (\d+):/i,(p,a)=>`DEMANDE ${a} :`).replace(/^• Service Timing:/i,"• Heure de service :").replace(/^• Order Details:/i,"• Détails de la commande :").replace(/^• Special Requirements:/i,"• Exigences spéciales :").replace(/^Next Step:/i,"Étape suivante :").replace(/Not specified/gi,"Non spécifié").replace(/Details:/gi,"Détails :").replace(/Assistance or reservation for golf activity requested/gi,"Assistance ou réservation pour une activité de golf demandée");return r.jsx("div",{children:N},d)})}),r.jsx("div",{className:"mt-2 sm:mt-3 flex justify-end",children:r.jsxs("div",{className:"text-xs text-gray-500",children:[o("generated_at","fr")," ",new Date(m.timestamp).toLocaleTimeString()]})})]}):null}),r.jsxs("div",{className:"flex flex-col md:flex-row items-center gap-3 sm:gap-4 mb-4 sm:mb-6 w-full",children:[r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx("label",{className:"text-xs sm:text-base text-gray-600 font-medium",children:o("room_number","fr")}),r.jsx("input",{type:"text",className:"w-20 sm:w-32 p-2 border border-white/30 rounded-xl focus:ring-2 focus:ring-[#d4af37] focus:border-[#d4af37] bg-white/70 text-gray-900 font-semibold",value:s.roomNumber,onChange:i=>D("roomNumber",i.target.value)})]}),r.jsxs("button",{className:"h-full px-3 sm:px-4 bg-white/70 text-blue-900 rounded-full text-xs sm:text-base font-semibold border border-white/30 shadow flex items-center justify-center",onClick:()=>b("interface3"),style:{fontFamily:"inherit",letterSpacing:.2},children:[r.jsx("span",{className:"material-icons text-base mr-2",children:"translate"}),o("english","fr")]}),r.jsxs("button",{id:"confirmOrderButton",className:"h-full px-4 sm:px-8 py-2 sm:py-4 bg-[#d4af37] hover:bg-[#ffd700] text-blue-900 font-bold rounded-full shadow-lg text-base sm:text-xl transition-colors border border-white/30 flex items-center justify-center",onClick:k,style:{fontFamily:"inherit",letterSpacing:.5},children:[r.jsx("span",{className:"material-icons mr-2 text-lg sm:text-2xl",children:"check_circle"}),o("send_to_reception","fr")]})]}),r.jsx("textarea",{placeholder:o("enter_notes","fr"),className:"w-full p-2 border border-white/30 rounded-xl text-xs sm:text-sm bg-white/60 focus:bg-white/90 focus:ring-2 focus:ring-[#d4af37] transition italic font-light text-gray-500",value:v,onChange:i=>$(i.target.value),rows:3,style:{fontFamily:"inherit"}})]})})}):null};export{O as default};
