import{R as D,_ as Y,r as o,j as e,I,q as X,m as H,l as v}from"./index-f38482de.js";import{F as _}from"./index-6207d12f.js";const O=D.lazy(()=>Y(()=>import("./ReferenceSwiper-08ca1b2c.js"),["assets/ReferenceSwiper-08ca1b2c.js","assets/index-f38482de.js","assets/index-6207d12f.js"])),A=["Landmark","Hotel Amenities","Local Cuisine","Area Map","Activity and Experiences","Tours","Transportation","Dining"],$=({references:h})=>{const[t,s]=o.useState({}),[i,r]=o.useState(!0),[u,m]=o.useState(A[0]),[p,b]=o.useState(null);o.useEffect(()=>{r(!0);let a=0;if(h.length===0){r(!1);return}h.forEach(c=>{c.type==="document"&&c.url.endsWith(".txt")&&!t[c.url]?fetch(c.url).then(g=>g.text()).then(g=>{s(S=>({...S,[c.url]:g})),a++,a===h.length&&r(!1)}).catch(()=>{a++,a===h.length&&r(!1)}):(a++,a===h.length&&r(!1))}),h.every(c=>c.type!=="document"||!c.url.endsWith(".txt"))&&r(!1)},[h]);const w=a=>/^https?:\/\//.test(a)?a:`/${a.replace(/^\//,"")}`,f=async(a,c)=>{try{const S=await(await fetch(w(a))).blob(),N=URL.createObjectURL(S),k=document.createElement("a");k.href=N,k.download=c,document.body.appendChild(k),k.click(),document.body.removeChild(k),URL.revokeObjectURL(N)}catch(g){console.error("Error downloading file:",g)}},y=a=>{window.open(w(a),"_blank")},T=()=>e.jsxs("div",{className:"animate-pulse bg-white/80 rounded-xl shadow-md h-[180px] flex flex-col p-4 gap-2",children:[e.jsx("div",{className:"bg-gray-200 rounded w-full h-2/3 mb-2"}),e.jsx("div",{className:"bg-gray-200 rounded w-2/3 h-4 mb-1"}),e.jsx("div",{className:"bg-gray-100 rounded w-1/2 h-3"})]}),j=a=>e.jsxs("div",{className:"group bg-white/90 rounded-xl shadow-md h-[180px] flex flex-col justify-between cursor-pointer transition-transform duration-200 hover:scale-[1.03] active:scale-95 border border-white/40 backdrop-blur-md",style:{minWidth:220,maxWidth:260},onClick:()=>a.type==="link"?y(a.url):void 0,children:[e.jsxs("div",{className:"flex-1 flex items-center justify-center overflow-hidden rounded-t-xl",style:{height:"60%"},children:[a.type==="image"&&e.jsxs("picture",{children:[e.jsx("source",{srcSet:w(a.url).replace(/\.(jpe?g)$/i,".webp"),type:"image/webp"}),e.jsx(I,{src:w(a.url),alt:a.title,className:"object-cover w-full h-full rounded-t-xl hover:opacity-80 transition cursor-zoom-in",width:240,height:108,loading:"lazy",onClick:c=>{c.stopPropagation(),b(w(a.url))},tabIndex:0,onKeyDown:c=>{(c.key==="Enter"||c.key===" ")&&b(w(a.url))}})]}),a.type==="document"&&a.url.endsWith(".pdf")&&e.jsx("span",{className:"material-icons text-5xl text-blue-700/80",children:"picture_as_pdf"}),a.type==="document"&&a.url.endsWith(".txt")&&e.jsx("span",{className:"material-icons text-5xl text-green-700/80",children:"description"}),a.type==="link"&&e.jsx("span",{className:"material-icons text-5xl text-yellow-700/80",children:"link"})]}),e.jsxs("div",{className:"flex flex-col gap-1 px-3 py-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-base font-medium text-gray-900 truncate",children:a.title}),a.type==="document"&&e.jsx("button",{onClick:c=>{c.stopPropagation(),f(a.url,a.title)},className:"ml-auto p-1 rounded-full hover:bg-yellow-100 text-yellow-700 transition-colors",children:e.jsx("span",{className:"material-icons text-base",children:"download"})}),a.type==="link"&&e.jsx("span",{className:"material-icons text-xs text-gray-400 ml-1",children:"open_in_new"})]}),a.description&&e.jsx("span",{className:"text-xs text-gray-500 truncate",children:a.description}),a.url.endsWith(".txt")&&t[a.url]&&e.jsxs("pre",{className:"mt-1 max-h-12 overflow-auto whitespace-pre-wrap text-xs text-gray-700 bg-gray-50 rounded p-1",children:[t[a.url].slice(0,120),"..."]})]})]}),M=()=>window.innerWidth<640?"auto":window.innerWidth<1024?2:window.innerWidth<1280?3:4,P=h.filter(a=>a.category&&a.category.trim().toLowerCase()===u.trim().toLowerCase());return e.jsxs("div",{className:"w-full max-w-5xl mx-auto mt-2 mb-2 px-2 py-3 rounded-2xl",style:{background:"rgba(85,154,154,0.85)",minHeight:260},children:[p&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm",onClick:()=>b(null),children:e.jsxs("div",{className:"relative max-w-3xl w-full flex flex-col items-center",children:[e.jsx("button",{className:"absolute top-2 right-2 bg-white/80 hover:bg-white text-gray-800 rounded-full p-2 shadow-lg z-10",onClick:a=>{a.stopPropagation(),b(null)},children:e.jsx("span",{className:"material-icons text-2xl",children:"close"})}),e.jsxs("picture",{children:[e.jsx("source",{srcSet:p.replace(/\.(jpe?g)$/i,".webp"),type:"image/webp"}),e.jsx(I,{src:p,alt:"Phóng to ảnh reference",className:"max-w-full max-h-full object-contain",width:800,height:600,loading:"lazy"})]})]})}),e.jsx("div",{className:"flex items-center mb-4 px-2",children:e.jsxs("div",{className:"flex items-center px-3 py-2 sm:py-1.5 gap-2 transition-all duration-300 mx-auto sm:mx-0",style:{background:"linear-gradient(135deg, #4e5ab7 0%, #3f51b5 100%)",boxShadow:"0px 4px 8px rgba(0, 0, 0, 0.15)",borderRadius:"8px",minWidth:"150px",maxWidth:"95%",width:"auto",border:"1px solid rgba(255, 255, 255, 0.1)"},children:[e.jsx(X,{className:"text-[#F9BF3B] text-xl mr-1.5",style:{filter:"drop-shadow(0px 2px 3px rgba(0, 0, 0, 0.2))"}}),e.jsx("label",{className:"mr-2 font-semibold font-sans text-white whitespace-nowrap text-sm sm:text-base",children:"Category:"}),e.jsxs("div",{className:"relative flex-1",children:[e.jsx("select",{value:u,onChange:a=>m(a.target.value),className:"appearance-none w-full pl-6 sm:pl-8 pr-6 py-1 sm:py-1.5 font-sans bg-transparent focus:outline-none transition-all duration-200",style:{fontWeight:600,color:"#fff",textShadow:"0px 1px 2px rgba(0, 0, 0, 0.2)",borderRadius:"8px"},children:A.map(a=>e.jsx("option",{value:a,className:"bg-blue-800 text-white",children:a},a))}),e.jsx(_,{className:"absolute right-2 top-1/2 -translate-y-1/2 text-[#F9BF3B] pointer-events-none text-lg"})]})]})}),i?e.jsx("div",{className:"flex gap-4 overflow-x-auto pb-2",children:[...Array(3)].map((a,c)=>e.jsx(T,{},c))}):P.length===0?e.jsx("div",{className:"flex items-center justify-center h-[120px] text-white/80 text-base font-medium",children:"No references available"}):e.jsx(o.Suspense,{fallback:e.jsx("div",{className:"flex items-center justify-center h-[120px] text-white/80 text-base font-medium",children:"Loading slider..."}),children:e.jsx(O,{filteredReferences:P,renderReferenceCard:j,getSlidesPerView:M})})]})};class V{constructor(t){this.gradientRotation=0,this.isHovered=!1,this.isActive=!1,this.waveformPhase=0,this.particles=[],this.mouseX=0,this.mouseY=0,this.isDarkMode=!1,this.elapsedTime=0,this.displayedTime=0,this.timeTarget=60,this.idleFrame=0,this.lastActiveTime=Date.now(),this.idleFlash=0,this.canvas=document.createElement("canvas");const s=document.getElementById(t);if(!s)throw new Error("Container element not found");s.appendChild(this.canvas);const i=this.canvas.getContext("2d");if(!i)throw new Error("Could not get canvas context");this.ctx=i,this.width=200,this.height=200,this.centerX=this.width/2,this.centerY=this.height/2,this.radius=40,this.ripples=[],this.isListening=!1,this.pulsePhase=0,this.volumeLevel=0,this.animationFrameId=0,this.resize(),this.animate(),window.addEventListener("resize",this.resize.bind(this)),s&&(s.addEventListener("mouseenter",()=>{this.isHovered=!0,this.lastActiveTime=Date.now()}),s.addEventListener("mouseleave",()=>{this.isHovered=!1,this.isActive=!1}),s.addEventListener("mousedown",()=>{this.isActive=!0,this.lastActiveTime=Date.now()}),s.addEventListener("mouseup",()=>{this.isActive=!1}),s.addEventListener("mousemove",r=>{const u=s.getBoundingClientRect();this.mouseX=r.clientX-u.left,this.mouseY=r.clientY-u.top,this.lastActiveTime=Date.now()})),this.isDarkMode=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",r=>{this.isDarkMode=r.matches})}resize(){const t=this.canvas.parentElement;if(!t)return;const s=window.devicePixelRatio||1,i=Math.min(t.clientWidth,t.clientHeight);this.width=this.height=i,this.canvas.width=this.canvas.height=i*s,this.canvas.style.width=this.canvas.style.height=`${i}px`,this.canvas.style.borderRadius="50%",this.canvas.style.overflow="hidden",this.ctx.setTransform(1,0,0,1,0,0),this.ctx.scale(s,s),this.centerX=this.width/2,this.centerY=this.height/2}drawTexturePattern(){const t="rgba(232,181,84,0.18)";for(let i=-this.radius;i<this.radius;i+=14)for(let r=-this.radius;r<this.radius;r+=14)i*i+r*r<this.radius*this.radius*.85&&(this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(this.centerX+i,this.centerY+r,1.2,0,Math.PI*2),this.ctx.fillStyle=t,this.ctx.fill(),this.ctx.restore())}drawLightBeam(){if(!(this.isHovered||this.isActive))return;this.ctx.save();const t=this.ctx.createLinearGradient(this.centerX,this.centerY-this.radius*1.3,this.centerX,this.centerY+this.radius*.5);t.addColorStop(0,"rgba(255,255,255,0.22)"),t.addColorStop(.5,"rgba(255,255,255,0.08)"),t.addColorStop(1,"rgba(255,255,255,0)"),this.ctx.beginPath(),this.ctx.ellipse(this.centerX,this.centerY-this.radius*.7,this.radius*.7,this.radius*.22,0,0,2*Math.PI),this.ctx.fillStyle=t,this.ctx.filter="blur(2.5px)",this.ctx.fill(),this.ctx.filter="none",this.ctx.restore()}drawBaseCircle(){let t=0,s=0;this.isHovered&&(t=(this.mouseX-this.centerX)*.07,s=(this.mouseY-this.centerY)*.07),this.gradientRotation+=.0025;const i=this.gradientRotation%(2*Math.PI),r=this.centerX+Math.cos(i)*this.radius*1.2,u=this.centerY+Math.sin(i)*this.radius*1.2,m=this.ctx.createLinearGradient(this.centerX-this.radius*1.2+t,this.centerY-this.radius*1.2+s,r+t,u+s);m.addColorStop(0,this.isDarkMode?"#559A9A":"#5DB6B9"),m.addColorStop(1,this.isDarkMode?"#559A9A":"#5DB6B9"),this.ctx.save(),this.ctx.globalAlpha=.85,this.ctx.beginPath(),this.ctx.arc(this.centerX+t,this.centerY+s,this.radius*1.25,0,Math.PI*2),this.ctx.strokeStyle=m,this.ctx.lineWidth=12,this.ctx.shadowColor=(this.isHovered,"#559A9A"),this.ctx.shadowBlur=this.isHovered?32:16,this.ctx.stroke(),this.ctx.restore(),this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(this.centerX+t,this.centerY+s,this.radius*1.13,0,Math.PI*2),this.ctx.fillStyle=this.isDarkMode?"rgba(40,50,80,0.18)":"rgba(255,255,255,0.10)",this.ctx.filter="blur(2.5px)",this.ctx.fill(),this.ctx.filter="none",this.ctx.restore(),this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(this.centerX+t,this.centerY+s,this.radius*.98,0,Math.PI*2),this.ctx.fillStyle=this.isDarkMode?"#bfa133":"#E8B554",this.ctx.shadowColor=this.isDarkMode?"rgba(85,154,154,0.18)":"rgba(85,154,154,0.25)",this.ctx.shadowBlur=10,this.ctx.fill(),this.ctx.restore(),this.drawTexturePattern(),this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(this.centerX+t,this.centerY+s,this.radius*.98,0,Math.PI*2),this.ctx.shadowColor=this.isDarkMode?"rgba(85,154,154,0.10)":"rgba(85,154,154,0.18)",this.ctx.shadowBlur=24,this.ctx.globalAlpha=.7,this.ctx.strokeStyle="rgba(0,0,0,0)",this.ctx.lineWidth=8,this.ctx.stroke(),this.ctx.restore(),this.drawLightBeam(),this.drawMicIcon(t,s)}drawMicIcon(t=0,s=0){let i=.85+.15*Math.sin(this.pulsePhase*1.5);this.isHovered&&(i*=1.08),this.isActive&&(i*=.95),this.ctx.save(),this.ctx.translate(this.centerX+t,this.centerY+s),this.ctx.scale(i,i),this.ctx.shadowColor=this.isHovered?"rgba(255,255,255,0.95)":"rgba(255,255,255,0.7)",this.ctx.shadowBlur=16+8*i+(this.isHovered?8:0),this.ctx.beginPath(),this.ctx.moveTo(0,18),this.ctx.arc(0,0,18,Math.PI*.15,Math.PI*1.85,!1),this.ctx.lineTo(0,18),this.ctx.closePath(),this.ctx.fillStyle="rgba(255,255,255,0.92)",this.ctx.fill(),this.ctx.beginPath(),this.ctx.moveTo(-4,18),this.ctx.lineTo(-4,28),this.ctx.lineTo(4,28),this.ctx.lineTo(4,18),this.ctx.closePath(),this.ctx.fillStyle="rgba(255,255,255,0.92)",this.ctx.fill(),this.ctx.beginPath(),this.ctx.arc(0,28,6,0,Math.PI,!0),this.ctx.fillStyle="rgba(255,255,255,0.7)",this.ctx.fill(),this.ctx.restore()}drawRipples(){for(let t=this.ripples.length-1;t>=0;t--){const s=this.ripples[t];if(s.radius+=s.speed,s.alpha-=.01,s.alpha<=0){this.ripples.splice(t,1);continue}this.ctx.beginPath(),this.ctx.arc(this.centerX,this.centerY,s.radius,0,Math.PI*2),this.ctx.strokeStyle=`rgba(85,154,154, ${s.alpha})`,this.ctx.lineWidth=2,this.ctx.stroke()}}drawPulsingRing(){if(this.isListening){const t=this.radius+10+Math.sin(this.pulsePhase)*5,s=this.volumeLevel*20;this.ctx.beginPath(),this.ctx.arc(this.centerX,this.centerY,t+s,0,Math.PI*2),this.ctx.strokeStyle="rgba(33, 150, 243, 0.5)",this.ctx.lineWidth=3,this.ctx.stroke(),this.pulsePhase+=.1}}drawWaveform(){if(!this.isListening)return;const t=4;this.waveformPhase+=.08+this.volumeLevel*.12;for(let s=1;s<=t;s++){const i=this.radius*.98+s*10+Math.sin(this.waveformPhase+s)*3*(1+this.volumeLevel);this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(this.centerX,this.centerY,i,0,Math.PI*2),this.ctx.strokeStyle=`rgba(232,181,84,${.18+.08*(t-s)})`,this.ctx.lineWidth=2+this.volumeLevel*2,this.ctx.shadowColor="rgba(85,154,154,0.22)",this.ctx.shadowBlur=8,this.ctx.stroke(),this.ctx.restore()}}drawParticles(){if(this.isListening&&Math.random()<.18){const t=Math.random()*2*Math.PI,s=this.radius*1.18+Math.random()*16;this.particles.push({x:this.centerX+Math.cos(t)*s,y:this.centerY+Math.sin(t)*s,alpha:.7+Math.random()*.3,size:2+Math.random()*2,speed:.5+Math.random()*.7})}for(let t=this.particles.length-1;t>=0;t--){const s=this.particles[t];if(s.alpha-=.012,s.size*=.98,s.y-=s.speed*.5,s.x+=Math.sin(s.y*.1)*.2,s.alpha<=.05||s.size<.5){this.particles.splice(t,1);continue}this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(s.x,s.y,s.size,0,Math.PI*2),this.ctx.fillStyle=`rgba(232,181,84,${s.alpha})`,this.ctx.shadowColor="rgba(85,154,154,0.22)",this.ctx.shadowBlur=6,this.ctx.fill(),this.ctx.restore()}}drawTimeRing(){const t=Math.min(1,this.elapsedTime/this.timeTarget),s=t<.5?"#E8B554":t<1?"#d4af37":"#e53935";this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(this.centerX,this.centerY,this.radius*1.32,-Math.PI/2,-Math.PI/2+t*2*Math.PI),this.ctx.strokeStyle=s,this.ctx.lineWidth=4,this.ctx.shadowColor=s,this.ctx.shadowBlur=t>.95?16:6,this.ctx.globalAlpha=.85,this.ctx.stroke(),this.ctx.restore()}drawTimeText(){this.displayedTime+=(this.elapsedTime-this.displayedTime)*.18;const t=Math.round(this.displayedTime),s=Math.floor(t/60).toString().padStart(2,"0"),i=(t%60).toString().padStart(2,"0"),r=`${s}:${i}`;this.ctx.save(),this.ctx.font="600 1.25rem Montserrat, Raleway, Arial, sans-serif",this.ctx.textAlign="center",this.ctx.textBaseline="top",this.ctx.shadowColor="rgba(85,154,154,0.22)",this.ctx.shadowBlur=8,this.ctx.fillStyle="#fff",this.isDarkMode&&(this.ctx.fillStyle="#e8e8e8"),this.ctx.globalAlpha=.95,this.ctx.fillText(r,this.centerX,this.centerY+this.radius*1.45),this.ctx.restore()}drawIdleFlash(){if(Date.now()-this.lastActiveTime>6e3){this.idleFlash+=.08;const s=.7+.3*Math.abs(Math.sin(this.idleFlash*1.2));this.ctx.save(),this.ctx.globalAlpha=.18*s,this.ctx.beginPath(),this.ctx.arc(this.centerX,this.centerY,this.radius*1.18,0,Math.PI*2),this.ctx.fillStyle="#E8B554",this.ctx.filter="blur(2.5px)",this.ctx.fill(),this.ctx.filter="none",this.ctx.restore()}else this.idleFlash=0}drawVolumeVisualization(){if(!this.isListening)return;const t=16,s=this.radius*1.08;for(let i=0;i<t;i++){const r=2*Math.PI*i/t,u=8+Math.sin(this.waveformPhase+i)*4+this.volumeLevel*18,m=this.centerX+Math.cos(r)*s,p=this.centerY+Math.sin(r)*s,b=this.centerX+Math.cos(r)*(s+u),w=this.centerY+Math.sin(r)*(s+u);this.ctx.save(),this.ctx.strokeStyle=`rgba(232,181,84,${.18+.18*this.volumeLevel})`,this.ctx.lineWidth=2.2,this.ctx.beginPath(),this.ctx.moveTo(m,p),this.ctx.lineTo(b,w),this.ctx.shadowColor="rgba(85,154,154,0.22)",this.ctx.shadowBlur=6,this.ctx.stroke(),this.ctx.restore()}}animate(){const t=Math.min(this.width,this.height)<340;this.radius=t?Math.max(32,Math.min(this.width,this.height)/2.8):Math.max(36,Math.min(this.width,this.height)/5.2),this.ctx.clearRect(0,0,this.width,this.height),this.drawBaseCircle(),this.drawWaveform(),this.drawParticles(),this.drawRipples(),this.drawPulsingRing(),this.drawTimeRing(),this.drawTimeText(),this.drawIdleFlash(),this.drawVolumeVisualization(),this.isListening&&Math.random()<(t?.05:.1)&&this.ripples.push({radius:this.radius,alpha:.4,speed:1+this.volumeLevel*2}),this.animationFrameId=requestAnimationFrame(this.animate.bind(this))}setListening(t){this.isListening=t,t&&(this.ripples=[])}setVolumeLevel(t){this.volumeLevel=Math.max(0,Math.min(1,t))}setTime(t,s=60){this.elapsedTime=t,this.timeTarget=s}getTime(){return this.elapsedTime}cleanup(){window.removeEventListener("resize",this.resize),this.animationFrameId&&cancelAnimationFrame(this.animationFrameId),this.canvas.remove()}}const q=({isListening:h,volumeLevel:t,containerId:s})=>{const i=o.useRef(null);return o.useEffect(()=>(i.current=new V(s),()=>{i.current&&(i.current.cleanup(),i.current=null)}),[s]),o.useEffect(()=>{i.current&&i.current.setListening(h)},[h]),o.useEffect(()=>{i.current&&i.current.setVolumeLevel(t)},[t]),e.jsx("div",{id:s,className:"w-[220px] h-[220px] relative rounded-full overflow-visible",style:{cursor:"pointer",borderRadius:"50%"}})};class U{constructor(){this.referenceMap={}}async initialize(){try{const t=await fetch("/assets/references/reference-map.json");this.referenceMap=await t.json(),console.log("Loaded referenceMap:",this.referenceMap)}catch(t){console.error("Error loading reference map:",t)}}findReferences(t){const s=t.toLowerCase(),i=[];return Object.values(this.referenceMap).forEach(r=>{r.keywords.some(m=>s.includes(m.toLowerCase()))&&!i.find(m=>m.url===r.url)&&i.push(r)}),i}async addReference(t,s){this.referenceMap[t]=s;try{await fetch("/api/references",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...s,id:t})})}catch(i){console.error("Error saving reference:",i)}}}const E=new U,K=({isActive:h})=>{const{transcripts:t,callDetails:s,callDuration:i,endCall:r,isMuted:u,toggleMute:m,setCurrentInterface:p,micLevel:b,modelOutput:w,language:f}=H(),[y,T]=o.useState({}),j=o.useRef({}),[M,P]=o.useState([]),[a,c]=o.useState([]),[g,S]=o.useState(0),N=o.useRef(null),[k,F]=o.useState(!0),B=()=>{Object.values(j.current).forEach(n=>{cancelAnimationFrame(n)}),j.current={}};o.useEffect(()=>{async function n(){await E.initialize();const l=Object.values(E.referenceMap||{});console.log("All references loaded:",l),c(l)}n()},[]),o.useEffect(()=>{const n=[...t].sort((x,C)=>x.timestamp.getTime()-C.timestamp.getTime()),l=[];let d=null;n.forEach(x=>{x.role==="user"?(d={id:x.id.toString(),role:"user",timestamp:x.timestamp,messages:[{id:x.id.toString(),content:x.content,timestamp:x.timestamp}]},l.push(d)):((!d||d.role==="user")&&(d={id:x.id.toString(),role:"assistant",timestamp:x.timestamp,messages:[]},l.push(d)),d.messages.push({id:x.id.toString(),content:x.content,timestamp:x.timestamp}))}),P(l)},[t]),o.useEffect(()=>(M.filter(l=>l.role==="assistant").flatMap(l=>l.messages).forEach(l=>{if(y[l.id]===l.content.length)return;let d=y[l.id]||0;const x=l.content,C=()=>{d<x.length?(T(z=>({...z,[l.id]:d+1})),d++,j.current[l.id]=requestAnimationFrame(C)):delete j.current[l.id]};j.current[l.id]=requestAnimationFrame(C)}),()=>B()),[M]);const L=o.useCallback(()=>{const n=i>0?i:g;console.log("Canceling call with duration:",n),r(),p("interface1")},[i,g,r,p]),R=o.useCallback(()=>{if(!t||t.length===0){alert(v("need_conversation",f));return}const n=i>0?i:g;console.log("Ending call with duration:",n),r(),p(f==="fr"?"interface3fr":f==="vi"?"interface3vi":"interface3")},[i,g,r,p,t,f]),W=n=>{const l=Math.floor(n/60).toString().padStart(2,"0"),d=(n%60).toString().padStart(2,"0");return`${l}:${d}`};return o.useEffect(()=>{let n=null;return h&&(console.log("Interface2 is active, starting local timer"),S(i||0),n=setInterval(()=>{S(l=>l+1)},1e3)),()=>{n&&(console.log("Cleaning up local timer in Interface2"),clearInterval(n))}},[h,i]),o.useEffect(()=>{N.current&&h&&(N.current.scrollTop=0)},[M,h]),e.jsx("div",{className:`absolute w-full min-h-screen h-full transition-opacity duration-500 ${h?"opacity-100":"opacity-0 pointer-events-none"} z-20 overflow-y-auto`,id:"interface2",style:{backgroundImage:"linear-gradient(rgba(85,154,154,0.7), rgba(121, 219, 220, 0.6)), url('/assets/courtyard.webp')",backgroundSize:"cover",backgroundPosition:"center"},children:e.jsxs("div",{className:"container mx-auto flex flex-col md:flex-row p-2 h-full gap-2",children:[e.jsxs("div",{className:"w-full md:w-3/4 lg:w-2/3 flex flex-col items-center space-y-1 sm:space-y-4 mt-1",style:{flex:"1 1 auto",height:"100%",minHeight:"0",maxHeight:"none",overflow:"visible"},children:[e.jsxs("div",{className:"relative flex flex-col items-center justify-center mb-1 sm:mb-6 w-full max-w-xs mx-auto",children:[e.jsx(q,{containerId:"siri-button",isListening:!u,volumeLevel:b}),e.jsxs("div",{className:"flex items-center justify-center mt-2 w-full gap-2 sm:gap-3",children:[e.jsx("button",{className:"flex items-center justify-center transition-colors",title:u?v("unmute",f):v("mute",f),onClick:m,style:{fontSize:22,padding:0,background:"none",border:"none",color:"#d4af37",width:28,height:28},onMouseOver:n=>n.currentTarget.style.color="#ffd700",onMouseOut:n=>n.currentTarget.style.color="#d4af37",children:e.jsx("span",{className:"material-icons",children:u?"mic_off":"mic"})}),e.jsxs("button",{id:"cancelButton",onClick:L,className:"flex items-center justify-center px-4 py-3 bg-white/80 hover:bg-blue-100 text-blue-900 rounded-full text-base font-semibold border-2 border-blue-200 shadow transition-colors sm:hidden active:scale-95 active:bg-blue-100",style:{fontFamily:"inherit",letterSpacing:.2,minHeight:56,minWidth:120,touchAction:"manipulation",zIndex:10},children:[e.jsx("span",{className:"material-icons text-lg mr-2",children:"cancel"}),v("cancel",f)]}),e.jsx("div",{className:"flex-1 flex justify-center",children:e.jsx("div",{className:"text-white text-xs sm:text-sm rounded-full px-3 sm:px-4 py-1 shadow-lg border border-white/30 flex items-center justify-center",style:{background:"linear-gradient(135deg, #4e5ab7 0%, #3f51b5 100%)",border:"1.5px solid #fff",boxShadow:"0px 4px 8px rgba(0,0,0,0.15)",fontWeight:700,letterSpacing:1,backdropFilter:"blur(2px)"},children:W(g)})}),e.jsxs("button",{id:"confirmButton",onClick:R,className:"flex items-center justify-center px-4 py-3 bg-[#ffd700] hover:bg-[#ffe066] text-blue-900 rounded-full text-base font-bold border-4 border-[#d4af37] shadow-2xl transition-all duration-200 sm:hidden active:scale-95 active:bg-[#ffe066]",style:{fontFamily:"inherit",letterSpacing:.2,boxShadow:"0 6px 24px 0 rgba(212,175,55,0.25), 0 1.5px 4px 0 rgba(0,0,0,0.12)",borderWidth:4,borderColor:"#d4af37",background:"linear-gradient(180deg, #ffe066 0%, #ffd700 100%)",textShadow:"0 1px 2px #fff, 0 1px 8px #ffd700",minHeight:56,minWidth:200,touchAction:"manipulation",zIndex:10},children:[e.jsx("span",{className:"material-icons text-lg mr-2",children:"send"}),v("confirm",f)]}),e.jsxs("button",{className:"flex items-center justify-center transition-colors",title:"Mic Level",style:{fontSize:22,padding:0,background:"none",border:"none",color:"#d4af37",width:28,height:28},tabIndex:-1,disabled:!0,onMouseOver:n=>n.currentTarget.style.color="#ffd700",onMouseOut:n=>n.currentTarget.style.color="#d4af37",children:[e.jsx("span",{className:"material-icons",children:"graphic_eq"}),e.jsx("span",{className:"ml-1 flex items-end h-4 w-6",children:[...Array(4)].map((n,l)=>e.jsx("span",{style:{display:"inline-block",width:2,height:`${4+Math.round(b/100*12)*(l%2+1)}px`,background:"#d4af37",marginLeft:1,borderRadius:1}},l))})]})]})]}),k&&e.jsxs("div",{id:"realTimeConversation",ref:N,className:"w-full flex flex-col-reverse gap-1 pr-2 relative max-w-full sm:max-w-2xl mx-auto min-h-[60px] max-h-[12vh] overflow-y-auto mb-1",style:{background:"rgba(255,255,255,0.88)",borderRadius:12,border:"1px solid rgba(255,255,255,0.35)",boxShadow:"0px 4px 10px rgba(0,0,0,0.15)",padding:"8px",transition:"box-shadow 0.3s, background 0.3s",fontFamily:"SF Pro Text, Roboto, Open Sans, Arial, sans-serif",fontSize:window.innerWidth<640?14:16,lineHeight:1.5,color:"#222",fontWeight:400,backdropFilter:"blur(2px)",display:"flex",flexDirection:"column",justifyContent:"flex-end"},children:[e.jsx("button",{className:"absolute top-1.5 right-1.5 w-5 h-5 flex items-center justify-center rounded-full bg-white/40 hover:bg-white/70 text-gray-400 hover:text-gray-700 shadow z-10 opacity-60 hover:opacity-90 transition-all",style:{fontSize:14,display:"block"},title:"Ẩn realtime conversation",onClick:()=>F(!1),children:e.jsx("span",{className:"material-icons",style:{fontSize:16},children:"close"})}),e.jsxs("div",{className:"w-full flex flex-col gap-1 pr-2",style:{overflowY:"auto",maxHeight:"28vh"},children:[M.length===0&&e.jsx("div",{className:"text-gray-400 text-base text-center select-none",style:{opacity:.7},children:v("tap_to_speak",f)}),[...M].reverse().map((n,l)=>e.jsx("div",{className:"mb-1",children:e.jsx("div",{className:"flex items-start",children:e.jsx("div",{className:"flex-grow",children:n.role==="user"?e.jsx("p",{className:"text-base md:text-lg font-medium text-gray-900",style:{marginBottom:2},children:n.messages[0].content}):e.jsxs("p",{className:"text-base md:text-lg font-medium",style:{marginBottom:2,position:"relative",background:"linear-gradient(90deg, #FF512F, #F09819, #FFD700, #56ab2f, #43cea2, #1e90ff, #6a11cb, #FF512F)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",fontWeight:600,letterSpacing:.2,transition:"background 0.5s"},children:[e.jsx("span",{className:"inline-flex flex-wrap",children:n.messages.map((d,x)=>{const C=d.content.slice(0,y[d.id]||0);return e.jsxs("span",{style:{whiteSpace:"pre"},children:[C,x===n.messages.length-1&&l===0&&y[d.id]<d.content.length&&e.jsx("span",{className:"animate-blink text-yellow-500",style:{marginLeft:1},children:"|"})]},d.id)})}),l===0&&n.role==="assistant"&&y[n.messages[n.messages.length-1].id]===n.messages[n.messages.length-1].content.length&&e.jsx("span",{className:"ml-2 animate-ellipsis text-yellow-500",children:"..."})]})})})},n.id))]})]}),e.jsx("div",{className:"w-full mt-1 flex-1 flex flex-col",style:{minHeight:"200px",maxHeight:"none",overflowY:"visible",marginBottom:8,flex:"1 1 auto"},children:e.jsx("div",{className:"w-full flex flex-row items-center gap-x-2 mb-3 px-2 overflow-x-auto",style:{flexWrap:"nowrap",overflowX:"auto",WebkitOverflowScrolling:"touch",minHeight:"140px"},children:e.jsx($,{references:a})})})]}),e.jsx("div",{className:"w-1/4 lg:w-1/3 flex-col items-center lg:items-end p-2 space-y-4 overflow-auto hidden sm:flex",style:{maxHeight:"100%"},children:e.jsxs("div",{className:"flex flex-col gap-4 w-full md:w-auto",children:[e.jsxs("button",{id:"endCallButton",onClick:R,className:"w-full md:w-auto bg-[#ffd700] hover:bg-[#ffe066] text-blue-900 font-bold py-3 px-8 rounded-full shadow-2xl flex items-center justify-center space-x-2 transition-all duration-200 border-4 border-[#d4af37] text-base sm:text-lg active:scale-95 active:bg-[#ffe066]",style:{fontFamily:"inherit",letterSpacing:.5,boxShadow:"0 6px 24px 0 rgba(212,175,55,0.25), 0 1.5px 4px 0 rgba(0,0,0,0.12)",borderWidth:4,borderColor:"#d4af37",background:"linear-gradient(180deg, #ffe066 0%, #ffd700 100%)",textShadow:"0 1px 2px #fff, 0 1px 8px #ffd700",minHeight:56,minWidth:220,touchAction:"manipulation",zIndex:10},children:[e.jsx("span",{className:"material-icons",children:"send"}),e.jsx("span",{className:"whitespace-nowrap",children:v("confirm_request",f)})]}),e.jsxs("button",{id:"cancelButtonDesktop",onClick:L,className:"w-full md:w-auto bg-white hover:bg-blue-100 text-blue-900 font-semibold py-3 px-8 rounded-full shadow flex items-center justify-center space-x-2 transition-all duration-200 border-2 border-blue-200 text-base sm:text-lg active:scale-95 active:bg-blue-100",style:{fontFamily:"inherit",letterSpacing:.2,minHeight:56,minWidth:120,touchAction:"manipulation",zIndex:10},children:[e.jsx("span",{className:"material-icons text-lg mr-2",children:"cancel"}),v("cancel",f)]})]})})]})})};export{K as default};
