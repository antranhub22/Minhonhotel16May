import{m as U,r as S,j as e,l as m}from"./index-f38482de.js";const Z="/assets/hotel-exterior-d4150765.jpeg",B={roomNumber:/(?:room(?:\s+number)?|room|phòng)(?:\s*[:#\-]?\s*)([0-9]{1,4}[A-Za-z]?)|(?:staying in|in room|in phòng|phòng số)(?:\s+)([0-9]{1,4}[A-Za-z]?)/i,food:/food|beverage|breakfast|lunch|dinner|meal|drink|snack|restaurant/i,housekeeping:/housekeeping|cleaning|towel|cleaning\s*service|laundry/i,roomService:/room\s*service/i,spa:/spa|massage|wellness|treatment/i,transportation:/transportation|taxi|car|shuttle|airport\s*transfer/i,tours:/tour|sightseeing|excursion|attraction|visit|activity/i,technical:/wifi|internet|tv|television|remote|device|technical|connection/i,concierge:/reservation|booking|restaurant|ticket|arrangement|concierge/i,wellness:/gym|fitness|exercise|yoga|swimming|pool|sauna/i,security:/safe|security|lost|found|key|card|lock|emergency/i,specialOccasion:/birthday|anniversary|celebration|honeymoon|proposal|wedding|special occasion/i,wifi:/wifi|internet|connection|password/i,checkIn:/check\s*-?\s*in|registration/i,checkOut:/check\s*-?\s*out|departure/i,information:/information|hotel\s*info|facilities|amenities/i,feedback:/feedback|suggestion|complaint|comment/i,support:/support|help|assistance|issue/i,other:/currency\s*exchange|money\s*change|exchange\s*money|foreign\s*currency|bus\s*ticket|train\s*ticket|sell|purchase|buy/i,deliveryTime:{asap:/as\s*soon\s*as\s*possible|right\s*away|immediately|asap/i,thirtyMin:/30\s*min|half\s*an\s*hour|30\s*minutes/i,oneHour:/(?:1|one)\s*hour|60\s*minutes/i,specific:/specific\s*time|scheduled|later|tomorrow|tonight|afternoon|evening|morning/i},specialInstructions:/special(?:\s+instructions?|(?:\s+notes?)|(?:\s+requests?))(?:\s*:)?\s*([^\.]+)/i,items:/(?:ordered|requested|asked for|items|item)(?:\s*:)?\s*([^\.]+)/i,totalAmount:/(?:total(?:\s+amount)?|cost|price|charge)(?:\s*:)?\s*\$?\s*([0-9]+(?:\.[0-9]{1,2})?)/i};function A(j){const s=j.match(B.roomNumber);if(s)return s[1]||s[2]||null;const p=j.match(/(?:room details|room number|phòng số)(?:\s*[:#\-]?\s*)([0-9]{1,4}[A-Za-z]?)/i);if(p&&p[1])return p[1];const x=j.match(/(?:details[\s\S]*?room(?:\s+number)?[\s\S]*?)([0-9]{1,4}[A-Za-z]?)/i);return x&&x[1]?x[1]:null}const H=({isActive:j})=>{const{orderSummary:s,setOrderSummary:p,setCurrentInterface:x,setOrder:_,callSummary:n,setCallSummary:O,serviceRequests:N,callDuration:C,callDetails:R,emailSentForCurrentSession:D,setEmailSentForCurrentSession:P,addActiveOrder:M,translateToVietnamese:F,language:l}=U(),[G,L]=S.useState({}),[k,$]=S.useState(""),q=(r,t)=>{s&&p({...s,[r]:t})};S.useEffect(()=>{if(N&&N.length>0){const r=N.reduce((t,i)=>{const o=i.serviceType;return t[o]||(t[o]=[]),t[o].push(i),t},{});if(L(r),s&&(!s.items||s.items.length===0)){const t=N.map((i,o)=>{let d=1;const b=i.details||{},g=i.requestText.match(/(\d+)\s+(towels|bottles|pieces|cups|glasses|plates|servings|items)/i);g?d=parseInt(g[1]):typeof b.people=="number"&&(d=b.people);let u=10;return i.serviceType==="room-service"?u=15:i.serviceType==="housekeeping"?u=8:i.serviceType==="transportation"?u=25:i.serviceType==="tours-activities"?u=35:i.serviceType==="spa"&&(u=30),{id:`item-${o}`,name:i.serviceType,description:i.requestText,quantity:d,price:u}});p({...s,items:t,totalAmount:t.reduce((i,o)=>i+o.price*o.quantity,0)})}}},[N,s,p]),S.useEffect(()=>{if(j&&n&&s){const r=n.content,t=A(r);if(t&&t!==s.roomNumber&&p({...s,roomNumber:t}),!N||N.length===0){const i=r.match(/List of Requests:([\s\S]*?)(?:\n\nSpecial Instructions|\n\nThe conversation)/);if(i){const o=i[1],d=/Request (\d+): ([^\n]+)/g;let b;const g=[];let u=1;for(;(b=d.exec(o))!==null;){const T=b[2].trim(),f=b.index,c=o.indexOf(`Request ${parseInt(b[1])+1}:`,f),w=c>-1?o.substring(f,c):o.substring(f),h=/- ([^:]+): ([^\n]+)/g;let v;const a={};for(;(v=h.exec(w))!==null;){const z=v[1].trim(),V=v[2].trim();a[z.toLowerCase()]=V}let y="";a["service description"]&&(y+=`${a["service description"]}`),a.details&&(y+=y?`. ${a.details}`:a.details),a.items&&(y+=y?`
Items: ${a.items}`:`Items: ${a.items}`),a["service timing requested"]&&(y+=`
Timing: ${a["service timing requested"]}`),a.destinations&&(y+=`
Destinations: ${a.destinations}`),y||(y=`Requested ${T} service`),g.push({id:u.toString(),name:T,description:y,quantity:1,price:10}),u++}if(g.length>0&&(!s.items||s.items.length===0)){const T=g.map(v=>v.name.toLowerCase().replace(/\s+/g,"-")).join(","),f=A(r)||s.roomNumber,c=r.match(/Service Timing Requested:?\s*([^\n]+)/i),w=c?c[1]:s.deliveryTime;let h=s.deliveryTime;w&&(/soon|immediate|urgent|right now/i.test(w)?h="asap":/30 minute|half hour/i.test(w)?h="30min":/hour|60 minute/i.test(w)?h="1hour":/schedule|later|specific/i.test(w)&&(h="specific")),p({...s,items:g,orderType:T,roomNumber:f,deliveryTime:h,totalAmount:g.reduce((v,a)=>v+a.price*a.quantity,0)})}}}}},[j,n,s,p]);const I=async()=>{var o;if(!s)return;const r=`#ORD-${Math.floor(1e4+Math.random()*9e4)}`;let t;switch(s.deliveryTime){case"asap":t="As soon as possible";break;case"30min":t="30 minutes";break;case"1hour":t="1 hour";break;default:t=s.deliveryTime||"15-20 minutes"}if(_({reference:r,estimatedTime:t,summary:s}),M({reference:r,requestedAt:new Date,estimatedTime:t,status:"Đã ghi nhận"}),D){console.log("Email already sent for this session. Skipping duplicate email sending."),x("interface4");return}if(((o=document.querySelector('[data-interface="interface3vi"]'))==null?void 0:o.getAttribute("data-active"))==="true")console.log("Vietnamese interface is active, skipping email send from English interface");else try{console.log("Sending email with call summary and service requests...");let d=(n==null?void 0:n.content)||"";try{d=await F(d)}catch(c){console.error("Failed to translate summary for email:",c)}console.log("Translated summary for email (Vietnamese):",d);const b=C?`${Math.floor(C/60)}:${(C%60).toString().padStart(2,"0")}`:"0:00";console.log("Call duration for email:",b);const g=`call-${Date.now()}`,u=(R==null?void 0:R.id)||g;console.log("Using callId for email:",u),console.log("Call summary content:",(n==null?void 0:n.content)||"No summary available"),console.log("Preparing email request payload...");const T={toEmail:"tuans2@gmail.com",callDetails:{callId:u,roomNumber:s.roomNumber||"unknown",summary:d||"No summary available",timestamp:(n==null?void 0:n.timestamp)||new Date,duration:b,serviceRequests:s.items.map(c=>c.name),orderReference:r,note:k}};console.log("Email payload prepared:",JSON.stringify(T));const f=/iPhone|iPad|iPod|Android|Mobile|webOS|BlackBerry/i.test(navigator.userAgent);console.log("Device type detected:",f?"MOBILE":"DESKTOP"),setTimeout(async()=>{try{const c=f?"/api/mobile-call-summary-email":"/api/send-call-summary-email";console.log(`Using ${f?"mobile":"standard"} endpoint for email: ${c}`);const w=f?`${c}?_=${Date.now()}`:c;console.log("Sending email request to server...");const h=await fetch(w,{method:"POST",headers:{"Content-Type":"application/json","Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0","X-Device-Type":f?"mobile":"desktop"},body:JSON.stringify(T),cache:"no-cache",credentials:"same-origin"});if(!h.ok)throw new Error(`Server responded with status: ${h.status}`);const v=await h.json();console.log("Email sent with order confirmation:",v),P(!0)}catch(c){console.error("Failed to send email in timeout:",c)}},f?50:500)}catch(d){console.error("Failed to send email:",d)}x("interface4")},E=()=>{!k.trim()||!n||O({...n,content:`${n.content}

Additional Notes:
${k}`})};return s?e.jsx("div",{className:`absolute w-full min-h-screen h-full transition-opacity duration-500 ${j?"opacity-100":"opacity-0 pointer-events-none"} z-30 overflow-y-auto`,id:"interface3",style:{backgroundImage:`linear-gradient(rgba(85,154,154,0.7), rgba(121, 219, 220, 0.6)), url(${Z.replace(/\.(jpe?g)$/i,".webp")})`,backgroundSize:"cover",backgroundPosition:"center",fontFamily:"SF Pro Text, Roboto, Open Sans, Arial, sans-serif"},children:e.jsx("div",{className:"container mx-auto flex flex-col p-2 sm:p-4 md:p-8",children:e.jsxs("div",{className:"mx-auto w-full max-w-4xl bg-white/90 rounded-2xl shadow-xl p-3 sm:p-6 md:p-10 mb-4 sm:mb-6 flex-grow border border-white/40 backdrop-blur-md",style:{minHeight:420},children:[e.jsx("div",{className:"mb-3 sm:mb-4 pb-2 sm:pb-3 border-b border-gray-200",children:e.jsx("p",{className:"font-poppins font-bold text-xl sm:text-2xl text-blue-900 tracking-wide",children:m("order_summary",l)})}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 sm:gap-10 md:gap-16",children:[e.jsxs("div",{className:"md:w-3/4 w-full space-y-3 sm:space-y-4",children:[e.jsxs("div",{className:"flex sm:hidden flex-row w-full gap-2 mb-2",children:[e.jsxs("button",{className:"flex-1 flex items-center justify-center px-2 py-1.5 bg-white/80 hover:bg-blue-100 text-blue-900 rounded-full text-xs font-semibold border border-white/30 shadow transition-colors",onClick:()=>x("interface1"),children:[e.jsx("span",{className:"material-icons text-base mr-1",children:"cancel"}),m("cancel",l)]}),e.jsxs("button",{onClick:I,className:"flex-1 bg-[#d4af37] hover:bg-[#ffd700] text-blue-900 font-bold py-1.5 px-3 rounded-full shadow-lg flex items-center justify-center space-x-2 transition-colors border border-white/30 text-xs",style:{letterSpacing:.5},children:[e.jsx("span",{className:"material-icons",children:"send"}),e.jsx("span",{className:"whitespace-nowrap",children:m("send_to_reception",l)})]})]}),e.jsxs("div",{className:"flex flex-col gap-2 mb-2 sm:hidden",children:[e.jsxs("div",{className:"flex flex-row w-full gap-2",children:[e.jsx("button",{className:"h-10 px-3 bg-[#ffe082] hover:bg-[#ffe9b3] text-blue-900 rounded-full text-xs font-semibold shadow transition-colors flex-1",onClick:E,disabled:!k.trim(),children:m("add_note",l)}),e.jsxs("div",{className:"flex items-center space-x-2 w-full justify-center",children:[e.jsx("label",{className:"text-xs text-gray-600 font-medium",children:m("room_number",l)}),e.jsx("input",{type:"text",placeholder:m("enter_room_number",l),className:"w-16 p-2 border border-white/30 rounded-xl focus:ring-2 focus:ring-[#d4af37] focus:border-[#d4af37] bg-white/70 text-gray-900 font-semibold text-xs",value:s.roomNumber,onChange:r=>q("roomNumber",r.target.value)})]}),e.jsx("button",{className:"h-10 px-3 bg-white/70 text-blue-900 rounded-full text-xs font-semibold border border-white/30 shadow flex items-center justify-center",onClick:()=>x("interface3vi"),children:e.jsx("span",{className:"material-icons text-base",children:"language"})})]}),e.jsx("textarea",{placeholder:m("enter_notes",l),className:"w-full p-2 border border-white/30 rounded-xl text-xs bg-white/60 focus:bg-white/90 focus:ring-2 focus:ring-[#d4af37] transition italic font-light text-gray-500",value:k,onChange:r=>$(r.target.value),rows:3,style:{fontFamily:"inherit"}})]}),n&&e.jsxs("div",{id:"summary-container",className:"mb-3 sm:mb-4",children:[e.jsxs("div",{className:"p-3 sm:p-5 bg-white/80 rounded-xl shadow border border-white/30 mb-3 sm:mb-4 relative",style:{backdropFilter:"blur(2px)"},children:[e.jsx("h3",{className:"font-semibold text-base sm:text-lg mb-1 sm:mb-2 text-blue-800",children:m("summary",l)}),e.jsx("div",{className:"text-sm sm:text-base leading-relaxed text-gray-800 whitespace-pre-line",style:{fontWeight:400},children:(()=>(n.content||"").split(`
`).filter(t=>!/^Next Step:/i.test(t)&&!/Please Press Send To Reception/i.test(t)).map((t,i)=>{if(/^Guest's Name/i.test(t)){const o=t.replace(/\s*\(used for Guest with a confirmed reservation\)/i,"");return e.jsx("div",{children:e.jsx("b",{children:o})},i)}return/^Room Number:/i.test(t)?e.jsx("div",{children:e.jsx("b",{children:t})},i):/^REQUEST \d+:/i.test(t)?e.jsx("div",{className:"mt-3 mb-1",children:e.jsx("b",{children:t})},i):/^• Service Timing:/i.test(t)?e.jsx("div",{style:{marginLeft:16},children:e.jsx("b",{children:t})},i):/^• Order Details:/i.test(t)?e.jsx("div",{style:{marginLeft:16},children:e.jsx("b",{children:t})},i):/^• Special Requirements:/i.test(t)?e.jsx("div",{style:{marginLeft:16},children:e.jsx("b",{children:t})},i):/^• [^-].+/.test(t)?e.jsx("div",{style:{marginLeft:32},children:t},i):/^\s*[-•]/.test(t)?e.jsx("div",{style:{marginLeft:32},children:t},i):/^\s*$/.test(t)?e.jsx("div",{style:{height:8}},i):e.jsx("div",{children:t},i)}))()}),e.jsx("div",{className:"mt-2 sm:mt-3 flex justify-end",children:e.jsxs("div",{className:"text-xs text-gray-500",children:[m("generated_at",l)," ",new Date(n.timestamp).toLocaleTimeString()]})})]}),e.jsx("div",{className:"text-center mt-2 mb-1",children:e.jsxs("span",{className:"italic text-sm",style:{color:"#2563eb",background:"#e0f2fe",borderRadius:"6px",padding:"4px 12px",display:"inline-block",fontWeight:500},children:["Please Press ",e.jsx("b",{style:{fontWeight:700,color:"#1d4ed8"},children:"Send To Reception"})," To Complete Your Request"]})})]}),e.jsxs("div",{className:"hidden sm:flex flex-row items-center gap-2 h-10",children:[e.jsx("button",{className:"h-10 px-3 sm:px-4 bg-[#ffe082] hover:bg-[#ffe9b3] text-blue-900 rounded-full text-xs sm:text-sm font-semibold shadow transition-colors",onClick:E,disabled:!k.trim(),children:m("add_note",l)}),e.jsxs("div",{className:"flex items-center space-x-2 w-full justify-center",children:[e.jsx("label",{className:"text-xs sm:text-base text-gray-600 font-medium",children:m("room_number",l)}),e.jsx("input",{type:"text",placeholder:m("enter_room_number",l),className:"w-16 sm:w-32 p-2 border border-white/30 rounded-xl focus:ring-2 focus:ring-[#d4af37] focus:border-[#d4af37] bg-white/70 text-gray-900 font-semibold text-xs sm:text-base",value:s.roomNumber,onChange:r=>q("roomNumber",r.target.value)})]}),e.jsx("button",{className:"h-10 px-3 sm:px-4 bg-white/70 text-blue-900 rounded-full text-xs sm:text-sm font-semibold border border-white/30 shadow flex items-center justify-center",onClick:()=>x("interface3vi"),children:e.jsx("span",{className:"material-icons text-base",children:"language"})})]}),e.jsx("textarea",{placeholder:m("enter_notes",l),className:"hidden sm:block w-full p-2 sm:p-3 border border-white/30 rounded-xl mb-3 sm:mb-4 text-xs sm:text-sm bg-white/60 focus:bg-white/90 focus:ring-2 focus:ring-[#d4af37] transition italic font-light text-gray-500",value:k,onChange:r=>$(r.target.value),rows:3,style:{fontFamily:"inherit"}})]}),e.jsx("div",{className:"md:w-1/4 w-full hidden sm:flex md:justify-end justify-center",children:e.jsxs("div",{className:"flex flex-col items-end space-y-2 sm:space-y-3 w-full md:w-auto",children:[e.jsxs("button",{onClick:I,className:"w-full md:w-auto bg-[#d4af37] hover:bg-[#ffd700] text-blue-900 font-bold py-1.5 sm:py-2 px-3 sm:px-4 rounded-full shadow-lg flex items-center justify-center space-x-2 transition-colors border border-white/30 text-xs sm:text-sm",style:{letterSpacing:.5},children:[e.jsx("span",{className:"material-icons",children:"send"}),e.jsx("span",{className:"whitespace-nowrap",children:m("send_to_reception",l)})]}),e.jsxs("button",{className:"w-full md:w-auto flex items-center justify-center px-2 sm:px-3 py-1.5 bg-white/80 hover:bg-blue-100 text-blue-900 rounded-full text-xs font-semibold border border-white/30 shadow transition-colors",onClick:()=>x("interface1"),children:[e.jsx("span",{className:"material-icons text-base mr-1",children:"cancel"}),m("cancel",l)]})]})})]})]})})}):null};export{H as default};
