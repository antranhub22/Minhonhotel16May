const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/CallHistory-ChEkosKA.js","assets/react-BlJs-Rj_.js","assets/@daily-co-CRt2XSsO.js","assets/@tanstack-H40tjzcj.js","assets/wouter-DSgBA37d.js","assets/regexparam-CPXopyEH.js","assets/use-sync-external-store-T8uco2Ip.js","assets/CallDetails-BQOH_du0.js"])))=>i.map(i=>d[i]);
import{r as o,j as e,R as re}from"./react-BlJs-Rj_.js";import{R as xe,c as We}from"./react-dom-qFx4IFJ8.js";import{L as ve,S as Ve,R as te}from"./wouter-DSgBA37d.js";import{V as we,R as je,A as Ne,C as $e,T as Se,D as ke,P as He}from"./@radix-ui-CPB4_W1N.js";import{c as Xe}from"./class-variance-authority-Dp3B9jqt.js";import{c as Ye}from"./clsx-B-dksMZM.js";import{t as Ue}from"./tailwind-merge-D696Ktp4.js";import{X as Ke,H as Ge,C as Je,a as Te}from"./lucide-react-C5zxFZT4.js";import{_ as Ze}from"./@vapi-ai-DrvmIiYL.js";import{F as Qe,a as Ce,b as et}from"./react-icons-BiSlUIlK.js";import{S as tt,N as st,P as nt,A as rt,a as ot}from"./swiper-CfFrfE8b.js";import{u as it}from"./react-router-DvHbwIsR.js";import{B as at}from"./react-router-dom-BMXKYxTf.js";import{A as ct,m as se}from"./framer-motion-D-KcTbXR.js";import{Q as lt,a as dt}from"./@tanstack-H40tjzcj.js";import"./@daily-co-CRt2XSsO.js";import"./scheduler-DYLXRpC5.js";import"./regexparam-CPXopyEH.js";import"./use-sync-external-store-T8uco2Ip.js";import"./events-CXH2uRM3.js";import"./@remix-run-DBo92Irb.js";import"./motion-dom-DQ71eQN1.js";import"./motion-utils-UsaZgHOw.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const u of a)if(u.type==="childList")for(const h of u.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&r(h)}).observe(document,{childList:!0,subtree:!0});function s(a){const u={};return a.integrity&&(u.integrity=a.integrity),a.referrerPolicy&&(u.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?u.credentials="include":a.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function r(a){if(a.ep)return;a.ep=!0;const u=s(a);fetch(a.href,u)}})();const mt="modulepreload",ut=function(n){return"/"+n},pe={},Ee=function(t,s,r){let a=Promise.resolve();if(s&&s.length>0){document.getElementsByTagName("link");const h=document.querySelector("meta[property=csp-nonce]"),c=(h==null?void 0:h.nonce)||(h==null?void 0:h.getAttribute("nonce"));a=Promise.allSettled(s.map(m=>{if(m=ut(m),m in pe)return;pe[m]=!0;const E=m.endsWith(".css"),v=E?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${m}"]${v}`))return;const T=document.createElement("link");if(T.rel=E?"stylesheet":mt,E||(T.as="script"),T.crossOrigin="",T.href=m,c&&T.setAttribute("nonce",c),document.head.appendChild(T),E)return new Promise((C,N)=>{T.addEventListener("load",C),T.addEventListener("error",()=>N(new Error(`Unable to preload CSS for ${m}`)))})}))}function u(h){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=h,window.dispatchEvent(c),!c.defaultPrevented)throw h}return a.then(h=>{for(const c of h||[])c.status==="rejected"&&u(c.reason);return t().catch(u)})};class ht extends o.Component{constructor(t){super(t),this.state={hasError:!1,error:null}}static getDerivedStateFromError(t){return{hasError:!0,error:t}}componentDidCatch(t,s){console.error("Uncaught error in component tree:",t,s)}render(){return this.state.hasError?e.jsx("div",{className:"flex items-center justify-center h-screen p-4 bg-gray-50",children:e.jsxs("div",{className:"max-w-md text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-red-600 mb-2",children:"Something went wrong."}),e.jsx("p",{className:"text-gray-700 mb-4",children:"An unexpected error occurred. Please try refreshing the page or contact support if the problem persists."}),e.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:"Reload Page"})]})}):this.props.children}}const xt=1,pt=1e6;let le=0;function ft(){return le=(le+1)%Number.MAX_SAFE_INTEGER,le.toString()}const de=new Map,fe=n=>{if(de.has(n))return;const t=setTimeout(()=>{de.delete(n),ne({type:"REMOVE_TOAST",toastId:n})},pt);de.set(n,t)},gt=(n,t)=>{switch(t.type){case"ADD_TOAST":return{...n,toasts:[t.toast,...n.toasts].slice(0,xt)};case"UPDATE_TOAST":return{...n,toasts:n.toasts.map(s=>s.id===t.toast.id?{...s,...t.toast}:s)};case"DISMISS_TOAST":{const{toastId:s}=t;return s?fe(s):n.toasts.forEach(r=>{fe(r.id)}),{...n,toasts:n.toasts.map(r=>r.id===s||s===void 0?{...r,open:!1}:r)}}case"REMOVE_TOAST":return t.toastId===void 0?{...n,toasts:[]}:{...n,toasts:n.toasts.filter(s=>s.id!==t.toastId)}}},ie=[];let ae={toasts:[]};function ne(n){ae=gt(ae,n),ie.forEach(t=>{t(ae)})}function bt({...n}){const t=ft(),s=a=>ne({type:"UPDATE_TOAST",toast:{...a,id:t}}),r=()=>ne({type:"DISMISS_TOAST",toastId:t});return ne({type:"ADD_TOAST",toast:{...n,id:t,open:!0,onOpenChange:a=>{a||r()}}}),{id:t,dismiss:r,update:s}}function _t(){const[n,t]=o.useState(ae);return o.useEffect(()=>(ie.push(t),()=>{const s=ie.indexOf(t);s>-1&&ie.splice(s,1)}),[n]),{...n,toast:bt,dismiss:s=>ne({type:"DISMISS_TOAST",toastId:s})}}function U(...n){return Ue(Ye(n))}const yt=He,Re=o.forwardRef(({className:n,...t},s)=>e.jsx(we,{ref:s,className:U("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",n),...t}));Re.displayName=we.displayName;const vt=Xe("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-dark",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),Me=o.forwardRef(({className:n,variant:t,...s},r)=>e.jsx(je,{ref:r,className:U(vt({variant:t}),n),...s}));Me.displayName=je.displayName;const wt=o.forwardRef(({className:n,...t},s)=>e.jsx(Ne,{ref:s,className:U("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",n),...t}));wt.displayName=Ne.displayName;const De=o.forwardRef(({className:n,...t},s)=>e.jsx($e,{ref:s,className:U("absolute right-2 top-2 rounded-md p-1 text-dark/50 opacity-0 transition-opacity hover:text-dark focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",n),"toast-close":"",...t,children:e.jsx(Ke,{className:"h-4 w-4"})}));De.displayName=$e.displayName;const Ie=o.forwardRef(({className:n,...t},s)=>e.jsx(Se,{ref:s,className:U("text-sm font-semibold",n),...t}));Ie.displayName=Se.displayName;const Ae=o.forwardRef(({className:n,...t},s)=>e.jsx(ke,{ref:s,className:U("text-sm opacity-90",n),...t}));Ae.displayName=ke.displayName;function jt(){const{toasts:n}=_t();return e.jsxs(yt,{children:[n.map(function({id:t,title:s,description:r,action:a,...u}){return e.jsxs(Me,{...u,children:[e.jsxs("div",{className:"grid gap-1",children:[s&&e.jsx(Ie,{children:s}),r&&e.jsx(Ae,{children:r})]}),a,e.jsx(De,{})]},t)}),e.jsx(Re,{})]})}const Nt=!1;let Y=null;const Pe=async n=>{try{return Y||(Y=new Ze(n),Y.on("call-start",()=>{console.log("Call started")}),Y.on("call-end",()=>{console.log("Call ended")}),Y.on("speech-start",()=>{console.log("Speech started")}),Y.on("speech-end",()=>{console.log("Speech ended")}),Y.on("volume-level",t=>{console.log(`Volume level: ${t}`)}),Y.on("message",t=>{console.log("Message received:",t)}),Y.on("error",t=>{console.error("Error:",t)}),Y)}catch(t){throw console.error("Failed to initialize Vapi:",t),t}},oe=()=>Y,$t={orderType:"Room Service",deliveryTime:"asap",roomNumber:"",guestName:"",guestEmail:"",guestPhone:"",specialInstructions:"",items:[{id:"1",name:"Club Sandwich",description:"Served with french fries and side salad",quantity:1,price:15},{id:"2",name:"Fresh Orange Juice",description:"Large size",quantity:1,price:8}],totalAmount:23},Fe=o.createContext(void 0);function Le({children:n}){const[t,s]=o.useState("interface1"),[r,a]=o.useState([]),[u,h]=o.useState(null),[c,m]=o.useState(null),[E,v]=o.useState(null),[T,C]=o.useState(0),[N,p]=o.useState(null),[M,x]=o.useState(!1),[d,S]=o.useState(null),[y,$]=o.useState([]),[D,j]=o.useState(null),[l,k]=o.useState(!1),[F,B]=o.useState(null),[g,b]=o.useState(()=>{if(typeof window>"u")return[];try{const q=localStorage.getItem("activeOrders");return q?JSON.parse(q).map(V=>({...V,requestedAt:new Date(V.requestedAt)})):[]}catch(q){return console.error("Failed to parse activeOrders from localStorage",q),[]}}),[_,I]=o.useState(0),[z,L]=o.useState([]),[P,R]=o.useState("en");o.useEffect(()=>{if(!(typeof window>"u"))try{localStorage.setItem("activeOrders",JSON.stringify(g))}catch{console.error("Failed to persist activeOrders to localStorage")}},[g]);const H=q=>{b(O=>[...O,{...q,status:q.status||"Đã ghi nhận"}])},W=re.useCallback(q=>{const O={...q,id:Date.now(),callId:(c==null?void 0:c.id)||`call-${Date.now()}`,timestamp:new Date};a(V=>[...V,O])},[c==null?void 0:c.id]);o.useEffect(()=>((async()=>{try{throw new Error("Vapi public key is not configured")}catch(O){console.error("Error setting up Vapi:",O)}})(),()=>{const O=oe();O&&O.stop()}),[]),o.useEffect(()=>{if(t==="interface2"){console.log("Starting call duration timer in interface2");const q=setInterval(()=>{C(O=>{const V=O+1;return console.log("Call duration updated:",V),V})},1e3);p(q)}else N&&(console.log("Clearing call duration timer when leaving interface2"),clearInterval(N),p(null));return()=>{N&&(console.log("Cleaning up call duration timer"),clearInterval(N))}},[t,N]);const X=()=>{const q=oe();q&&(q.setMuted(!M),x(!M))},Z=re.useCallback(async()=>{try{k(!1);const q=`call-${Date.now()}`;m({id:q,roomNumber:"",duration:"0",category:""}),a([]),L([]);const O=oe();if(!O){console.error("Vapi instance not initialized");return}const V=void 0;if(!V){console.error("Assistant ID not configured");return}if(!await O.start(V)){console.error("Failed to start call - call object is null");return}console.log("Call started successfully"),C(0);const i=setInterval(()=>{C(f=>f+1)},1e3);p(i),s("interface2")}catch(q){console.error("Error starting call:",q)}},[]),Q=o.useCallback(()=>{try{const q=oe();q&&q.stop();const O=()=>{N&&(clearInterval(N),p(null)),h($t);const V=T?`${Math.floor(T/60)}:${(T%60).toString().padStart(2,"0")}`:"0:00",ee=r.map(f=>({role:f.role,content:f.content}));if(ee.length<2){const f={id:Date.now(),callId:(c==null?void 0:c.id)||`call-${Date.now()}`,content:"Call was too short to generate a summary. Please try a more detailed conversation.",timestamp:new Date};S(f),s("interface3");return}const i={id:Date.now(),callId:(c==null?void 0:c.id)||`call-${Date.now()}`,content:"Generating AI summary of your conversation...",timestamp:new Date};S(i),fetch("/api/store-summary",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({summary:"",transcripts:ee,timestamp:new Date().toISOString(),callId:(c==null?void 0:c.id)||`call-${Date.now()}`,callDuration:V,forceBasicSummary:Nt,language:P})}).then(f=>{if(!f.ok)throw new Error(`Network response was not ok: ${f.status}`);return f.json()}).then(f=>{if(f.success&&f.summary&&f.summary.content){const A=f.summary.content;xe.unstable_batchedUpdates(()=>{const J={id:Date.now(),callId:(c==null?void 0:c.id)||`call-${Date.now()}`,content:A,timestamp:new Date(f.summary.timestamp||Date.now())};S(J),f.serviceRequests&&Array.isArray(f.serviceRequests)&&f.serviceRequests.length>0&&$(f.serviceRequests),s("interface3")})}}).catch(f=>{console.error("Error processing summary:",f);const A={id:Date.now(),callId:(c==null?void 0:c.id)||`call-${Date.now()}`,content:"An error occurred while generating the call summary.",timestamp:new Date};S(A),s("interface3")})};xe.unstable_batchedUpdates(O)}catch(q){console.error("Error in endCall:",q),s("interface1")}},[N,T,r,c,S,s,$,P]),ce={currentInterface:t,setCurrentInterface:s,transcripts:r,setTranscripts:a,addTranscript:W,orderSummary:u,setOrderSummary:h,callDetails:c,setCallDetails:m,order:E,setOrder:v,callDuration:T,setCallDuration:C,isMuted:M,toggleMute:X,startCall:Z,endCall:Q,callSummary:d,setCallSummary:S,serviceRequests:y,setServiceRequests:$,vietnameseSummary:D,setVietnameseSummary:j,translateToVietnamese:async q=>{try{console.log("Requesting Vietnamese translation for summary...");const O=await fetch("/api/translate-to-vietnamese",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:q})});if(!O.ok)throw new Error(`Network response was not ok: ${O.status}`);const V=await O.json();if(V.success&&V.translatedText)return j(V.translatedText),V.translatedText;throw new Error("Translation failed")}catch(O){return console.error("Error translating to Vietnamese:",O),"Không thể dịch nội dung này sang tiếng Việt. Vui lòng thử lại sau."}},emailSentForCurrentSession:l,setEmailSentForCurrentSession:k,requestReceivedAt:F,setRequestReceivedAt:B,activeOrders:g,addActiveOrder:H,micLevel:_,modelOutput:z,setModelOutput:L,addModelOutput:q=>{L(O=>[...O,q])},language:P,setLanguage:R};return e.jsx(Fe.Provider,{value:ce,children:n})}function G(){const n=o.useContext(Fe);if(n===void 0)throw new Error("useAssistant must be used within an AssistantProvider");return n}const Oe="/assets/hotel-exterior-BsmmGNZ1.jpeg",St="Mi Nhon Hotel Mui Ne",kt="AI-powered Voice Assistant - Supporting All Your Needs",Tt="Press to Call",Ct="Room & Stay",Et="Room Services",Rt="Bookings & Facilities",Mt="Tourism & Exploration",Dt="Support to book external services",It="Order Ref",At="Requested At",Pt="Estimated Completion",Ft="Time Remaining",Lt="Mute",Ot="Unmute",qt="Confirm",Bt="Please speak to the assistant first.",zt="Tap to speak",Wt="Order Summary",Vt="Send to Reception",Ht="Add Note",Xt="Room Number",Yt="Enter room number",Ut="Enter additional notes",Kt="Summary",Gt="Generated at",Jt="Order Confirmed!",Zt="Your request has been confirmed and forwarded to our staff. They will process it right away.",Qt="Order Reference",es="Estimated delivery time:",ts="Return to Home",ss="Language",ns="English",rs="French",os="Send",is="Cancel",as="Confirm your request",cs="Room",ls="Order ID",ds="Guest Name",ms="Content",us="Time",hs="Status",xs="Action",ps="Message Guest",fs="Staff Request Management",gs="Login",bs="Username",_s="Password",ys="Tap the call button to start your request.",vs="Review and confirm your request for accuracy.",ws="Your request will be sent to the reception for processing.",js="Acknowledged",Ns="In Progress",$s="Delivering to You",Ss="Completed",ks="Special Note",Ts="Check-in/Check-out",Cs="Extended Stay Request",Es="Room Information",Rs="Hotel Policies",Ms="Wi-Fi Services",Ds="Room Service Food",Is="Drinks & Bar Service",As="Room Cleaning",Ps="Laundry Service",Fs="Wake-up Call",Ls="Additional Amenities",Os="Maintenance Request",qs="Restaurant Reservation",Bs="Spa Services",zs="Fitness Center",Ws="Swimming Pool",Vs="Car Rental",Hs="Medical Assistance",Xs="Customer Support",Ys="Local Attractions",Us="Local Restaurants",Ks="Public Transportation",Gs="Local Events",Js="Shopping Areas",Zs="Area Maps",Qs="Translation Services",en="Leave a Review",tn="Report an Issue",sn="Luggage Services",nn={hotel_name:St,hotel_subtitle:kt,press_to_call:Tt,room_and_stay:Ct,room_services:Et,bookings_and_facilities:Rt,tourism_and_exploration:Mt,support_external_services:Dt,order_ref:It,requested_at:At,estimated_completion:Pt,time_remaining:Ft,mute:Lt,unmute:Ot,confirm:qt,need_conversation:Bt,tap_to_speak:zt,order_summary:Wt,send_to_reception:Vt,add_note:Ht,room_number:Xt,enter_room_number:Yt,enter_notes:Ut,summary:Kt,generated_at:Gt,order_confirmed:Jt,order_confirmed_message:Zt,order_reference:Qt,estimated_delivery_time:es,return_to_home:ts,language:ss,english:ns,french:rs,send:os,cancel:is,confirm_request:as,room:cs,order_id:ls,guest_name:ds,content:ms,time:us,status:hs,action:xs,message_guest:ps,request_management:fs,login:gs,username:bs,password:_s,press_to_call_desc:ys,confirm_request_desc:vs,send_to_reception_desc:ws,status_acknowledged:js,status_in_progress:Ns,status_delivering:$s,status_completed:Ss,status_note:ks,icon_login:Ts,icon_hourglass_empty:Cs,icon_info:Es,icon_policy:Rs,icon_wifi:Ms,icon_restaurant:Ds,icon_local_bar:Is,icon_cleaning_services:As,icon_local_laundry_service:Ps,icon_alarm:Fs,icon_add_circle:Ls,icon_build:Os,icon_event_seat:qs,icon_spa:Bs,icon_fitness_center:zs,icon_pool:Ws,icon_directions_car:Vs,icon_medical_services:Hs,icon_support_agent:Xs,icon_location_on:Ys,icon_local_dining:Us,icon_directions_bus:Ks,icon_event:Gs,icon_shopping_bag:Js,icon_map:Zs,icon_translate:Qs,icon_rate_review:en,icon_report_problem:tn,icon_luggage:sn},rn="Bienvenue à Mi Nhon Hotel",on="Commencer",an="Langue",cn="Anglais",ln="Français",dn="Envoyer",mn="Annuler",un="Confirmer la demande",hn="Chambre",xn="ID de commande",pn="Nom du client",fn="Contenu",gn="Heure",bn="Statut",_n="Action",yn="Message au client",vn="Gestion des demandes du personnel",wn="Connexion",jn="Nom d'utilisateur",Nn="Mot de passe",$n="Hôtel Mi Nhon Mui Ne",Sn="Assistant vocal IA - À votre service pour tous vos besoins",kn="Appuyez pour appeler",Tn="Chambre & Séjour",Cn="Services de chambre",En="Réservations & Installations",Rn="Tourisme & Exploration",Mn="Assistance pour services externes",Dn="Réf. commande",In="Demandé à",An="Fin estimée",Pn="Temps restant",Fn="Muet",Ln="Rétablir le son",On="Confirmer",qn="Veuillez d'abord parler avec l'assistant.",Bn="Appuyez pour parler",zn="Récapitulatif de la commande",Wn="Envoyer à la réception",Vn="Ajouter une note",Hn="Numéro de chambre",Xn="Saisir le numéro de chambre",Yn="Saisir des notes supplémentaires",Un="Résumé",Kn="Généré à",Gn="Commande confirmée !",Jn="Votre demande a été confirmée et transmise à notre personnel. Elle sera traitée immédiatement.",Zn="Référence de la commande",Qn="Heure de livraison estimée :",er="Retour à l'accueil",tr="Appuyez sur le bouton d'appel pour démarrer votre demande.",sr="Vérifiez et confirmez votre demande pour plus de précision.",nr="Votre demande sera envoyée à la réception pour traitement.",rr="Reçue",or="En cours",ir="En livraison",ar="Terminée",cr="Note spéciale",lr="Arrivée/Départ",dr="Prolongation de séjour",mr="Informations sur la chambre",ur="Politiques de l'hôtel",hr="Services Wi-Fi",xr="Service de restauration",pr="Service de bar",fr="Nettoyage de chambre",gr="Service de blanchisserie",br="Service de réveil",_r="Aménités supplémentaires",yr="Demande de maintenance",vr="Réservation au restaurant",wr="Services de spa",jr="Centre de fitness",Nr="Piscine",$r="Location de voiture",Sr="Assistance médicale",kr="Service client",Tr="Attractions locales",Cr="Restaurants locaux",Er="Transports publics",Rr="Événements locaux",Mr="Zones commerciales",Dr="Cartes de la région",Ir="Services de traduction",Ar="Laisser un avis",Pr="Signaler un problème",Fr="Services de bagagerie",Lr={welcome:rn,start:on,language:an,english:cn,french:ln,send:dn,cancel:mn,confirm_request:un,room:hn,order_id:xn,guest_name:pn,content:fn,time:gn,status:bn,action:_n,message_guest:yn,request_management:vn,login:wn,username:jn,password:Nn,hotel_name:$n,hotel_subtitle:Sn,press_to_call:kn,room_and_stay:Tn,room_services:Cn,bookings_and_facilities:En,tourism_and_exploration:Rn,support_external_services:Mn,order_ref:Dn,requested_at:In,estimated_completion:An,time_remaining:Pn,mute:Fn,unmute:Ln,confirm:On,need_conversation:qn,tap_to_speak:Bn,order_summary:zn,send_to_reception:Wn,add_note:Vn,room_number:Hn,enter_room_number:Xn,enter_notes:Yn,summary:Un,generated_at:Kn,order_confirmed:Gn,order_confirmed_message:Jn,order_reference:Zn,estimated_delivery_time:Qn,return_to_home:er,press_to_call_desc:tr,confirm_request_desc:sr,send_to_reception_desc:nr,status_acknowledged:rr,status_in_progress:or,status_delivering:ir,status_completed:ar,status_note:cr,icon_login:lr,icon_hourglass_empty:dr,icon_info:mr,icon_policy:ur,icon_wifi:hr,icon_restaurant:xr,icon_local_bar:pr,icon_cleaning_services:fr,icon_local_laundry_service:gr,icon_alarm:br,icon_add_circle:_r,icon_build:yr,icon_event_seat:vr,icon_spa:wr,icon_fitness_center:jr,icon_pool:Nr,icon_directions_car:$r,icon_medical_services:Sr,icon_support_agent:kr,icon_location_on:Tr,icon_local_dining:Cr,icon_directions_bus:Er,icon_event:Rr,icon_shopping_bag:Mr,icon_map:Dr,icon_translate:Ir,icon_rate_review:Ar,icon_report_problem:Pr,icon_luggage:Fr},Or="欢迎来到美农酒店 (Mi Nhon Hotel)",qr="开始",Br="语言",zr="英语",Wr="法语",Vr="发送",Hr="取消",Xr="确认请求",Yr="房间",Ur="订单编号",Kr="客人姓名",Gr="内容",Jr="时间",Zr="状态",Qr="操作",eo="给客人的消息",to="员工请求管理",so="登录",no="用户名",ro="密码",oo="美农酒店 Mui Ne",io="AI语音助手 - 满足您的所有需求",ao="按下呼叫",co="房间与住宿",lo="客房服务",mo="预订与设施",uo="旅游与探索",ho="支持外部服务",xo="订单参考",po="请求时间",fo="预计完成时间",go="剩余时间",bo="静音",_o="取消静音",yo="确认",vo="请先与助手对话。",wo="点击说话",jo="订单摘要",No="发送到前台",$o="添加备注",So="房间号",ko="输入房间号",To="输入附加备注",Co="摘要",Eo="生成时间",Ro="订单已确认！",Mo="您的请求已确认并发送给我们的员工。我们会立即处理。",Do="订单参考",Io="预计送达时间：",Ao="返回首页",Po="点击呼叫按钮开始您的请求。",Fo="请检查并确认您的请求以确保准确。",Lo="您的请求将被发送到前台进行处理。",Oo="已确认",qo="处理中",Bo="配送中",zo="已完成",Wo="特别说明",Vo="入住/退房",Ho="延长住宿请求",Xo="房间信息",Yo="酒店政策",Uo="无线网络服务",Ko="客房餐饮服务",Go="饮品与酒吧服务",Jo="房间清洁",Zo="洗衣服务",Qo="唤醒服务",ei="额外设施",ti="维修请求",si="餐厅预订",ni="水疗服务",ri="健身中心",oi="游泳池",ii="租车服务",ai="医疗援助",ci="客户支持",li="当地景点",di="当地餐厅",mi="公共交通",ui="当地活动",hi="购物区域",xi="区域地图",pi="翻译服务",fi="留下评论",gi="报告问题",bi="行李服务",_i={welcome:Or,start:qr,language:Br,english:zr,french:Wr,send:Vr,cancel:Hr,confirm_request:Xr,room:Yr,order_id:Ur,guest_name:Kr,content:Gr,time:Jr,status:Zr,action:Qr,message_guest:eo,request_management:to,login:so,username:no,password:ro,hotel_name:oo,hotel_subtitle:io,press_to_call:ao,room_and_stay:co,room_services:lo,bookings_and_facilities:mo,tourism_and_exploration:uo,support_external_services:ho,order_ref:xo,requested_at:po,estimated_completion:fo,time_remaining:go,mute:bo,unmute:_o,confirm:yo,need_conversation:vo,tap_to_speak:wo,order_summary:jo,send_to_reception:No,add_note:$o,room_number:So,enter_room_number:ko,enter_notes:To,summary:Co,generated_at:Eo,order_confirmed:Ro,order_confirmed_message:Mo,order_reference:Do,estimated_delivery_time:Io,return_to_home:Ao,press_to_call_desc:Po,confirm_request_desc:Fo,send_to_reception_desc:Lo,status_acknowledged:Oo,status_in_progress:qo,status_delivering:Bo,status_completed:zo,status_note:Wo,icon_login:Vo,icon_hourglass_empty:Ho,icon_info:Xo,icon_policy:Yo,icon_wifi:Uo,icon_restaurant:Ko,icon_local_bar:Go,icon_cleaning_services:Jo,icon_local_laundry_service:Zo,icon_alarm:Qo,icon_add_circle:ei,icon_build:ti,icon_event_seat:si,icon_spa:ni,icon_fitness_center:ri,icon_pool:oi,icon_directions_car:ii,icon_medical_services:ai,icon_support_agent:ci,icon_location_on:li,icon_local_dining:di,icon_directions_bus:mi,icon_event:ui,icon_shopping_bag:hi,icon_map:xi,icon_translate:pi,icon_rate_review:fi,icon_report_problem:gi,icon_luggage:bi},yi="Добро пожаловать в отель Mi Nhon",vi="Начать",wi="Язык",ji="Английский",Ni="Французский",$i="Русский",Si="Отправить",ki="Отмена",Ti="Подтвердить запрос",Ci="Номер",Ei="ID заказа",Ri="Имя гостя",Mi="Содержание",Di="Время",Ii="Статус",Ai="Действие",Pi="Сообщение гостю",Fi="Управление запросами персонала",Li="Вход",Oi="Имя пользователя",qi="Пароль",Bi="Отель Mi Nhon Mui Ne",zi="ИИ-ассистент - Поддержка всех ваших потребностей",Wi="Нажмите для звонка",Vi="Номер и проживание",Hi="Услуги номера",Xi="Бронирование и удобства",Yi="Туризм и исследование",Ui="Поддержка внешних услуг",Ki="Ссылка на заказ",Gi="Запрошено в",Ji="Предполагаемое завершение",Zi="Оставшееся время",Qi="Без звука",ea="Включить звук",ta="Подтвердить",sa="Пожалуйста, сначала поговорите с ассистентом.",na="Нажмите, чтобы говорить",ra="Сводка заказа",oa="Отправить на ресепшен",ia="Добавить заметку",aa="Номер комнаты",ca="Введите номер комнаты",la="Введите дополнительные заметки",da="Сводка",ma="Сгенерировано в",ua="Заказ подтвержден!",ha="Ваш запрос подтвержден и передан нашему персоналу. Они обработают его немедленно.",xa="Ссылка на заказ",pa="Предполагаемое время доставки:",fa="Вернуться на главную",ga="Нажмите кнопку вызова, чтобы начать ваш запрос.",ba="Проверьте и подтвердите ваш запрос для точности.",_a="Ваш запрос будет отправлен на ресепшен для обработки.",ya="Подтверждено",va="В процессе",wa="Доставляется",ja="Завершено",Na="Особая заметка",$a="Регистрация/Выселение",Sa="Запрос на продление проживания",ka="Информация о номере",Ta="Правила отеля",Ca="Wi-Fi услуги",Ea="Ресторанное обслуживание номеров",Ra="Напитки и бар",Ma="Уборка номера",Da="Услуги прачечной",Ia="Услуга будильника",Aa="Дополнительные удобства",Pa="Запрос на техническое обслуживание",Fa="Бронирование ресторана",La="СПА услуги",Oa="Фитнес-центр",qa="Бассейн",Ba="Аренда автомобиля",za="Медицинская помощь",Wa="Поддержка клиентов",Va="Местные достопримечательности",Ha="Местные рестораны",Xa="Общественный транспорт",Ya="Местные мероприятия",Ua="Торговые зоны",Ka="Карты местности",Ga="Услуги перевода",Ja="Оставить отзыв",Za="Сообщить о проблеме",Qa="Услуги багажа",ec={welcome:yi,start:vi,language:wi,english:ji,french:Ni,russian:$i,send:Si,cancel:ki,confirm_request:Ti,room:Ci,order_id:Ei,guest_name:Ri,content:Mi,time:Di,status:Ii,action:Ai,message_guest:Pi,request_management:Fi,login:Li,username:Oi,password:qi,hotel_name:Bi,hotel_subtitle:zi,press_to_call:Wi,room_and_stay:Vi,room_services:Hi,bookings_and_facilities:Xi,tourism_and_exploration:Yi,support_external_services:Ui,order_ref:Ki,requested_at:Gi,estimated_completion:Ji,time_remaining:Zi,mute:Qi,unmute:ea,confirm:ta,need_conversation:sa,tap_to_speak:na,order_summary:ra,send_to_reception:oa,add_note:ia,room_number:aa,enter_room_number:ca,enter_notes:la,summary:da,generated_at:ma,order_confirmed:ua,order_confirmed_message:ha,order_reference:xa,estimated_delivery_time:pa,return_to_home:fa,press_to_call_desc:ga,confirm_request_desc:ba,send_to_reception_desc:_a,status_acknowledged:ya,status_in_progress:va,status_delivering:wa,status_completed:ja,status_note:Na,icon_login:$a,icon_hourglass_empty:Sa,icon_info:ka,icon_policy:Ta,icon_wifi:Ca,icon_restaurant:Ea,icon_local_bar:Ra,icon_cleaning_services:Ma,icon_local_laundry_service:Da,icon_alarm:Ia,icon_add_circle:Aa,icon_build:Pa,icon_event_seat:Fa,icon_spa:La,icon_fitness_center:Oa,icon_pool:qa,icon_directions_car:Ba,icon_medical_services:za,icon_support_agent:Wa,icon_location_on:Va,icon_local_dining:Ha,icon_directions_bus:Xa,icon_event:Ya,icon_shopping_bag:Ua,icon_map:Ka,icon_translate:Ga,icon_rate_review:Ja,icon_report_problem:Za,icon_luggage:Qa},tc="미년 호텔에 오신 것을 환영합니다",sc="시작",nc="언어",rc="영어",oc="프랑스어",ic="러시아어",ac="한국어",cc="보내기",lc="취소",dc="요청 확인",mc="객실",uc="주문 ID",hc="투숙객 이름",xc="내용",pc="시간",fc="상태",gc="동작",bc="게스트에게 메시지 보내기",_c="직원 요청 관리",yc="로그인",vc="사용자 이름",wc="비밀번호",jc="미년 무이네 호텔",Nc="AI 어시스턴트 - 모든 필요를 지원합니다",$c="호출하려면 누르세요",Sc="객실 및 숙박",kc="객실 서비스",Tc="예약 및 시설",Cc="관광 및 탐험",Ec="외부 서비스 지원",Rc="주문 참조",Mc="요청 시간",Dc="예상 완료 시간",Ic="남은 시간",Ac="음소거",Pc="음소거 해제",Fc="확인",Lc="먼저 어시스턴트와 대화해 주세요.",Oc="말하려면 누르세요",qc="주문 요약",Bc="프런트로 보내기",zc="메모 추가",Wc="객실 번호",Vc="객실 번호를 입력하세요",Hc="추가 메모를 입력하세요",Xc="요약",Yc="생성 시간",Uc="주문이 확인되었습니다!",Kc="귀하의 요청이 확인되어 직원에게 전달되었습니다. 즉시 처리하겠습니다.",Gc="주문 참조",Jc="예상 배달 시간:",Zc="홈으로 돌아가기",Qc="요청을 시작하려면 호출 버튼을 누르세요.",el="정확성을 위해 요청을 확인하세요.",tl="귀하의 요청이 프런트로 전송되어 처리됩니다.",sl="접수됨",nl="처리 중",rl="배달 중",ol="완료됨",il="특별 안내",al="체크인/체크아웃",cl="숙박 연장 요청",ll="객실 정보",dl="호텔 정책",ml="와이파이 서비스",ul="룸서비스 음식",hl="음료 및 바 서비스",xl="객실 청소",pl="세탁 서비스",fl="모닝콜 서비스",gl="추가 편의 시설",bl="유지보수 요청",_l="레스토랑 예약",yl="스파 서비스",vl="피트니스 센터",wl="수영장",jl="렌터카",Nl="의료 지원",$l="고객 지원",Sl="지역 명소",kl="지역 레스토랑",Tl="대중교통",Cl="지역 이벤트",El="쇼핑 지역",Rl="지역 지도",Ml="번역 서비스",Dl="리뷰 남기기",Il="문제 신고",Al="수화물 서비스",Pl={welcome:tc,start:sc,language:nc,english:rc,french:oc,russian:ic,korean:ac,send:cc,cancel:lc,confirm_request:dc,room:mc,order_id:uc,guest_name:hc,content:xc,time:pc,status:fc,action:gc,message_guest:bc,request_management:_c,login:yc,username:vc,password:wc,hotel_name:jc,hotel_subtitle:Nc,press_to_call:$c,room_and_stay:Sc,room_services:kc,bookings_and_facilities:Tc,tourism_and_exploration:Cc,support_external_services:Ec,order_ref:Rc,requested_at:Mc,estimated_completion:Dc,time_remaining:Ic,mute:Ac,unmute:Pc,confirm:Fc,need_conversation:Lc,tap_to_speak:Oc,order_summary:qc,send_to_reception:Bc,add_note:zc,room_number:Wc,enter_room_number:Vc,enter_notes:Hc,summary:Xc,generated_at:Yc,order_confirmed:Uc,order_confirmed_message:Kc,order_reference:Gc,estimated_delivery_time:Jc,return_to_home:Zc,press_to_call_desc:Qc,confirm_request_desc:el,send_to_reception_desc:tl,status_acknowledged:sl,status_in_progress:nl,status_delivering:rl,status_completed:ol,status_note:il,icon_login:al,icon_hourglass_empty:cl,icon_info:ll,icon_policy:dl,icon_wifi:ml,icon_restaurant:ul,icon_local_bar:hl,icon_cleaning_services:xl,icon_local_laundry_service:pl,icon_alarm:fl,icon_add_circle:gl,icon_build:bl,icon_event_seat:_l,icon_spa:yl,icon_fitness_center:vl,icon_pool:wl,icon_directions_car:jl,icon_medical_services:Nl,icon_support_agent:$l,icon_location_on:Sl,icon_local_dining:kl,icon_directions_bus:Tl,icon_event:Cl,icon_shopping_bag:El,icon_map:Rl,icon_translate:Ml,icon_rate_review:Dl,icon_report_problem:Il,icon_luggage:Al},Fl={en:nn,fr:Lr,zh:_i,ru:ec,ko:Pl};function w(n,t="en"){return Fl[t][n]||n}const Ll=({isActive:n})=>{const{setCurrentInterface:t,setTranscripts:s,setModelOutput:r,setCallDetails:a,setCallDuration:u,setEmailSentForCurrentSession:h,activeOrders:c,language:m,setLanguage:E}=G(),[v,T]=o.useState(null),[C,N]=o.useState(new Date);o.useEffect(()=>{const y=setInterval(()=>N(new Date),1e3);return()=>clearInterval(y)},[]);const p=async y=>{h(!1),a({id:`call-${Date.now()}`,roomNumber:"",duration:"0",category:""}),s([]),r([]),u(0);let $,D;(y==="fr"||y==="zh"||y==="ru"||y==="ko")&&($=void 0,D=void 0);const j=await Pe($);j&&D&&(await j.start(D),t("interface2"))},M=y=>{T(v===y?null:y),v!==y&&setTimeout(()=>{T($=>$===y?null:$)},3e3)},x=({iconName:y,className:$})=>e.jsxs("div",{className:"relative flex flex-col items-center justify-center cursor-pointer",children:[e.jsx("span",{className:`material-icons text-xl sm:text-4xl text-[#F9BF3B] ${$||""}`,style:{filter:"drop-shadow(0px 2px 3px rgba(0, 0, 0, 0.2))"},onClick:()=>M(y),children:y}),v===y&&e.jsxs("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-max max-w-[120px] sm:max-w-[180px] bg-white/90 text-gray-800 text-xs sm:text-sm font-medium py-1 px-2 rounded shadow-lg z-50 pointer-events-none text-center",children:[w(`icon_${y}`,m),e.jsx("div",{className:"absolute w-2 h-2 bg-white/90 transform rotate-45 left-1/2 -translate-x-1/2 top-full -mt-1"})]})]}),d=y=>{if(!y)return"bg-gray-300 text-gray-800";switch(y){case"Đã ghi nhận":return"bg-gray-300 text-gray-800";case"Đang thực hiện":return"bg-yellow-200 text-yellow-800";case"Đã thực hiện và đang bàn giao cho khách":return"bg-blue-200 text-blue-800";case"Hoàn thiện":return"bg-green-200 text-green-800";case"Lưu ý khác":return"bg-red-200 text-red-800";default:return"bg-gray-300 text-gray-800"}},S=y=>{if(!y)return"status_acknowledged";switch(y){case"Đã ghi nhận":return"status_acknowledged";case"Đang thực hiện":return"status_in_progress";case"Đã thực hiện và đang bàn giao cho khách":return"status_delivering";case"Hoàn thiện":return"status_completed";case"Lưu ý khác":return"status_note";default:return"status_acknowledged"}};return e.jsx("div",{className:`absolute w-full min-h-screen h-full transition-opacity duration-500 ${n?"opacity-100":"opacity-0 pointer-events-none"} z-10 overflow-y-auto`,id:"interface1",style:{backgroundImage:`linear-gradient(rgba(26, 35, 126, 0.7), rgba(121, 219, 220, 0.6)), url(${Oe})`,backgroundSize:"cover",backgroundPosition:"center",perspective:"1000px"},children:e.jsxs("div",{className:"container mx-auto flex flex-col items-center justify-start text-white p-3 pt-6 sm:p-5 sm:pt-10 lg:pt-16 overflow-visible pb-32 sm:pb-24",style:{transform:"translateZ(20px)",minHeight:"fit-content"},children:[e.jsxs("div",{className:"flex items-center justify-center sm:justify-end w-full max-w-2xl mb-4 sm:mb-2",children:[e.jsxs("button",{onClick:()=>window.location.reload(),className:"flex items-center justify-center mr-3 px-3 py-2 sm:py-1.5 bg-white/80 hover:bg-yellow-100 border border-amber-400 rounded-full shadow transition-all duration-200 text-blue-900 font-bold text-base sm:text-lg",style:{minWidth:40,minHeight:40},title:"Refresh",children:[e.jsx("span",{className:"material-icons text-xl sm:text-2xl mr-1 text-amber-400",children:"refresh"}),e.jsx("span",{className:"hidden sm:inline font-semibold",children:"Refresh"})]}),e.jsxs("div",{className:"flex items-center px-3 py-2 sm:py-1.5 gap-2 transition-all duration-300 mx-auto sm:mx-0",style:{background:"linear-gradient(135deg, #4e5ab7 0%, #3f51b5 100%)",boxShadow:"0px 4px 8px rgba(0, 0, 0, 0.15)",borderRadius:"8px",minWidth:"150px",maxWidth:"95%",width:"auto",border:"1px solid rgba(255, 255, 255, 0.1)"},children:[e.jsx(Qe,{className:"text-[#F9BF3B] text-xl mr-1.5",style:{filter:"drop-shadow(0px 2px 3px rgba(0, 0, 0, 0.2))"}}),e.jsxs("label",{className:"mr-2 font-semibold font-sans text-white whitespace-nowrap text-sm sm:text-base",children:[w("language",m),":"]}),e.jsxs("div",{className:"relative flex-1",children:[e.jsxs("select",{value:m,onChange:y=>E(y.target.value),className:"appearance-none w-full pl-6 sm:pl-8 pr-6 py-1 sm:py-1.5 font-sans bg-transparent focus:outline-none transition-all duration-200",style:{fontWeight:600,color:"#fff",textShadow:"0px 1px 2px rgba(0, 0, 0, 0.2)",borderRadius:"8px"},children:[e.jsx("option",{value:"en",children:"🇬🇧 English"}),e.jsx("option",{value:"fr",children:"🇫🇷 Français"}),e.jsx("option",{value:"zh",children:"🇨🇳 中文"}),e.jsx("option",{value:"ru",children:"🇷🇺 Русский"}),e.jsx("option",{value:"ko",children:"🇰🇷 한국어"})]}),e.jsx(Ce,{className:"absolute right-2 top-1/2 -translate-y-1/2 text-[#F9BF3B] pointer-events-none text-lg"})]})]})]}),e.jsx("h2",{className:"font-poppins font-bold text-2xl sm:text-3xl lg:text-4xl text-amber-400 mb-2 text-center",style:{textShadow:"0px 1px 2px rgba(0, 0, 0, 0.2)"},children:w("hotel_name",m)}),e.jsx("p",{className:"text-xs sm:text-lg lg:text-xl text-center max-w-full mb-4 truncate sm:whitespace-nowrap overflow-x-auto",children:w("hotel_subtitle",m)}),e.jsxs("div",{className:"relative mb-4 sm:mb-12 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 rounded-full border-4 border-amber-400 animate-[ripple_1.5s_linear_infinite] pointer-events-none transition-opacity duration-300 group-hover:opacity-80 opacity-60"}),e.jsx("div",{className:"absolute inset-0 rounded-full border-4 border-amber-400/70 animate-[ripple_2s_linear_infinite] pointer-events-none transition-opacity duration-300 group-hover:opacity-60 opacity-40"}),e.jsxs("button",{id:`vapiButton${m==="en"?"En":m==="fr"?"Fr":m==="zh"?"Zh":m==="ru"?"Ru":"Ko"}`,className:"group relative w-36 h-36 sm:w-40 sm:h-40 lg:w-56 lg:h-56 rounded-full font-poppins font-bold flex flex-col items-center justify-center overflow-hidden hover:translate-y-[-2px] hover:shadow-[0px_12px_20px_rgba(0,0,0,0.2)]",onClick:()=>p(m),style:{background:m==="en"?"linear-gradient(180deg, rgba(85,154,154,0.9) 0%, rgba(85,154,154,0.9) 100%)":m==="fr"?"linear-gradient(180deg, rgba(59, 130, 246, 0.9) 0%, rgba(37, 99, 235, 0.9) 100%)":m==="zh"?"linear-gradient(180deg, rgba(220, 38, 38, 0.9) 0%, rgba(185, 28, 28, 0.9) 100%)":m==="ru"?"linear-gradient(180deg, rgba(79, 70, 229, 0.9) 0%, rgba(67, 56, 202, 0.9) 100%)":"linear-gradient(180deg, rgba(16, 185, 129, 0.9) 0%, rgba(5, 150, 105, 0.9) 100%)",boxShadow:"0px 12px 24px rgba(0, 0, 0, 0.25), 0px 6px 12px rgba(0, 0, 0, 0.15), inset 0px 1px 0px rgba(255, 255, 255, 0.3)",border:"1px solid rgba(255, 255, 255, 0.5)",transition:"all 0.3s ease",transform:"translateY(0) translateZ(30px)"},children:[e.jsx("span",{className:"material-icons text-4xl sm:text-6xl lg:text-7xl mb-2 text-[#F9BF3B] transition-all duration-300 group-hover:scale-110",style:{filter:"drop-shadow(0px 2px 3px rgba(0, 0, 0, 0.2))",color:m==="en"?"#F9BF3B":m==="fr"?"#FFFFFF":m==="zh"?"#FFEB3B":m==="ru"?"#F48FB1":"#4ADE80"},children:"mic"}),m==="fr"?e.jsx("span",{className:"text-sm sm:text-lg lg:text-2xl font-bold text-white px-2 text-center",style:{textShadow:"0px 1px 2px rgba(0, 0, 0, 0.2)"},children:w("press_to_call",m)}):m==="ru"||m==="ko"?e.jsx("span",{className:"text-sm sm:text-lg lg:text-xl font-bold text-white px-2 text-center",style:{textShadow:"0px 1px 2px rgba(0, 0, 0, 0.2)"},children:w("press_to_call",m)}):e.jsx("span",{className:"text-lg sm:text-2xl lg:text-3xl font-bold whitespace-nowrap text-white",style:{textShadow:"0px 1px 2px rgba(0, 0, 0, 0.2)"},children:w("press_to_call",m)}),e.jsx("span",{className:"absolute w-full h-full rounded-full pointer-events-none"})]})]}),e.jsx("div",{className:"text-center w-full max-w-5xl mb-10 sm:mb-8",style:{perspective:"1000px"},children:e.jsxs("div",{className:"flex flex-col md:flex-row md:flex-wrap justify-center gap-y-2 sm:gap-y-2 md:gap-3 text-left mx-auto w-full",children:[e.jsxs("div",{className:"p-0.5 py-0 sm:p-2 w-4/5 mx-auto md:w-64 mb-2 sm:mb-0 min-h-[36px] transition-all duration-250 hover:scale-103 hover:-translate-y-1",style:{background:"rgba(85,154,154,0.7)",backdropFilter:"blur(8px)",borderRadius:"12px",boxShadow:"0px 10px 25px rgba(0, 0, 0, 0.15)",border:"1px solid rgba(255, 255, 255, 0.18)",transform:"translateZ(20px)"},children:[e.jsx("h4",{className:"font-medium text-amber-400 pb-0 mb-0.5 text-xs sm:text-sm",style:{borderBottom:"1px solid rgba(255, 255, 255, 0.1)",textShadow:"0px 1px 2px rgba(0, 0, 0, 0.2)"},children:w("room_and_stay",m)}),e.jsxs("ul",{className:"grid grid-cols-5 gap-0 sm:gap-2 py-0.5 sm:py-2",children:[e.jsx("li",{children:e.jsx(x,{iconName:"login"})}),e.jsx("li",{children:e.jsx(x,{iconName:"hourglass_empty"})}),e.jsx("li",{children:e.jsx(x,{iconName:"info"})}),e.jsx("li",{children:e.jsx(x,{iconName:"policy"})}),e.jsx("li",{children:e.jsx(x,{iconName:"wifi"})})]})]}),e.jsxs("div",{className:"p-0.5 py-0 sm:p-2 w-4/5 mx-auto md:w-64 mb-2 sm:mb-0 min-h-[36px] transition-all duration-250 hover:scale-103 hover:-translate-y-1",style:{background:"rgba(85,154,154,0.7)",backdropFilter:"blur(8px)",borderRadius:"12px",boxShadow:"0px 10px 25px rgba(0, 0, 0, 0.15)",border:"1px solid rgba(255, 255, 255, 0.18)",transform:"translateZ(20px)"},children:[e.jsx("h4",{className:"font-medium text-amber-400 pb-0 mb-0.5 text-xs sm:text-sm",style:{borderBottom:"1px solid rgba(255, 255, 255, 0.1)",textShadow:"0px 1px 2px rgba(0, 0, 0, 0.2)"},children:w("room_services",m)}),e.jsxs("ul",{className:"grid grid-cols-7 gap-0 sm:gap-2 py-0.5 sm:py-2",children:[e.jsx("li",{children:e.jsx(x,{iconName:"restaurant"})}),e.jsx("li",{children:e.jsx(x,{iconName:"local_bar"})}),e.jsx("li",{children:e.jsx(x,{iconName:"cleaning_services"})}),e.jsx("li",{children:e.jsx(x,{iconName:"local_laundry_service"})}),e.jsx("li",{children:e.jsx(x,{iconName:"alarm"})}),e.jsx("li",{children:e.jsx(x,{iconName:"add_circle"})}),e.jsx("li",{children:e.jsx(x,{iconName:"build"})})]})]}),e.jsxs("div",{className:"p-0.5 py-0 sm:p-2 w-4/5 mx-auto md:w-64 mb-2 sm:mb-0 min-h-[36px] transition-all duration-250 hover:scale-103 hover:-translate-y-1",style:{background:"rgba(85,154,154,0.7)",backdropFilter:"blur(8px)",borderRadius:"12px",boxShadow:"0px 10px 25px rgba(0, 0, 0, 0.15)",border:"1px solid rgba(255, 255, 255, 0.18)",transform:"translateZ(20px)"},children:[e.jsx("h4",{className:"font-medium text-amber-400 pb-0 mb-0.5 text-xs sm:text-sm",style:{borderBottom:"1px solid rgba(255, 255, 255, 0.1)",textShadow:"0px 1px 2px rgba(0, 0, 0, 0.2)"},children:w("bookings_and_facilities",m)}),e.jsxs("ul",{className:"grid grid-cols-7 gap-0 sm:gap-2 py-0.5 sm:py-2",children:[e.jsx("li",{children:e.jsx(x,{iconName:"event_seat"})}),e.jsx("li",{children:e.jsx(x,{iconName:"spa"})}),e.jsx("li",{children:e.jsx(x,{iconName:"fitness_center"})}),e.jsx("li",{children:e.jsx(x,{iconName:"pool"})}),e.jsx("li",{children:e.jsx(x,{iconName:"directions_car"})}),e.jsx("li",{children:e.jsx(x,{iconName:"medical_services"})}),e.jsx("li",{children:e.jsx(x,{iconName:"support_agent"})})]})]}),e.jsxs("div",{className:"p-0.5 py-0 sm:p-2 w-4/5 mx-auto md:w-64 mb-2 sm:mb-0 min-h-[36px] transition-all duration-250 hover:scale-103 hover:-translate-y-1",style:{background:"rgba(85,154,154,0.7)",backdropFilter:"blur(8px)",borderRadius:"12px",boxShadow:"0px 10px 25px rgba(0, 0, 0, 0.15)",border:"1px solid rgba(255, 255, 255, 0.18)",transform:"translateZ(20px)"},children:[e.jsx("h4",{className:"font-medium text-amber-400 pb-0 mb-0.5 text-xs sm:text-sm",style:{borderBottom:"1px solid rgba(255, 255, 255, 0.1)",textShadow:"0px 1px 2px rgba(0, 0, 0, 0.2)"},children:w("tourism_and_exploration",m)}),e.jsxs("ul",{className:"grid grid-cols-7 gap-0 sm:gap-2 py-0.5 sm:py-2",children:[e.jsx("li",{children:e.jsx(x,{iconName:"location_on"})}),e.jsx("li",{children:e.jsx(x,{iconName:"local_dining"})}),e.jsx("li",{children:e.jsx(x,{iconName:"directions_bus"})}),e.jsx("li",{children:e.jsx(x,{iconName:"directions_car"})}),e.jsx("li",{children:e.jsx(x,{iconName:"event"})}),e.jsx("li",{children:e.jsx(x,{iconName:"shopping_bag"})}),e.jsx("li",{children:e.jsx(x,{iconName:"map"})})]})]}),e.jsxs("div",{className:"p-0.5 py-0 sm:p-2 w-4/5 mx-auto md:w-64 mb-4 sm:mb-0 min-h-[36px] transition-all duration-250 hover:scale-103 hover:-translate-y-1",style:{background:"rgba(85,154,154,0.7)",backdropFilter:"blur(8px)",borderRadius:"12px",boxShadow:"0px 10px 25px rgba(0,0,0,0.15)",border:"1px solid rgba(255,255,255,0.18)",transform:"translateZ(20px)"},children:[e.jsx("h4",{className:"font-medium text-amber-400 pb-0 mb-0.5 text-xs sm:text-sm",style:{borderBottom:"1px solid rgba(255, 255, 255, 0.1)",textShadow:"0px 1px 2px rgba(0, 0, 0, 0.2)"},children:w("support_external_services",m)}),e.jsxs("ul",{className:"grid grid-cols-4 gap-0 sm:gap-2 py-0.5 sm:py-2",children:[e.jsx("li",{children:e.jsx(x,{iconName:"translate"})}),e.jsx("li",{children:e.jsx(x,{iconName:"rate_review"})}),e.jsx("li",{children:e.jsx(x,{iconName:"report_problem"})}),e.jsx("li",{children:e.jsx(x,{iconName:"luggage"})})]})]})]})}),c&&c.length>0&&e.jsx("div",{className:"flex flex-col items-center gap-y-4 mb-20 pb-16 w-full px-2 sm:mb-12 sm:pb-8 sm:flex-row sm:flex-nowrap sm:gap-x-4 sm:overflow-x-auto sm:justify-start",style:{perspective:"1000px",zIndex:30},children:[...c].sort((y,$)=>$.requestedAt.getTime()-y.requestedAt.getTime()).map(y=>{const $=new Date(y.requestedAt.getTime()+36e5),D=Math.max(Math.ceil(($.getTime()-C.getTime())/1e3),0);if(D<=0)return null;const j=Math.floor(D/60).toString().padStart(2,"0"),l=(D%60).toString().padStart(2,"0");return e.jsxs("div",{className:"p-2 sm:p-3 text-gray-800 max-w-xs w-[220px] flex-shrink-0 transition-all duration-250 hover:rotate-1 hover:scale-105",style:{background:"rgba(255, 255, 255, 0.85)",backdropFilter:"blur(8px)",borderRadius:"24px",boxShadow:"0px 10px 25px rgba(0, 0, 0, 0.15)",border:"1px solid rgba(255, 255, 255, 0.4)",transform:"translateZ(20px)",transformStyle:"preserve-3d",zIndex:20,marginBottom:"8px",transition:"all 0.3s ease-in-out"},children:[e.jsx("div",{className:"flex justify-center items-center mb-1.5",children:e.jsx("span",{className:"font-bold text-lg text-blue-800 bg-blue-50 px-4 py-1.5 rounded-full shadow-sm",style:{borderRadius:"16px",boxShadow:"0px 2px 6px rgba(0, 0, 0, 0.1)"},children:`${j}:${l}`})}),e.jsxs("p",{className:"text-xs sm:text-sm mb-0.5 px-1.5",children:[e.jsxs("strong",{children:[w("order_ref",m),":"]})," ",y.reference]}),e.jsxs("p",{className:"text-xs sm:text-sm mb-0.5 px-1.5",children:[e.jsxs("strong",{children:[w("requested_at",m),":"]})," ",y.requestedAt.toLocaleString("en-US",{timeZone:"Asia/Ho_Chi_Minh",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})]}),e.jsxs("p",{className:"text-xs sm:text-sm mb-0.5 px-1.5",children:[e.jsxs("strong",{children:[w("estimated_completion",m),":"]})," ",y.estimatedTime]}),e.jsx("div",{className:"mt-2 flex justify-center",children:e.jsx("span",{className:`px-2 py-1 text-xs font-semibold ${d(y.status)} w-full text-center`,style:{borderRadius:"16px",boxShadow:"0px 1px 4px rgba(0, 0, 0, 0.1)",transition:"all 0.2s ease"},children:w(S(y.status),m)})})]},y.reference)})})]})})},ge=["Landmark","Hotel Amenities","Local Cuisine","Area Map","Activity and Experiences","Tours","Transportation","Dining"],Ol=({references:n})=>{const[t,s]=o.useState({}),[r,a]=o.useState(!0),[u,h]=o.useState(null),[c,m]=o.useState(ge[0]),[E,v]=o.useState(null);o.useEffect(()=>{a(!0),h(null);let d=0,S=0;if(n.length===0){a(!1);return}n.forEach(y=>{y.type==="document"&&y.url.endsWith(".txt")&&!t[y.url]?fetch(y.url).then($=>{if(!$.ok)throw new Error(`Failed to fetch document: ${$.statusText}`);return $.text()}).then($=>{s(D=>({...D,[y.url]:$})),d++,d+S===n.length&&a(!1)}).catch($=>{console.error(`Error fetching document ${y.url}:`,$),S++,d+S===n.length&&(a(!1),h("Some documents could not be loaded. Please try again later."))}):(d++,d+S===n.length&&a(!1))}),n.every(y=>y.type!=="document"||!y.url.endsWith(".txt"))&&a(!1)},[n]);const T=d=>/^https?:\/\//.test(d)?d:`/${d.replace(/^\//,"")}`,C=async(d,S)=>{try{const $=await(await fetch(T(d))).blob(),D=URL.createObjectURL($),j=document.createElement("a");j.href=D,j.download=S,document.body.appendChild(j),j.click(),document.body.removeChild(j),URL.revokeObjectURL(D)}catch(y){console.error("Error downloading file:",y)}},N=d=>{window.open(T(d),"_blank")},p=d=>e.jsxs("div",{className:"group bg-white/90 rounded-xl shadow-md h-[180px] flex flex-col justify-between cursor-pointer transition-all duration-200 hover:scale-[1.03] active:scale-95 hover:shadow-xl border border-white/40 backdrop-blur-md focus-within:ring-2 focus-within:ring-blue-400",style:{minWidth:220,maxWidth:260},onClick:()=>d.type==="link"?N(d.url):void 0,tabIndex:0,children:[e.jsxs("div",{className:"flex-1 flex items-center justify-center overflow-hidden rounded-t-xl transition-all duration-200 group-hover:shadow-lg",style:{height:"60%"},children:[d.type==="image"&&e.jsxs("picture",{children:[e.jsx("source",{srcSet:T(d.url).replace(/\.(jpe?g|png)$/i,".webp"),type:"image/webp"}),e.jsx("img",{src:T(d.url),alt:d.title,className:"object-cover w-full h-full rounded-t-xl hover:opacity-80 transition-all duration-200 cursor-zoom-in",onClick:S=>{S.stopPropagation(),v(T(d.url))},tabIndex:0,onKeyDown:S=>{(S.key==="Enter"||S.key===" ")&&v(T(d.url))},loading:"lazy"})]}),d.type==="document"&&d.url.endsWith(".pdf")&&e.jsx("span",{className:"material-icons text-5xl text-blue-700/80",children:"picture_as_pdf"}),d.type==="document"&&d.url.endsWith(".txt")&&e.jsx("span",{className:"material-icons text-5xl text-green-700/80",children:"description"}),d.type==="link"&&e.jsx("span",{className:"material-icons text-5xl text-yellow-700/80",children:"link"})]}),e.jsxs("div",{className:"flex flex-col gap-1 px-3 py-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-base font-medium text-gray-900 truncate",children:d.title}),d.type==="document"&&e.jsx("button",{onClick:S=>{S.stopPropagation(),C(d.url,d.title)},className:"ml-auto p-1 rounded-full hover:bg-yellow-100 text-yellow-700 transition-colors transition-all duration-200 focus:ring-2 focus:ring-yellow-400",tabIndex:0,"aria-label":"Tải xuống tài liệu",children:e.jsx("span",{className:"material-icons text-base",children:"download"})}),d.type==="link"&&e.jsx("span",{className:"material-icons text-xs text-gray-400 ml-1",children:"open_in_new"})]}),d.description&&e.jsx("span",{className:"text-xs text-gray-500 truncate",children:d.description}),d.url.endsWith(".txt")&&t[d.url]&&e.jsxs("pre",{className:"mt-1 max-h-12 overflow-auto whitespace-pre-wrap text-xs text-gray-700 bg-gray-50 rounded p-1",children:[t[d.url].slice(0,120),"..."]})]})]}),M=()=>window.innerWidth<640?"auto":window.innerWidth<1024?2:window.innerWidth<1280?3:4,x=n.filter(d=>d.category&&d.category.trim().toLowerCase()===c.trim().toLowerCase());return e.jsxs("div",{className:"w-full max-w-5xl mx-auto mt-2 mb-2 px-2 py-3 rounded-2xl",style:{background:"rgba(85,154,154,0.85)",minHeight:260},children:[E&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm transition-all duration-300",onClick:()=>v(null),children:e.jsxs("div",{className:"relative max-w-3xl w-full flex flex-col items-center",children:[e.jsx("button",{className:"absolute top-2 right-2 bg-white/80 hover:bg-white text-gray-800 rounded-full p-2 shadow-lg z-10 focus:ring-2 focus:ring-blue-400 transition-all duration-200",onClick:d=>{d.stopPropagation(),v(null)},"aria-label":"Đóng lightbox",children:e.jsx("span",{className:"material-icons text-2xl",children:"close"})}),e.jsxs("picture",{children:[e.jsx("source",{srcSet:E?E.replace(/\.(jpe?g|png)$/i,".webp"):"",type:"image/webp"}),e.jsx("img",{src:E||"",alt:"Phóng to ảnh reference",className:"rounded-xl max-h-[80vh] w-auto object-contain border-4 border-white shadow-2xl transition-all duration-300",onClick:d=>d.stopPropagation(),loading:"lazy"})]})]})}),e.jsx("div",{className:"flex items-center mb-4 px-2",children:e.jsxs("div",{className:"flex items-center px-3 py-2 sm:py-1.5 gap-2 transition-all duration-300 mx-auto sm:mx-0",style:{background:"linear-gradient(135deg, #4e5ab7 0%, #3f51b5 100%)",boxShadow:"0px 4px 8px rgba(0, 0, 0, 0.15)",borderRadius:"8px",minWidth:"150px",maxWidth:"95%",width:"auto",border:"1px solid rgba(255, 255, 255, 0.1)"},children:[e.jsx(et,{className:"text-[#F9BF3B] text-xl mr-1.5",style:{filter:"drop-shadow(0px 2px 3px rgba(0, 0, 0, 0.2))"}}),e.jsx("label",{className:"mr-2 font-semibold font-sans text-white whitespace-nowrap text-sm sm:text-base",children:"Category:"}),e.jsxs("div",{className:"relative flex-1",children:[e.jsx("select",{value:c,onChange:d=>m(d.target.value),className:"appearance-none w-full pl-6 sm:pl-8 pr-6 py-1 sm:py-1.5 font-sans bg-transparent focus:outline-none transition-all duration-200",style:{fontWeight:600,color:"#fff",textShadow:"0px 1px 2px rgba(0, 0, 0, 0.2)",borderRadius:"8px"},children:ge.map(d=>e.jsx("option",{value:d,className:"bg-blue-800 text-white",children:d},d))}),e.jsx(Ce,{className:"absolute right-2 top-1/2 -translate-y-1/2 text-[#F9BF3B] pointer-events-none text-lg"})]})]})}),r&&e.jsxs("div",{className:"flex items-center justify-center p-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"}),e.jsx("span",{className:"ml-2",children:"Loading references..."})]}),u&&e.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded relative mb-4",role:"alert",children:[e.jsx("strong",{className:"font-bold",children:"Error: "}),e.jsx("span",{className:"block sm:inline",children:u})]}),!r&&!u&&x.length===0?e.jsx("div",{className:"flex items-center justify-center h-[120px] text-white/80 text-base font-medium",children:"No references available"}):e.jsx(tt,{modules:[st,nt,rt],spaceBetween:16,slidesPerView:M(),navigation:x.length>3,pagination:{clickable:!0,dynamicBullets:!0},className:"w-full",style:{paddingBottom:32},children:x.map((d,S)=>e.jsx(ot,{className:"flex justify-center",style:window.innerWidth<640?{width:240,maxWidth:280,minWidth:200}:{},children:p(d)},d.url+S))})]})};class ql{constructor(t){this.gradientRotation=0,this.isHovered=!1,this.isActive=!1,this.waveformPhase=0,this.particles=[],this.mouseX=0,this.mouseY=0,this.isDarkMode=!1,this.elapsedTime=0,this.displayedTime=0,this.timeTarget=60,this.idleFrame=0,this.lastActiveTime=Date.now(),this.idleFlash=0,this.canvas=document.createElement("canvas");const s=document.getElementById(t);if(!s)throw new Error("Container element not found");s.appendChild(this.canvas);const r=this.canvas.getContext("2d");if(!r)throw new Error("Could not get canvas context");this.ctx=r,this.width=200,this.height=200,this.centerX=this.width/2,this.centerY=this.height/2,this.radius=40,this.ripples=[],this.isListening=!1,this.pulsePhase=0,this.volumeLevel=0,this.animationFrameId=0,this.resize(),this.animate(),window.addEventListener("resize",this.resize.bind(this)),s&&(s.addEventListener("mouseenter",()=>{this.isHovered=!0,this.lastActiveTime=Date.now()}),s.addEventListener("mouseleave",()=>{this.isHovered=!1,this.isActive=!1}),s.addEventListener("mousedown",()=>{this.isActive=!0,this.lastActiveTime=Date.now()}),s.addEventListener("mouseup",()=>{this.isActive=!1}),s.addEventListener("mousemove",a=>{const u=s.getBoundingClientRect();this.mouseX=a.clientX-u.left,this.mouseY=a.clientY-u.top,this.lastActiveTime=Date.now()})),this.isDarkMode=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",a=>{this.isDarkMode=a.matches})}resize(){const t=this.canvas.parentElement;if(!t)return;const s=window.devicePixelRatio||1,r=Math.min(t.clientWidth,t.clientHeight);this.width=this.height=r,this.canvas.width=this.canvas.height=r*s,this.canvas.style.width=this.canvas.style.height=`${r}px`,this.canvas.style.borderRadius="50%",this.canvas.style.overflow="hidden",this.ctx.setTransform(1,0,0,1,0,0),this.ctx.scale(s,s),this.centerX=this.width/2,this.centerY=this.height/2}drawTexturePattern(){const t="rgba(232,181,84,0.18)";for(let r=-this.radius;r<this.radius;r+=14)for(let a=-this.radius;a<this.radius;a+=14)r*r+a*a<this.radius*this.radius*.85&&(this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(this.centerX+r,this.centerY+a,1.2,0,Math.PI*2),this.ctx.fillStyle=t,this.ctx.fill(),this.ctx.restore())}drawLightBeam(){if(!(this.isHovered||this.isActive))return;this.ctx.save();const t=this.ctx.createLinearGradient(this.centerX,this.centerY-this.radius*1.3,this.centerX,this.centerY+this.radius*.5);t.addColorStop(0,"rgba(255,255,255,0.22)"),t.addColorStop(.5,"rgba(255,255,255,0.08)"),t.addColorStop(1,"rgba(255,255,255,0)"),this.ctx.beginPath(),this.ctx.ellipse(this.centerX,this.centerY-this.radius*.7,this.radius*.7,this.radius*.22,0,0,2*Math.PI),this.ctx.fillStyle=t,this.ctx.filter="blur(2.5px)",this.ctx.fill(),this.ctx.filter="none",this.ctx.restore()}drawBaseCircle(){let t=0,s=0;this.isHovered&&(t=(this.mouseX-this.centerX)*.07,s=(this.mouseY-this.centerY)*.07),this.gradientRotation+=.0025;const r=this.gradientRotation%(2*Math.PI),a=this.centerX+Math.cos(r)*this.radius*1.2,u=this.centerY+Math.sin(r)*this.radius*1.2,h=this.ctx.createLinearGradient(this.centerX-this.radius*1.2+t,this.centerY-this.radius*1.2+s,a+t,u+s);h.addColorStop(0,this.isDarkMode?"#559A9A":"#5DB6B9"),h.addColorStop(1,this.isDarkMode?"#559A9A":"#5DB6B9"),this.ctx.save(),this.ctx.globalAlpha=.85,this.ctx.beginPath(),this.ctx.arc(this.centerX+t,this.centerY+s,this.radius*1.25,0,Math.PI*2),this.ctx.strokeStyle=h,this.ctx.lineWidth=12,this.ctx.shadowColor=(this.isHovered,"#559A9A"),this.ctx.shadowBlur=this.isHovered?32:16,this.ctx.stroke(),this.ctx.restore(),this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(this.centerX+t,this.centerY+s,this.radius*1.13,0,Math.PI*2),this.ctx.fillStyle=this.isDarkMode?"rgba(40,50,80,0.18)":"rgba(255,255,255,0.10)",this.ctx.filter="blur(2.5px)",this.ctx.fill(),this.ctx.filter="none",this.ctx.restore(),this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(this.centerX+t,this.centerY+s,this.radius*.98,0,Math.PI*2),this.ctx.fillStyle=this.isDarkMode?"#bfa133":"#E8B554",this.ctx.shadowColor=this.isDarkMode?"rgba(85,154,154,0.18)":"rgba(85,154,154,0.25)",this.ctx.shadowBlur=10,this.ctx.fill(),this.ctx.restore(),this.drawTexturePattern(),this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(this.centerX+t,this.centerY+s,this.radius*.98,0,Math.PI*2),this.ctx.shadowColor=this.isDarkMode?"rgba(85,154,154,0.10)":"rgba(85,154,154,0.18)",this.ctx.shadowBlur=24,this.ctx.globalAlpha=.7,this.ctx.strokeStyle="rgba(0,0,0,0)",this.ctx.lineWidth=8,this.ctx.stroke(),this.ctx.restore(),this.drawLightBeam(),this.drawMicIcon(t,s)}drawMicIcon(t=0,s=0){let r=.85+.15*Math.sin(this.pulsePhase*1.5);this.isHovered&&(r*=1.08),this.isActive&&(r*=.95),this.ctx.save(),this.ctx.translate(this.centerX+t,this.centerY+s),this.ctx.scale(r,r),this.ctx.shadowColor=this.isHovered?"rgba(255,255,255,0.95)":"rgba(255,255,255,0.7)",this.ctx.shadowBlur=16+8*r+(this.isHovered?8:0),this.ctx.beginPath(),this.ctx.moveTo(0,18),this.ctx.arc(0,0,18,Math.PI*.15,Math.PI*1.85,!1),this.ctx.lineTo(0,18),this.ctx.closePath(),this.ctx.fillStyle="rgba(255,255,255,0.92)",this.ctx.fill(),this.ctx.beginPath(),this.ctx.moveTo(-4,18),this.ctx.lineTo(-4,28),this.ctx.lineTo(4,28),this.ctx.lineTo(4,18),this.ctx.closePath(),this.ctx.fillStyle="rgba(255,255,255,0.92)",this.ctx.fill(),this.ctx.beginPath(),this.ctx.arc(0,28,6,0,Math.PI,!0),this.ctx.fillStyle="rgba(255,255,255,0.7)",this.ctx.fill(),this.ctx.restore()}drawRipples(){for(let t=this.ripples.length-1;t>=0;t--){const s=this.ripples[t];if(s.radius+=s.speed,s.alpha-=.01,s.alpha<=0){this.ripples.splice(t,1);continue}this.ctx.beginPath(),this.ctx.arc(this.centerX,this.centerY,s.radius,0,Math.PI*2),this.ctx.strokeStyle=`rgba(85,154,154, ${s.alpha})`,this.ctx.lineWidth=2,this.ctx.stroke()}}drawPulsingRing(){if(this.isListening){const t=this.radius+10+Math.sin(this.pulsePhase)*5,s=this.volumeLevel*20;this.ctx.beginPath(),this.ctx.arc(this.centerX,this.centerY,t+s,0,Math.PI*2),this.ctx.strokeStyle="rgba(33, 150, 243, 0.5)",this.ctx.lineWidth=3,this.ctx.stroke(),this.pulsePhase+=.1}}drawWaveform(){if(!this.isListening)return;const t=4;this.waveformPhase+=.08+this.volumeLevel*.12;for(let s=1;s<=t;s++){const r=this.radius*.98+s*10+Math.sin(this.waveformPhase+s)*3*(1+this.volumeLevel);this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(this.centerX,this.centerY,r,0,Math.PI*2),this.ctx.strokeStyle=`rgba(232,181,84,${.18+.08*(t-s)})`,this.ctx.lineWidth=2+this.volumeLevel*2,this.ctx.shadowColor="rgba(85,154,154,0.22)",this.ctx.shadowBlur=8,this.ctx.stroke(),this.ctx.restore()}}drawParticles(){if(this.isListening&&Math.random()<.18){const t=Math.random()*2*Math.PI,s=this.radius*1.18+Math.random()*16;this.particles.push({x:this.centerX+Math.cos(t)*s,y:this.centerY+Math.sin(t)*s,alpha:.7+Math.random()*.3,size:2+Math.random()*2,speed:.5+Math.random()*.7})}for(let t=this.particles.length-1;t>=0;t--){const s=this.particles[t];if(s.alpha-=.012,s.size*=.98,s.y-=s.speed*.5,s.x+=Math.sin(s.y*.1)*.2,s.alpha<=.05||s.size<.5){this.particles.splice(t,1);continue}this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(s.x,s.y,s.size,0,Math.PI*2),this.ctx.fillStyle=`rgba(232,181,84,${s.alpha})`,this.ctx.shadowColor="rgba(85,154,154,0.22)",this.ctx.shadowBlur=6,this.ctx.fill(),this.ctx.restore()}}drawTimeRing(){const t=Math.min(1,this.elapsedTime/this.timeTarget),s=t<.5?"#E8B554":t<1?"#d4af37":"#e53935";this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(this.centerX,this.centerY,this.radius*1.32,-Math.PI/2,-Math.PI/2+t*2*Math.PI),this.ctx.strokeStyle=s,this.ctx.lineWidth=4,this.ctx.shadowColor=s,this.ctx.shadowBlur=t>.95?16:6,this.ctx.globalAlpha=.85,this.ctx.stroke(),this.ctx.restore()}drawTimeText(){this.displayedTime+=(this.elapsedTime-this.displayedTime)*.18;const t=Math.round(this.displayedTime),s=Math.floor(t/60).toString().padStart(2,"0"),r=(t%60).toString().padStart(2,"0"),a=`${s}:${r}`;this.ctx.save(),this.ctx.font="600 1.25rem Montserrat, Raleway, Arial, sans-serif",this.ctx.textAlign="center",this.ctx.textBaseline="top",this.ctx.shadowColor="rgba(85,154,154,0.22)",this.ctx.shadowBlur=8,this.ctx.fillStyle="#fff",this.isDarkMode&&(this.ctx.fillStyle="#e8e8e8"),this.ctx.globalAlpha=.95,this.ctx.fillText(a,this.centerX,this.centerY+this.radius*1.45),this.ctx.restore()}drawIdleFlash(){if(Date.now()-this.lastActiveTime>6e3){this.idleFlash+=.08;const s=.7+.3*Math.abs(Math.sin(this.idleFlash*1.2));this.ctx.save(),this.ctx.globalAlpha=.18*s,this.ctx.beginPath(),this.ctx.arc(this.centerX,this.centerY,this.radius*1.18,0,Math.PI*2),this.ctx.fillStyle="#E8B554",this.ctx.filter="blur(2.5px)",this.ctx.fill(),this.ctx.filter="none",this.ctx.restore()}else this.idleFlash=0}drawVolumeVisualization(){if(!this.isListening)return;const t=16,s=this.radius*1.08;for(let r=0;r<t;r++){const a=2*Math.PI*r/t,u=8+Math.sin(this.waveformPhase+r)*4+this.volumeLevel*18,h=this.centerX+Math.cos(a)*s,c=this.centerY+Math.sin(a)*s,m=this.centerX+Math.cos(a)*(s+u),E=this.centerY+Math.sin(a)*(s+u);this.ctx.save(),this.ctx.strokeStyle=`rgba(232,181,84,${.18+.18*this.volumeLevel})`,this.ctx.lineWidth=2.2,this.ctx.beginPath(),this.ctx.moveTo(h,c),this.ctx.lineTo(m,E),this.ctx.shadowColor="rgba(85,154,154,0.22)",this.ctx.shadowBlur=6,this.ctx.stroke(),this.ctx.restore()}}animate(){const t=Math.min(this.width,this.height)<340;this.radius=t?Math.max(32,Math.min(this.width,this.height)/2.8):Math.max(36,Math.min(this.width,this.height)/5.2),this.ctx.clearRect(0,0,this.width,this.height),this.drawBaseCircle(),this.drawWaveform(),this.drawParticles(),this.drawRipples(),this.drawPulsingRing(),this.drawTimeRing(),this.drawTimeText(),this.drawIdleFlash(),this.drawVolumeVisualization(),this.isListening&&Math.random()<(t?.05:.1)&&this.ripples.push({radius:this.radius,alpha:.4,speed:1+this.volumeLevel*2}),this.animationFrameId=requestAnimationFrame(this.animate.bind(this))}setListening(t){this.isListening=t,t&&(this.ripples=[])}setVolumeLevel(t){this.volumeLevel=Math.max(0,Math.min(1,t))}setTime(t,s=60){this.elapsedTime=t,this.timeTarget=s}getTime(){return this.elapsedTime}cleanup(){window.removeEventListener("resize",this.resize),this.animationFrameId&&cancelAnimationFrame(this.animationFrameId),this.canvas.remove()}}const Bl=({isListening:n,volumeLevel:t,containerId:s})=>{const r=o.useRef(null);return o.useEffect(()=>(r.current=new ql(s),()=>{r.current&&(r.current.cleanup(),r.current=null)}),[s]),o.useEffect(()=>{r.current&&r.current.setListening(n)},[n]),o.useEffect(()=>{r.current&&r.current.setVolumeLevel(t)},[t]),e.jsx("div",{id:s,className:"w-[220px] h-[220px] relative rounded-full overflow-visible",style:{cursor:"pointer",borderRadius:"50%"}})};class zl{constructor(){this.referenceMap={}}async initialize(){try{const t=await fetch("/assets/references/reference-map.json");this.referenceMap=await t.json(),console.log("Loaded referenceMap:",this.referenceMap)}catch(t){console.error("Error loading reference map:",t)}}findReferences(t){const s=t.toLowerCase(),r=[];return Object.values(this.referenceMap).forEach(a=>{a.keywords.some(h=>s.includes(h.toLowerCase()))&&!r.find(h=>h.url===a.url)&&r.push(a)}),r}async addReference(t,s){this.referenceMap[t]=s;try{await fetch("/api/references",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...s,id:t})})}catch(r){console.error("Error saving reference:",r)}}}const be=new zl,Wl=({isActive:n})=>{const{transcripts:t,callDetails:s,callDuration:r,endCall:a,isMuted:u,toggleMute:h,setCurrentInterface:c,micLevel:m,modelOutput:E,language:v}=G(),[T,C]=o.useState({}),N=o.useRef({}),[p,M]=o.useState([]),[x,d]=o.useState([]),[S,y]=o.useState(0),$=o.useRef(null),[D,j]=o.useState(!0),l=()=>{Object.values(N.current).forEach(g=>{cancelAnimationFrame(g)}),N.current={}};o.useEffect(()=>{async function g(){await be.initialize();const b=Object.values(be.referenceMap||{});console.log("All references loaded:",b),d(b)}g()},[]),o.useEffect(()=>{const g=[...t].sort((I,z)=>I.timestamp.getTime()-z.timestamp.getTime()),b=[];let _=null;g.forEach(I=>{I.role==="user"?(_={id:I.id.toString(),role:"user",timestamp:I.timestamp,messages:[{id:I.id.toString(),content:I.content,timestamp:I.timestamp}]},b.push(_)):((!_||_.role==="user")&&(_={id:I.id.toString(),role:"assistant",timestamp:I.timestamp,messages:[]},b.push(_)),_.messages.push({id:I.id.toString(),content:I.content,timestamp:I.timestamp}))}),M(b)},[t]),o.useEffect(()=>(p.filter(b=>b.role==="assistant").flatMap(b=>b.messages).forEach(b=>{if(T[b.id]===b.content.length)return;let _=T[b.id]||0;const I=b.content,z=()=>{_<I.length?(C(L=>({...L,[b.id]:_+1})),_++,N.current[b.id]=requestAnimationFrame(z)):delete N.current[b.id]};N.current[b.id]=requestAnimationFrame(z)}),()=>l()),[p]);const k=o.useCallback(()=>{const g=r>0?r:S;console.log("Canceling call with duration:",g),a(),c("interface1")},[r,S,a,c]),F=o.useCallback(()=>{if(!t||t.length===0){alert(w("need_conversation",v));return}const g=r>0?r:S;console.log("Ending call with duration:",g),a(),c(v==="fr"?"interface3fr":v==="vi"?"interface3vi":"interface3")},[r,S,a,c,t,v]),B=g=>{const b=Math.floor(g/60).toString().padStart(2,"0"),_=(g%60).toString().padStart(2,"0");return`${b}:${_}`};return o.useEffect(()=>{let g=null;return n&&(console.log("Interface2 is active, starting local timer"),y(r||0),g=setInterval(()=>{y(b=>b+1)},1e3)),()=>{g&&(console.log("Cleaning up local timer in Interface2"),clearInterval(g))}},[n,r]),o.useEffect(()=>{$.current&&n&&($.current.scrollTop=0)},[p,n]),e.jsx("div",{className:`absolute w-full min-h-screen h-full transition-opacity duration-500 ${n?"opacity-100":"opacity-0 pointer-events-none"} z-20 overflow-y-auto`,id:"interface2",style:{backgroundImage:"linear-gradient(rgba(85,154,154,0.7), rgba(121, 219, 220, 0.6)), url('/assets/courtyard.jpeg')",backgroundSize:"cover",backgroundPosition:"center"},children:e.jsxs("div",{className:"container mx-auto flex flex-col md:flex-row p-2 h-full gap-2",children:[e.jsxs("div",{className:"w-full md:w-3/4 lg:w-2/3 flex flex-col items-center space-y-1 sm:space-y-4 mt-1",children:[e.jsxs("div",{className:"relative flex flex-col items-center justify-center mb-1 sm:mb-6 w-full max-w-xs mx-auto",children:[e.jsx(Bl,{containerId:"siri-button",isListening:!u,volumeLevel:m}),e.jsxs("div",{className:"flex items-center justify-center mt-2 w-full gap-2 sm:gap-3",children:[e.jsx("button",{className:"flex items-center justify-center transition-colors",title:w(u?"unmute":"mute",v),onClick:h,style:{fontSize:22,padding:0,background:"none",border:"none",color:"#d4af37",width:28,height:28},onMouseOver:g=>g.currentTarget.style.color="#ffd700",onMouseOut:g=>g.currentTarget.style.color="#d4af37",children:e.jsx("span",{className:"material-icons",children:u?"mic_off":"mic"})}),e.jsxs("button",{id:"cancelButton",onClick:k,className:"flex items-center justify-center px-4 py-3 bg-white/80 hover:bg-blue-100 text-blue-900 rounded-full text-base font-semibold border-2 border-blue-200 shadow transition-colors sm:hidden active:scale-95 active:bg-blue-100",style:{fontFamily:"inherit",letterSpacing:.2,minHeight:56,minWidth:120,touchAction:"manipulation",zIndex:10},children:[e.jsx("span",{className:"material-icons text-lg mr-2",children:"cancel"}),w("cancel",v)]}),e.jsx("div",{className:"flex-1 flex justify-center",children:e.jsx("div",{className:"text-white text-xs sm:text-sm bg-blue-900/80 rounded-full px-3 sm:px-4 py-1 shadow-lg border border-white/30 flex items-center justify-center",style:{backdropFilter:"blur(2px)"},children:B(S)})}),e.jsxs("button",{id:"confirmButton",onClick:F,className:"flex items-center justify-center px-4 py-3 bg-[#ffd700] hover:bg-[#ffe066] text-blue-900 rounded-full text-base font-bold border-4 border-[#d4af37] shadow-2xl transition-all duration-200 sm:hidden active:scale-95 active:bg-[#ffe066]",style:{fontFamily:"inherit",letterSpacing:.2,boxShadow:"0 6px 24px 0 rgba(212,175,55,0.25), 0 1.5px 4px 0 rgba(0,0,0,0.12)",borderWidth:4,borderColor:"#d4af37",background:"linear-gradient(180deg, #ffe066 0%, #ffd700 100%)",textShadow:"0 1px 2px #fff, 0 1px 8px #ffd700",minHeight:56,minWidth:200,touchAction:"manipulation",zIndex:10},children:[e.jsx("span",{className:"material-icons text-lg mr-2",children:"send"}),w("confirm",v)]}),e.jsxs("button",{className:"flex items-center justify-center transition-colors",title:"Mic Level",style:{fontSize:22,padding:0,background:"none",border:"none",color:"#d4af37",width:28,height:28},tabIndex:-1,disabled:!0,onMouseOver:g=>g.currentTarget.style.color="#ffd700",onMouseOut:g=>g.currentTarget.style.color="#d4af37",children:[e.jsx("span",{className:"material-icons",children:"graphic_eq"}),e.jsx("span",{className:"ml-1 flex items-end h-4 w-6",children:[...Array(4)].map((g,b)=>e.jsx("span",{style:{display:"inline-block",width:2,height:`${4+Math.round(m/100*12)*(b%2+1)}px`,background:"#d4af37",marginLeft:1,borderRadius:1}},b))})]})]})]}),D&&e.jsxs("div",{id:"realTimeConversation",ref:$,className:"w-full flex flex-col-reverse gap-1 pr-2 relative max-w-full sm:max-w-2xl mx-auto min-h-[60px] max-h-[12vh] overflow-y-auto mb-1",style:{background:"rgba(255,255,255,0.88)",borderRadius:12,border:"1px solid rgba(255,255,255,0.35)",boxShadow:"0px 4px 10px rgba(0,0,0,0.15)",padding:"8px",transition:"box-shadow 0.3s, background 0.3s",fontFamily:"SF Pro Text, Roboto, Open Sans, Arial, sans-serif",fontSize:window.innerWidth<640?14:16,lineHeight:1.5,color:"#222",fontWeight:400,backdropFilter:"blur(2px)",display:"flex",flexDirection:"column",justifyContent:"flex-end"},children:[e.jsx("button",{className:"absolute top-1.5 right-1.5 w-5 h-5 flex items-center justify-center rounded-full bg-white/40 hover:bg-white/70 text-gray-400 hover:text-gray-700 shadow z-10 opacity-60 hover:opacity-90 transition-all",style:{fontSize:14,display:"block"},title:"Ẩn realtime conversation",onClick:()=>j(!1),children:e.jsx("span",{className:"material-icons",style:{fontSize:16},children:"close"})}),e.jsxs("div",{className:"w-full flex flex-col gap-1 pr-2",style:{overflowY:"auto",maxHeight:"28vh"},children:[p.length===0&&e.jsx("div",{className:"text-gray-400 text-base text-center select-none",style:{opacity:.7},children:w("tap_to_speak",v)}),[...p].reverse().map((g,b)=>e.jsx("div",{className:"mb-1",children:e.jsx("div",{className:"flex items-start",children:e.jsx("div",{className:"flex-grow",children:g.role==="user"?e.jsx("p",{className:"text-base md:text-lg font-medium text-gray-900",style:{marginBottom:2},children:g.messages[0].content}):e.jsxs("p",{className:"text-base md:text-lg font-medium",style:{marginBottom:2,position:"relative",background:"linear-gradient(90deg, #FF512F, #F09819, #FFD700, #56ab2f, #43cea2, #1e90ff, #6a11cb, #FF512F)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",fontWeight:600,letterSpacing:.2,transition:"background 0.5s"},children:[e.jsx("span",{className:"inline-flex flex-wrap",children:g.messages.map((_,I)=>{const z=_.content.slice(0,T[_.id]||0);return e.jsxs("span",{style:{whiteSpace:"pre"},children:[z,I===g.messages.length-1&&b===0&&T[_.id]<_.content.length&&e.jsx("span",{className:"animate-blink text-yellow-500",style:{marginLeft:1},children:"|"})]},_.id)})}),b===0&&g.role==="assistant"&&T[g.messages[g.messages.length-1].id]===g.messages[g.messages.length-1].content.length&&e.jsx("span",{className:"ml-2 animate-ellipsis text-yellow-500",children:"..."})]})})})},g.id))]})]}),e.jsx("div",{className:"w-full mt-1",children:e.jsx("div",{className:"w-full flex flex-row items-center gap-x-2 mb-3 px-2",children:e.jsx(Ol,{references:x})})})]}),e.jsx("div",{className:"w-1/4 lg:w-1/3 flex-col items-center lg:items-end p-2 space-y-4 overflow-auto hidden sm:flex",style:{maxHeight:"100%"},children:e.jsxs("div",{className:"flex flex-col gap-4 w-full md:w-auto",children:[e.jsxs("button",{id:"endCallButton",onClick:F,className:"w-full md:w-auto bg-[#ffd700] hover:bg-[#ffe066] text-blue-900 font-bold py-3 px-8 rounded-full shadow-2xl flex items-center justify-center space-x-2 transition-all duration-200 border-4 border-[#d4af37] text-base sm:text-lg active:scale-95 active:bg-[#ffe066]",style:{fontFamily:"inherit",letterSpacing:.5,boxShadow:"0 6px 24px 0 rgba(212,175,55,0.25), 0 1.5px 4px 0 rgba(0,0,0,0.12)",borderWidth:4,borderColor:"#d4af37",background:"linear-gradient(180deg, #ffe066 0%, #ffd700 100%)",textShadow:"0 1px 2px #fff, 0 1px 8px #ffd700",minHeight:56,minWidth:220,touchAction:"manipulation",zIndex:10},children:[e.jsx("span",{className:"material-icons",children:"send"}),e.jsx("span",{className:"whitespace-nowrap",children:w("confirm_request",v)})]}),e.jsxs("button",{id:"cancelButtonDesktop",onClick:k,className:"w-full md:w-auto bg-white hover:bg-blue-100 text-blue-900 font-semibold py-3 px-8 rounded-full shadow flex items-center justify-center space-x-2 transition-all duration-200 border-2 border-blue-200 text-base sm:text-lg active:scale-95 active:bg-blue-100",style:{fontFamily:"inherit",letterSpacing:.2,minHeight:56,minWidth:120,touchAction:"manipulation",zIndex:10},children:[e.jsx("span",{className:"material-icons text-lg mr-2",children:"cancel"}),w("cancel",v)]})]})})]})})},Vl={roomNumber:/(?:room(?:\s+number)?|room|phòng)(?:\s*[:#\-]?\s*)([0-9]{1,4}[A-Za-z]?)|(?:staying in|in room|in phòng|phòng số)(?:\s+)([0-9]{1,4}[A-Za-z]?)/i};function _e(n){const t=n.match(Vl.roomNumber);if(t)return t[1]||t[2]||null;const s=n.match(/(?:room details|room number|phòng số)(?:\s*[:#\-]?\s*)([0-9]{1,4}[A-Za-z]?)/i);if(s&&s[1])return s[1];const r=n.match(/(?:details[\s\S]*?room(?:\s+number)?[\s\S]*?)([0-9]{1,4}[A-Za-z]?)/i);return r&&r[1]?r[1]:null}const Hl=({isActive:n})=>{const{orderSummary:t,setOrderSummary:s,setCurrentInterface:r,setOrder:a,callSummary:u,setCallSummary:h,serviceRequests:c,callDuration:m,callDetails:E,emailSentForCurrentSession:v,setEmailSentForCurrentSession:T,addActiveOrder:C,translateToVietnamese:N,language:p}=G(),[M,x]=o.useState({}),[d,S]=o.useState(""),y=(j,l)=>{t&&s({...t,[j]:l})};o.useEffect(()=>{if(c&&c.length>0){const j=c.reduce((l,k)=>{const F=k.serviceType;return l[F]||(l[F]=[]),l[F].push(k),l},{});if(x(j),t&&(!t.items||t.items.length===0)){const l=c.map((k,F)=>{let B=1;const g=k.details||{},b=k.requestText.match(/(\d+)\s+(towels|bottles|pieces|cups|glasses|plates|servings|items)/i);b?B=parseInt(b[1]):typeof g.people=="number"&&(B=g.people);let _=10;return k.serviceType==="room-service"?_=15:k.serviceType==="housekeeping"?_=8:k.serviceType==="transportation"?_=25:k.serviceType==="tours-activities"?_=35:k.serviceType==="spa"&&(_=30),{id:`item-${F}`,name:k.serviceType,description:k.requestText,quantity:B,price:_}});s({...t,items:l,totalAmount:l.reduce((k,F)=>k+F.price*F.quantity,0)})}}},[c,t,s]),o.useEffect(()=>{if(n&&u&&t){const j=u.content,l=_e(j);if(l&&l!==t.roomNumber&&s({...t,roomNumber:l}),!c||c.length===0){const k=j.match(/List of Requests:([\s\S]*?)(?:\n\nSpecial Instructions|\n\nThe conversation)/);if(k){const F=k[1],B=/Request (\d+): ([^\n]+)/g;let g;const b=[];let _=1;for(;(g=B.exec(F))!==null;){const I=g[2].trim(),z=g.index,L=F.indexOf(`Request ${parseInt(g[1])+1}:`,z),P=L>-1?F.substring(z,L):F.substring(z),R=/- ([^:]+): ([^\n]+)/g;let H;const W={};for(;(H=R.exec(P))!==null;){const Z=H[1].trim(),Q=H[2].trim();W[Z.toLowerCase()]=Q}let X="";W["service description"]&&(X+=`${W["service description"]}`),W.details&&(X+=X?`. ${W.details}`:W.details),W.items&&(X+=X?`
Items: ${W.items}`:`Items: ${W.items}`),W["service timing requested"]&&(X+=`
Timing: ${W["service timing requested"]}`),W.destinations&&(X+=`
Destinations: ${W.destinations}`),X||(X=`Requested ${I} service`),b.push({id:_.toString(),name:I,description:X,quantity:1,price:10}),_++}if(b.length>0&&(!t.items||t.items.length===0)){const I=b.map(H=>H.name.toLowerCase().replace(/\s+/g,"-")).join(","),z=_e(j)||t.roomNumber,L=j.match(/Service Timing Requested:?\s*([^\n]+)/i),P=L?L[1]:t.deliveryTime;let R=t.deliveryTime;P&&(/soon|immediate|urgent|right now/i.test(P)?R="asap":/30 minute|half hour/i.test(P)?R="30min":/hour|60 minute/i.test(P)?R="1hour":/schedule|later|specific/i.test(P)&&(R="specific")),s({...t,items:b,orderType:I,roomNumber:z,deliveryTime:R,totalAmount:b.reduce((H,W)=>H+W.price*W.quantity,0)})}}}}},[n,u,t,s]);const $=async()=>{var F;if(!t)return;const j=`#ORD-${Math.floor(1e4+Math.random()*9e4)}`;let l;switch(t.deliveryTime){case"asap":l="As soon as possible";break;case"30min":l="30 minutes";break;case"1hour":l="1 hour";break;default:l=t.deliveryTime||"15-20 minutes"}if(a({reference:j,estimatedTime:l,summary:t}),C({reference:j,requestedAt:new Date,estimatedTime:l,status:"Đã ghi nhận"}),v){console.log("Email already sent for this session. Skipping duplicate email sending."),r("interface4");return}if(((F=document.querySelector('[data-interface="interface3vi"]'))==null?void 0:F.getAttribute("data-active"))==="true")console.log("Vietnamese interface is active, skipping email send from English interface");else try{console.log("Sending email with call summary and service requests...");let B=(u==null?void 0:u.content)||"";try{B=await N(B)}catch(L){console.error("Failed to translate summary for email:",L)}console.log("Translated summary for email (Vietnamese):",B);const g=m?`${Math.floor(m/60)}:${(m%60).toString().padStart(2,"0")}`:"0:00";console.log("Call duration for email:",g);const b=`call-${Date.now()}`,_=(E==null?void 0:E.id)||b;console.log("Using callId for email:",_),console.log("Call summary content:",(u==null?void 0:u.content)||"No summary available"),console.log("Preparing email request payload...");const I={toEmail:"tuans2@gmail.com",callDetails:{callId:_,roomNumber:t.roomNumber||"unknown",summary:B||"No summary available",timestamp:(u==null?void 0:u.timestamp)||new Date,duration:g,serviceRequests:t.items.map(L=>L.name),orderReference:j,note:d}};console.log("Email payload prepared:",JSON.stringify(I));const z=/iPhone|iPad|iPod|Android|Mobile|webOS|BlackBerry/i.test(navigator.userAgent);console.log("Device type detected:",z?"MOBILE":"DESKTOP"),setTimeout(async()=>{try{const L=z?"/api/mobile-call-summary-email":"/api/send-call-summary-email";console.log(`Using ${z?"mobile":"standard"} endpoint for email: ${L}`);const P=z?`${L}?_=${Date.now()}`:L;console.log("Sending email request to server...");const R=await fetch(P,{method:"POST",headers:{"Content-Type":"application/json","Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0","X-Device-Type":z?"mobile":"desktop"},body:JSON.stringify(I),cache:"no-cache",credentials:"same-origin"});if(!R.ok)throw new Error(`Server responded with status: ${R.status}`);const H=await R.json();console.log("Email sent with order confirmation:",H),T(!0)}catch(L){console.error("Failed to send email in timeout:",L)}},z?50:500)}catch(B){console.error("Failed to send email:",B)}r("interface4")},D=()=>{!d.trim()||!u||h({...u,content:`${u.content}

Additional Notes:
${d}`})};return t?e.jsx("div",{className:`absolute w-full min-h-screen h-full transition-opacity duration-500 ${n?"opacity-100":"opacity-0 pointer-events-none"} z-30 overflow-y-auto`,id:"interface3",style:{backgroundImage:`linear-gradient(rgba(85,154,154,0.7), rgba(121, 219, 220, 0.6)), url(${Oe})`,backgroundSize:"cover",backgroundPosition:"center",fontFamily:"SF Pro Text, Roboto, Open Sans, Arial, sans-serif"},children:e.jsx("div",{className:"container mx-auto flex flex-col p-2 sm:p-4 md:p-8",children:e.jsxs("div",{className:"mx-auto w-full max-w-4xl bg-white/90 rounded-2xl shadow-xl p-3 sm:p-6 md:p-10 mb-4 sm:mb-6 flex-grow border border-white/40 backdrop-blur-md",style:{minHeight:420},children:[e.jsx("div",{className:"mb-3 sm:mb-4 pb-2 sm:pb-3 border-b border-gray-200",children:e.jsx("p",{className:"font-poppins font-bold text-xl sm:text-2xl text-blue-900 tracking-wide",children:w("order_summary",p)})}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 sm:gap-10 md:gap-16",children:[e.jsxs("div",{className:"md:w-3/4 w-full space-y-3 sm:space-y-4",children:[e.jsxs("div",{className:"flex sm:hidden flex-row w-full gap-2 mb-2",children:[e.jsxs("button",{className:"flex-1 flex items-center justify-center px-2 py-1.5 bg-white hover:bg-blue-100 text-blue-900 rounded-full text-xs font-semibold border-2 border-blue-200 shadow transition-all duration-200 active:scale-95 active:bg-blue-100",style:{fontFamily:"inherit",letterSpacing:.2,minHeight:40,minWidth:80,touchAction:"manipulation",zIndex:10},onClick:()=>r("interface1"),children:[e.jsx("span",{className:"material-icons text-base mr-1",children:"cancel"}),w("cancel",p)]}),e.jsxs("button",{onClick:$,className:"flex-1 bg-[#ffd700] hover:bg-[#ffe066] text-blue-900 font-bold py-1.5 px-3 rounded-full shadow-2xl flex items-center justify-center space-x-2 transition-all duration-200 border-4 border-[#d4af37] text-xs active:scale-95 active:bg-[#ffe066]",style:{fontFamily:"inherit",letterSpacing:.5,boxShadow:"0 6px 24px 0 rgba(212,175,55,0.25), 0 1.5px 4px 0 rgba(0,0,0,0.12)",borderWidth:4,borderColor:"#d4af37",background:"linear-gradient(180deg, #ffe066 0%, #ffd700 100%)",textShadow:"0 1px 2px #fff, 0 1px 8px #ffd700",minHeight:40,minWidth:120,touchAction:"manipulation",zIndex:10},children:[e.jsx("span",{className:"material-icons",children:"send"}),e.jsx("span",{className:"whitespace-nowrap",children:w("send_to_reception",p)})]})]}),e.jsxs("div",{className:"flex flex-col gap-2 mb-2 sm:hidden",children:[e.jsxs("div",{className:"flex flex-row w-full gap-2",children:[e.jsx("button",{className:"h-10 px-3 bg-[#ffe082] hover:bg-[#ffe9b3] text-blue-900 rounded-full text-xs font-semibold shadow transition-colors flex-1",onClick:D,disabled:!d.trim(),children:w("add_note",p)}),e.jsxs("div",{className:"flex items-center space-x-2 w-full justify-center",children:[e.jsx("label",{className:"text-xs text-gray-600 font-medium",children:w("room_number",p)}),e.jsx("input",{type:"text",placeholder:w("enter_room_number",p),className:"w-16 p-2 border border-white/30 rounded-xl focus:ring-2 focus:ring-[#d4af37] focus:border-[#d4af37] bg-white/70 text-gray-900 font-semibold text-xs",value:t.roomNumber,onChange:j=>y("roomNumber",j.target.value)})]}),e.jsx("button",{className:"h-10 px-3 bg-white/70 text-blue-900 rounded-full text-xs font-semibold border border-white/30 shadow flex items-center justify-center",onClick:()=>r("interface3vi"),children:e.jsx("span",{className:"material-icons text-base",children:"language"})})]}),e.jsx("textarea",{placeholder:w("enter_notes",p),className:"w-full p-2 border border-white/30 rounded-xl text-xs bg-white/60 focus:bg-white/90 focus:ring-2 focus:ring-[#d4af37] transition italic font-light text-gray-500",value:d,onChange:j=>S(j.target.value),rows:3,style:{fontFamily:"inherit"}})]}),u&&e.jsxs("div",{id:"summary-container",className:"mb-3 sm:mb-4",children:[e.jsxs("div",{className:"p-3 sm:p-5 bg-white/80 rounded-xl shadow border border-white/30 mb-3 sm:mb-4 relative",style:{backdropFilter:"blur(2px)"},children:[e.jsx("h3",{className:"font-semibold text-base sm:text-lg mb-1 sm:mb-2 text-blue-800",children:w("summary",p)}),e.jsx("div",{className:"text-sm sm:text-base leading-relaxed text-gray-800 whitespace-pre-line",style:{fontWeight:400},children:(u.content||"").split(`
`).filter(l=>!/^Next Step:/i.test(l)&&!/Please Press Send To Reception/i.test(l)).map((l,k)=>{if(/^Guest's Name/i.test(l)){const F=l.replace(/\s*\(used for Guest with a confirmed reservation\)/i,"");return e.jsx("div",{children:e.jsx("b",{children:F})},k)}return/^Room Number:/i.test(l)?e.jsx("div",{children:e.jsx("b",{children:l})},k):/^REQUEST \d+:/i.test(l)?e.jsx("div",{className:"mt-3 mb-1",children:e.jsx("b",{children:l})},k):/^• Service Timing:/i.test(l)?e.jsx("div",{style:{marginLeft:16},children:e.jsx("b",{children:l})},k):/^• Order Details:/i.test(l)?e.jsx("div",{style:{marginLeft:16},children:e.jsx("b",{children:l})},k):/^• Special Requirements:/i.test(l)?e.jsx("div",{style:{marginLeft:16},children:e.jsx("b",{children:l})},k):/^• [^-].+/.test(l)?e.jsx("div",{style:{marginLeft:32},children:l},k):/^\s*[-•]/.test(l)?e.jsx("div",{style:{marginLeft:32},children:l},k):/^\s*$/.test(l)?e.jsx("div",{style:{height:8}},k):e.jsx("div",{children:l},k)})}),e.jsx("div",{className:"mt-2 sm:mt-3 flex justify-end",children:e.jsxs("div",{className:"text-xs text-gray-500",children:[w("generated_at",p)," ",new Date(u.timestamp).toLocaleTimeString()]})})]}),e.jsx("div",{className:"text-center mt-2 mb-1",children:e.jsxs("span",{className:"italic text-sm",style:{color:"#2563eb",background:"#e0f2fe",borderRadius:"6px",padding:"4px 12px",display:"inline-block",fontWeight:500},children:["Please Press ",e.jsx("b",{style:{fontWeight:700,color:"#1d4ed8"},children:"Send To Reception"})," To Complete Your Request"]})})]}),e.jsxs("div",{className:"hidden sm:flex flex-row items-center gap-2 h-10",children:[e.jsx("button",{className:"h-10 px-3 sm:px-4 bg-[#ffe082] hover:bg-[#ffe9b3] text-blue-900 rounded-full text-xs sm:text-sm font-semibold shadow transition-colors",onClick:D,disabled:!d.trim(),children:w("add_note",p)}),e.jsxs("div",{className:"flex items-center space-x-2 w-full justify-center",children:[e.jsx("label",{className:"text-xs sm:text-base text-gray-600 font-medium",children:w("room_number",p)}),e.jsx("input",{type:"text",placeholder:w("enter_room_number",p),className:"w-16 sm:w-32 p-2 border border-white/30 rounded-xl focus:ring-2 focus:ring-[#d4af37] focus:border-[#d4af37] bg-white/70 text-gray-900 font-semibold text-xs sm:text-base",value:t.roomNumber,onChange:j=>y("roomNumber",j.target.value)})]}),e.jsx("button",{className:"h-10 px-3 sm:px-4 bg-white/70 text-blue-900 rounded-full text-xs sm:text-sm font-semibold border border-white/30 shadow flex items-center justify-center",onClick:()=>r("interface3vi"),children:e.jsx("span",{className:"material-icons text-base",children:"language"})})]}),e.jsx("textarea",{placeholder:w("enter_notes",p),className:"hidden sm:block w-full p-2 sm:p-3 border border-white/30 rounded-xl mb-3 sm:mb-4 text-xs sm:text-sm bg-white/60 focus:bg-white/90 focus:ring-2 focus:ring-[#d4af37] transition italic font-light text-gray-500",value:d,onChange:j=>S(j.target.value),rows:3,style:{fontFamily:"inherit"}})]}),e.jsx("div",{className:"md:w-1/4 w-full hidden sm:flex md:justify-end justify-center",children:e.jsxs("div",{className:"flex flex-col items-end space-y-2 sm:space-y-3 w-full md:w-auto",children:[e.jsxs("button",{onClick:$,className:"w-full md:w-auto bg-[#ffd700] hover:bg-[#ffe066] text-blue-900 font-bold py-1.5 sm:py-2 px-3 sm:px-4 rounded-full shadow-2xl flex items-center justify-center space-x-2 transition-all duration-200 border-4 border-[#d4af37] text-xs sm:text-sm active:scale-95 active:bg-[#ffe066]",style:{fontFamily:"inherit",letterSpacing:.5,boxShadow:"0 6px 24px 0 rgba(212,175,55,0.25), 0 1.5px 4px 0 rgba(0,0,0,0.12)",borderWidth:4,borderColor:"#d4af37",background:"linear-gradient(180deg, #ffe066 0%, #ffd700 100%)",textShadow:"0 1px 2px #fff, 0 1px 8px #ffd700",minHeight:40,minWidth:120,touchAction:"manipulation",zIndex:10},children:[e.jsx("span",{className:"material-icons",children:"send"}),e.jsx("span",{className:"whitespace-nowrap",children:w("send_to_reception",p)})]}),e.jsxs("button",{className:"w-full md:w-auto flex items-center justify-center px-2 sm:px-3 py-1.5 bg-white hover:bg-blue-100 text-blue-900 font-semibold rounded-full shadow transition-all duration-200 border-2 border-blue-200 text-xs sm:text-sm active:scale-95 active:bg-blue-100",style:{fontFamily:"inherit",letterSpacing:.2,minHeight:40,minWidth:80,touchAction:"manipulation",zIndex:10},onClick:()=>r("interface1"),children:[e.jsx("span",{className:"material-icons text-base mr-1",children:"cancel"}),w("cancel",p)]})]})})]})]})})}):null},Xl=({isActive:n})=>{const{callSummary:t,orderSummary:s,setCurrentInterface:r,setOrderSummary:a,setOrder:u,serviceRequests:h,vietnameseSummary:c,setVietnameseSummary:m,translateToVietnamese:E,emailSentForCurrentSession:v,setEmailSentForCurrentSession:T,callDetails:C,callDuration:N,language:p}=G(),[M,x]=o.useState(!1),d=(j,l)=>{s&&a({...s,[j]:l})},[S,y]=o.useState(null);o.useEffect(()=>{const j=t?new Date(t.timestamp).getTime().toString():null;n&&t&&(!c||S!==j)&&j!==S&&(y(j),(async()=>{try{console.log("Starting translation of summary to Vietnamese"),x(!0),await E(t.content),x(!1)}catch(k){console.error("Error translating summary:",k),x(!1)}})())},[n,t,c,E,S]),o.useEffect(()=>{var j,l;if(n&&h&&h.length>0&&s){const k=h.map((_,I)=>{let z=1,L=10;_.serviceType==="housekeeping"&&(L=5),_.serviceType==="technical-support"&&(L=0),(_.serviceType.includes("food")||_.serviceType==="room-service")&&(L=8),_.serviceType==="wake-up"&&(L=0);let P="";const R=_.details;return R.roomNumber&&R.roomNumber!=="unknown"&&R.roomNumber!=="Not specified"&&(P+=`Số phòng: ${R.roomNumber}
`),R.date&&R.date!=="Not specified"&&(P+=`Ngày: ${R.date}
`),R.time&&R.time!=="Not specified"&&(P+=`Thời gian: ${R.time}
`),R.people&&(P+=`Số người: ${R.people}
`),R.location&&R.location!=="Not specified"&&(P+=`Địa điểm: ${R.location}
`),R.amount&&R.amount!=="Not specified"&&(P+=`Số tiền: ${R.amount}
`),P+=`
Yêu cầu: ${_.requestText}`,R.otherDetails&&R.otherDetails!=="Not specified"&&R.otherDetails!=="None"&&!R.otherDetails.includes("Not specified")&&(P+=`

Thông tin thêm: ${R.otherDetails}`),{id:(I+1).toString(),name:_.requestText.length>60?_.requestText.substring(0,57)+"...":_.requestText,description:P,quantity:z,price:L,serviceType:_.serviceType}}),B=Array.from(new Set(h.map(_=>_.serviceType))).join(",");let g=s.deliveryTime;h.some(_=>_.details&&_.details.time&&typeof _.details.time=="string"&&_.details.time.toLowerCase().includes("immediate"))&&(g="asap");const b=(l=(j=h.find(_=>_.details&&_.details.roomNumber&&_.details.roomNumber!=="unknown"&&_.details.roomNumber!=="Not specified"))==null?void 0:j.details)==null?void 0:l.roomNumber;a({...s,items:k,totalAmount:k.reduce((_,I)=>_+I.price*I.quantity,0),orderType:B,roomNumber:b||s.roomNumber,deliveryTime:g})}},[h,n,s,a]);function $(j){return j.split(`
`).filter(l=>!/^Bước tiếp theo:/i.test(l)&&!/^Next Step:/i.test(l)&&!/Vui lòng nhấn/i.test(l)&&!/Please Press Send To Reception/i.test(l)).map(l=>l.replace(/\(dùng cho khách có đặt chỗ xác nhận\)/i,"").replace(/\(used for Guest with a confirmed reservation\)/i,"").replace(/\(không được chỉ định\)/i,"").replace(/\(not specified\)/i,"")).join(`
`).replace(/\n{3,}/g,`

`)}const D=async()=>{if(!s)return;const j=c||(t?t.content:"Không có tóm tắt"),l=$(j),k=`#ORD-${Math.floor(1e4+Math.random()*9e4)}`;if(u({reference:k,estimatedTime:"15-20 phút",summary:s}),v){console.log("Email đã được gửi cho phiên này. Bỏ qua việc gửi email trùng lặp."),r("interface4");return}try{console.log("Gửi email với tóm tắt cuộc gọi và yêu cầu dịch vụ từ giao diện tiếng Việt...");const F=N?`${Math.floor(N/60)}:${(N%60).toString().padStart(2,"0")}`:"0:00",B=`call-${Date.now()}`,g=(C==null?void 0:C.id)||B;console.log("Sử dụng callId cho email:",g),console.log("Nội dung tóm tắt cuộc gọi:",l),console.log("Chuẩn bị payload email...");const b={toEmail:"tuans2@gmail.com",callDetails:{callId:g,roomNumber:s.roomNumber||"Cần xác nhận",summary:l,timestamp:t?t.timestamp:new Date,duration:F,serviceRequests:s.items.map(_=>_.name),orderReference:k}};console.log("Payload email đã chuẩn bị:",JSON.stringify(b)),setTimeout(async()=>{try{console.log("Gửi yêu cầu email đến máy chủ...");const _=await fetch("/api/send-call-summary-email",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(b),cache:"no-cache",credentials:"same-origin"});if(!_.ok)throw new Error(`Máy chủ phản hồi với trạng thái: ${_.status}`);const I=await _.json();console.log("Email đã được gửi với xác nhận đơn hàng:",I),T(!0)}catch(_){console.error("Không thể gửi email trong timeout:",_)}},500)}catch(F){console.error("Không thể gửi email:",F)}r("interface4")};return s?e.jsx("div",{className:`absolute w-full min-h-screen h-full transition-opacity duration-500 ${n?"opacity-100 active":"opacity-0 pointer-events-none"} z-30 overflow-y-auto`,id:"interface3vi","data-interface":"interface3vi","data-active":n.toString(),style:{backgroundImage:"linear-gradient(rgba(85,154,154,0.7), rgba(121, 219, 220, 0.6))",backgroundSize:"cover",backgroundPosition:"center",fontFamily:"SF Pro Text, Roboto, Open Sans, Arial, sans-serif"},children:e.jsx("div",{className:"container mx-auto h-full flex flex-col p-2 sm:p-4 md:p-8",children:e.jsxs("div",{className:"mx-auto w-full max-w-3xl bg-white/90 rounded-2xl shadow-xl p-3 sm:p-6 md:p-10 mb-4 sm:mb-6 flex-grow border border-white/40 backdrop-blur-md",style:{minHeight:420},children:[e.jsx("div",{className:"mb-3 sm:mb-4 pb-2 sm:pb-3 border-b border-gray-200",children:e.jsx("p",{className:"font-poppins font-bold text-xl sm:text-2xl text-blue-900 tracking-wide",children:"XEM XÉT & XÁC NHẬN"})}),e.jsx("div",{id:"summary-container",className:"mb-3 sm:mb-4",children:t?e.jsxs("div",{className:"p-3 sm:p-5 bg-white/80 rounded-xl shadow border border-white/30 mb-3 sm:mb-4 relative",style:{backdropFilter:"blur(2px)"},children:[e.jsx("h3",{className:"font-semibold text-base sm:text-lg mb-1 sm:mb-2 text-blue-800",children:"Tóm tắt cuộc trò chuyện"}),M?e.jsxs("div",{className:"animate-pulse space-y-2",children:[e.jsx("div",{className:"h-2 bg-blue-100 rounded w-3/4"}),e.jsx("div",{className:"h-2 bg-blue-100 rounded w-full"}),e.jsx("div",{className:"h-2 bg-blue-100 rounded w-5/6"}),e.jsx("div",{className:"h-2 bg-blue-100 rounded w-2/3"}),e.jsx("p",{className:"text-blue-400 text-xs sm:text-sm italic",children:"Đang dịch sang tiếng Việt..."})]}):e.jsx("p",{className:"text-xs sm:text-base leading-relaxed text-gray-800 whitespace-pre-line",style:{fontWeight:400},children:c||t.content}),e.jsx("div",{className:"mt-2 sm:mt-3 flex justify-end",children:e.jsxs("div",{className:"text-xs text-gray-500",children:["Tạo lúc ",new Date(t.timestamp).toLocaleTimeString()]})})]}):e.jsxs("div",{className:"p-3 sm:p-5 bg-gray-50 rounded-xl shadow border border-dashed border-gray-300 mb-3 sm:mb-4",children:[e.jsxs("div",{className:"animate-pulse flex space-x-2 items-center",children:[e.jsx("div",{className:"h-4 w-4 bg-gray-300 rounded-full"}),e.jsx("div",{className:"h-4 bg-gray-300 rounded w-1/4"})]}),e.jsx("h3",{className:"font-semibold text-base sm:text-lg my-2 text-gray-600",children:"Đang tạo bản tóm tắt..."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-2 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-2 bg-gray-200 rounded w-full"}),e.jsx("div",{className:"h-2 bg-gray-200 rounded w-5/6"})]}),e.jsx("p",{className:"text-gray-400 italic mt-3",children:"AI của chúng tôi đang phân tích cuộc trò chuyện và chuẩn bị bản tóm tắt..."})]})}),e.jsxs("div",{className:"flex flex-col md:flex-row items-center gap-3 sm:gap-4 mb-4 sm:mb-6 w-full",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("label",{className:"text-xs sm:text-base text-gray-600 font-medium",children:"Số phòng"}),e.jsx("input",{type:"text",className:"w-20 sm:w-32 p-2 border border-white/30 rounded-xl focus:ring-2 focus:ring-[#d4af37] focus:border-[#d4af37] bg-white/70 text-gray-900 font-semibold",value:s.roomNumber,onChange:j=>d("roomNumber",j.target.value)})]}),e.jsxs("button",{className:"h-full px-3 sm:px-4 bg-white/70 text-blue-900 rounded-full text-xs sm:text-base font-semibold border border-white/30 shadow flex items-center justify-center",onClick:()=>r("interface3"),style:{fontFamily:"inherit",letterSpacing:.2},children:[e.jsx("span",{className:"material-icons text-base mr-2",children:"translate"}),"Tiếng Anh"]}),e.jsxs("button",{id:"confirmOrderButton",className:"h-full px-4 sm:px-8 py-2 sm:py-4 bg-[#d4af37] hover:bg-[#ffd700] text-blue-900 font-bold rounded-full shadow-lg text-base sm:text-xl transition-colors border border-white/30 flex items-center justify-center",onClick:D,style:{fontFamily:"inherit",letterSpacing:.5},children:[e.jsx("span",{className:"material-icons mr-2 text-lg sm:text-2xl",children:"check_circle"}),"Xác nhận"]})]})]})})}):null},Yl=({isActive:n})=>{const{callSummary:t,orderSummary:s,setCurrentInterface:r,setOrderSummary:a,setOrder:u,serviceRequests:h,emailSentForCurrentSession:c,setEmailSentForCurrentSession:m,callDetails:E,callDuration:v,language:T}=G(),[C,N]=o.useState(""),p=(x,d)=>{s&&a({...s,[x]:d})};o.useEffect(()=>{var x,d;if(n&&h&&h.length>0&&s){const S=h.map((l,k)=>{let F=1,B=10;l.serviceType==="housekeeping"&&(B=8),l.serviceType==="technical-support"&&(B=0),(l.serviceType.includes("food")||l.serviceType==="room-service")&&(B=15),l.serviceType==="wake-up"&&(B=0);let g="";const b=l.details;return b.roomNumber&&b.roomNumber!=="unknown"&&b.roomNumber!=="Not specified"&&(g+=`${w("room_number","fr")}: ${b.roomNumber}
`),b.date&&b.date!=="Not specified"&&(g+=`${w("time","fr")}: ${b.date}
`),b.time&&b.time!=="Not specified"&&(g+=`${w("time","fr")}: ${b.time}
`),b.people&&(g+=`Nombre de personnes: ${b.people}
`),b.location&&b.location!=="Not specified"&&(g+=`Lieu: ${b.location}
`),b.amount&&b.amount!=="Not specified"&&(g+=`Montant: ${b.amount}
`),g+=`
Demande: ${l.requestText}`,b.otherDetails&&b.otherDetails!=="Not specified"&&b.otherDetails!=="None"&&!b.otherDetails.includes("Not specified")&&(g+=`

Informations supplémentaires: ${b.otherDetails}`),{id:(k+1).toString(),name:l.requestText.length>60?l.requestText.substring(0,57)+"...":l.requestText,description:g,quantity:F,price:B,serviceType:l.serviceType}}),$=Array.from(new Set(h.map(l=>l.serviceType))).join(",");let D=s.deliveryTime;h.some(l=>l.details&&l.details.time&&typeof l.details.time=="string"&&l.details.time.toLowerCase().includes("immediate"))&&(D="asap");const j=(d=(x=h.find(l=>l.details&&l.details.roomNumber&&l.details.roomNumber!=="unknown"&&l.details.roomNumber!=="Not specified"))==null?void 0:x.details)==null?void 0:d.roomNumber;a({...s,items:S,totalAmount:S.reduce((l,k)=>l+k.price*k.quantity,0),orderType:$,roomNumber:j||s.roomNumber,deliveryTime:D})}},[h,n,s,a]);const M=async()=>{if(!s)return;const x=`#ORD-${Math.floor(1e4+Math.random()*9e4)}`;if(u({reference:x,estimatedTime:"15-20 minutes",summary:s}),c){r("interface4");return}try{const d=v?`${Math.floor(v/60)}:${(v%60).toString().padStart(2,"0")}`:"0:00",S=`call-${Date.now()}`,$={toEmail:"tuans2@gmail.com",callDetails:{callId:(E==null?void 0:E.id)||S,roomNumber:s.roomNumber||"À confirmer",summary:t?t.content:"Aucun résumé",timestamp:t?t.timestamp:new Date,duration:d,serviceRequests:s.items.map(D=>D.name),orderReference:x,note:C}};setTimeout(async()=>{try{const D=await fetch("/api/send-call-summary-email",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify($),cache:"no-cache",credentials:"same-origin"});if(!D.ok)throw new Error(`Le serveur a répondu avec le statut: ${D.status}`);await D.json(),m(!0)}catch(D){console.error("Erreur lors de l'envoi de l'email:",D)}},500)}catch(d){console.error("Erreur lors de l'envoi de l'email:",d)}r("interface4")};return s?e.jsx("div",{className:`absolute w-full min-h-screen h-full transition-opacity duration-500 ${n?"opacity-100 active":"opacity-0 pointer-events-none"} z-30 overflow-y-auto`,id:"interface3fr","data-interface":"interface3fr","data-active":n.toString(),style:{backgroundImage:"linear-gradient(rgba(26, 35, 126, 0.7), rgba(63, 81, 181, 0.7))",backgroundSize:"cover",backgroundPosition:"center",fontFamily:"SF Pro Text, Roboto, Open Sans, Arial, sans-serif"},children:e.jsx("div",{className:"container mx-auto h-full flex flex-col p-2 sm:p-4 md:p-8",children:e.jsxs("div",{className:"mx-auto w-full max-w-3xl bg-white/90 rounded-2xl shadow-xl p-3 sm:p-6 md:p-10 mb-4 sm:mb-6 flex-grow border border-white/40 backdrop-blur-md",style:{minHeight:420},children:[e.jsx("div",{className:"mb-3 sm:mb-4 pb-2 sm:pb-3 border-b border-gray-200",children:e.jsx("p",{className:"font-poppins font-bold text-xl sm:text-2xl text-blue-900 tracking-wide",children:w("order_summary","fr")})}),e.jsx("div",{id:"summary-container",className:"mb-3 sm:mb-4",children:t?e.jsxs("div",{className:"p-3 sm:p-5 bg-white/80 rounded-xl shadow border border-white/30 mb-3 sm:mb-4 relative",style:{backdropFilter:"blur(2px)"},children:[e.jsx("h3",{className:"font-semibold text-base sm:text-lg mb-1 sm:mb-2 text-blue-800",children:w("summary","fr")}),e.jsx("div",{className:"text-xs sm:text-base leading-relaxed text-gray-800 whitespace-pre-line",style:{fontWeight:400},children:(t.content||"").split(`
`).map((d,S)=>{let y=d.replace(/^Room Number:/i,`${w("room_number","fr")}:`).replace(/^Guest's Name.*:/i,`${w("guest_name","fr")}:`).replace(/^REQUEST (\d+):/i,($,D)=>`DEMANDE ${D} :`).replace(/^• Service Timing:/i,"• Heure de service :").replace(/^• Order Details:/i,"• Détails de la commande :").replace(/^• Special Requirements:/i,"• Exigences spéciales :").replace(/^Next Step:/i,"Étape suivante :").replace(/Not specified/gi,"Non spécifié").replace(/Details:/gi,"Détails :").replace(/Assistance or reservation for golf activity requested/gi,"Assistance ou réservation pour une activité de golf demandée");return e.jsx("div",{children:y},S)})}),e.jsx("div",{className:"mt-2 sm:mt-3 flex justify-end",children:e.jsxs("div",{className:"text-xs text-gray-500",children:[w("generated_at","fr")," ",new Date(t.timestamp).toLocaleTimeString()]})})]}):null}),e.jsxs("div",{className:"flex flex-col md:flex-row items-center gap-3 sm:gap-4 mb-4 sm:mb-6 w-full",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("label",{className:"text-xs sm:text-base text-gray-600 font-medium",children:w("room_number","fr")}),e.jsx("input",{type:"text",className:"w-20 sm:w-32 p-2 border border-white/30 rounded-xl focus:ring-2 focus:ring-[#d4af37] focus:border-[#d4af37] bg-white/70 text-gray-900 font-semibold",value:s.roomNumber,onChange:x=>p("roomNumber",x.target.value)})]}),e.jsxs("button",{className:"h-full px-3 sm:px-4 bg-white/70 text-blue-900 rounded-full text-xs sm:text-base font-semibold border border-white/30 shadow flex items-center justify-center",onClick:()=>r("interface3"),style:{fontFamily:"inherit",letterSpacing:.2},children:[e.jsx("span",{className:"material-icons text-base mr-2",children:"translate"}),w("english","fr")]}),e.jsxs("button",{id:"confirmOrderButton",className:"h-full px-4 sm:px-8 py-2 sm:py-4 bg-[#d4af37] hover:bg-[#ffd700] text-blue-900 font-bold rounded-full shadow-lg text-base sm:text-xl transition-colors border border-white/30 flex items-center justify-center",onClick:M,style:{fontFamily:"inherit",letterSpacing:.5},children:[e.jsx("span",{className:"material-icons mr-2 text-lg sm:text-2xl",children:"check_circle"}),w("send_to_reception","fr")]})]}),e.jsx("textarea",{placeholder:w("enter_notes","fr"),className:"w-full p-2 border border-white/30 rounded-xl text-xs sm:text-sm bg-white/60 focus:bg-white/90 focus:ring-2 focus:ring-[#d4af37] transition italic font-light text-gray-500",value:C,onChange:x=>N(x.target.value),rows:3,style:{fontFamily:"inherit"}})]})})}):null},Ul=({isActive:n})=>{const{order:t,setCurrentInterface:s,language:r}=G(),a=()=>{s("interface1")};return t?e.jsx("div",{className:`absolute w-full h-full transition-opacity duration-500 ${n?"opacity-100":"opacity-0 pointer-events-none"} bg-neutral z-40`,id:"interface4",children:e.jsx("div",{className:"container mx-auto h-full flex flex-col items-center justify-center p-3 sm:p-5 text-center",children:e.jsxs("div",{className:"w-full max-w-xs sm:max-w-md bg-white rounded-lg shadow-lg p-4 sm:p-8",children:[e.jsx("div",{className:"mb-4 sm:mb-6 flex justify-center",children:e.jsx("div",{className:"w-16 h-16 sm:w-24 sm:h-24 rounded-full bg-green-500 flex items-center justify-center",children:e.jsx("span",{className:"material-icons text-white text-4xl sm:text-5xl",children:"check"})})}),e.jsx("h2",{className:"font-poppins font-bold text-xl sm:text-2xl text-primary mb-2 sm:mb-3",children:w("order_confirmed",r)}),e.jsx("p",{className:"text-gray-700 mb-4 sm:mb-6 text-sm sm:text-base",children:w("order_confirmed_message",r)}),e.jsx("div",{className:"bg-neutral p-3 sm:p-4 rounded-lg mb-4 sm:mb-6",children:e.jsxs("p",{className:"font-medium text-gray-800 text-sm sm:text-base",children:[w("order_reference",r),": ",e.jsx("span",{className:"font-bold",children:t.reference})]})}),e.jsxs("div",{className:"mb-4 sm:mb-6",children:[e.jsx("p",{className:"text-gray-600 text-xs sm:text-sm",children:w("estimated_delivery_time",r)}),e.jsx("p",{className:"font-poppins font-bold text-lg sm:text-xl",children:t.estimatedTime})]}),e.jsx("button",{className:"w-full px-4 sm:px-6 py-2 sm:py-3 bg-amber-400 text-primary-dark rounded-lg font-poppins font-medium text-sm sm:text-base",onClick:a,children:w("return_to_home",r)})]})})}):null};function qe(){const[n,t]=o.useState(null),[s,r]=o.useState(!1),{callDetails:a,addTranscript:u}=G(),h=o.useRef(0),c=o.useCallback(()=>{console.log("useWebSocket env VITE_API_HOST:",void 0),n!==null&&n.close();const T=`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}/ws`;console.log("Attempting WebSocket connection to",T);const C=new WebSocket(T);return C.onopen=()=>{console.log("WebSocket connection established"),r(!0),h.current=0,a&&C.send(JSON.stringify({type:"init",callId:a.id}))},C.onmessage=N=>{try{const p=JSON.parse(N.data);p.type==="transcript"&&u({callId:p.callId,role:p.role,content:p.content})}catch(p){console.error("Error parsing WebSocket message:",p)}},C.onclose=N=>{if(console.log("WebSocket connection closed",N),r(!1),h.current<5){const p=Math.pow(2,h.current)*1e3;console.log(`Reconnecting WebSocket in ${p}ms (attempt ${h.current+1})`),setTimeout(c,p),h.current++}else console.warn("Max WebSocket reconnection attempts reached")},C.onerror=N=>{console.error("WebSocket encountered error",N),C.readyState!==WebSocket.CLOSED&&C.close()},t(C),()=>{C.close()}},[a,u]),m=o.useCallback(v=>{n&&s?n.send(JSON.stringify(v)):console.error("Cannot send message, WebSocket not connected")},[n,s]),E=o.useCallback(()=>{s||c()},[s,c]);return o.useEffect(()=>(c(),()=>{n&&n.close()}),[]),o.useEffect(()=>{n&&s&&(a!=null&&a.id)&&(console.log("Sending init message with callId after availability",a.id),n.send(JSON.stringify({type:"init",callId:a.id})))},[a==null?void 0:a.id,n,s]),{connected:s,sendMessage:m,reconnect:E}}function Kl({currentStep:n=1,compact:t=!1,horizontal:s=!1,language:r}){const{language:a}=G?G():{language:"en"},u=r||a||"en",h=[{icon:"call",title:w("press_to_call",u),desc:w("press_to_call_desc",u)},{icon:"check_circle",title:w("confirm_request",u),desc:w("confirm_request_desc",u)},{icon:"mail",title:w("send_to_reception",u),desc:w("send_to_reception_desc",u)}];return s?e.jsx("div",{className:"flex flex-row items-center justify-center w-full gap-2 md:gap-6 py-1",children:h.map((c,m)=>e.jsxs(re.Fragment,{children:[e.jsxs("div",{className:`flex flex-col items-center transition-all duration-300 ${m+1===n?"opacity-100 scale-105":m+1<n?"opacity-60":"opacity-40"}`,children:[e.jsx("div",{className:`flex items-center justify-center rounded-full shadow-lg mb-0.5 transition-all duration-300 ${m+1===n?"bg-[#d4af37] text-blue-900 border-2 border-[#d4af37]":"bg-white/30 text-white border border-gray-200"}`,style:{width:22,height:22,fontSize:13},children:e.jsx("span",{className:"material-icons",children:c.icon})}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:`font-semibold font-poppins mb-0 text-[10px] ${m+1===n?"text-white":"text-white/70"}`,children:c.title}),e.jsx("div",{className:"font-light text-[8px] text-white/80 hidden md:block",children:c.desc})]})]}),m<h.length-1&&e.jsx("div",{className:"h-0.5 w-3 md:w-8 bg-gradient-to-r from-[#d4af37]/80 to-transparent mx-1 rounded-full"})]},c.title))}):e.jsx("div",{className:`w-full ${t?"max-w-[160px] py-2 gap-3":"max-w-xs py-6 gap-6"} mx-auto flex flex-col items-center`,children:h.map((c,m)=>e.jsxs("div",{className:`flex flex-col items-center w-full transition-all duration-300 ${m+1===n?"opacity-100 scale-105":m+1<n?"opacity-60":"opacity-40"}`,children:[e.jsx("div",{className:`flex items-center justify-center rounded-full shadow-lg mb-2 transition-all duration-300 ${m+1===n?"bg-[#d4af37] text-blue-900 border-2 border-[#d4af37]":"bg-white/30 text-white border border-gray-200"}`,style:{width:t?32:48,height:t?32:48,fontSize:t?18:28},children:e.jsx("span",{className:"material-icons",children:c.icon})}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:`font-semibold font-poppins mb-1 ${t?"text-xs":"text-base"} ${m+1===n?"text-white":"text-white/70"}`,children:c.title}),e.jsx("div",{className:`font-light ${t?"text-[10px]":"text-sm"} text-white/80`,children:c.desc})]}),m<h.length-1&&e.jsx("div",{className:`mx-auto my-1 rounded-full ${t?"w-0.5 h-4":"w-1 h-8"} bg-gradient-to-b from-[#d4af37]/80 to-transparent`})]},c.title))})}const Gl=()=>{const{currentInterface:n,language:t}=G();return qe(),e.jsxs("div",{className:"relative h-screen overflow-hidden font-sans text-gray-800 bg-neutral-50",id:"app",children:[e.jsx("header",{className:"w-full bg-primary text-white p-4 shadow-md",children:e.jsxs("div",{className:"container mx-auto flex items-center justify-between px-2",children:[e.jsx("div",{className:"w-16 flex-shrink-0 flex items-center justify-start ml-1 sm:ml-4 mr-2 sm:mr-6",children:e.jsx("img",{src:"/assets/references/images/minhon-logo.jpg",alt:"Minhon Logo",className:"h-10 sm:h-14 w-auto rounded-lg shadow-md bg-white/80 p-1"})}),e.jsx("div",{className:"flex-1 flex justify-center",children:e.jsx("div",{className:"w-full max-w-xs sm:max-w-md",children:e.jsx(Kl,{horizontal:!0,compact:!0,currentStep:n==="interface3"?3:n==="interface2"?2:1,language:t})})}),e.jsx("div",{className:"w-10 flex-shrink-0 flex items-center justify-end ml-2 sm:ml-6 mr-1 sm:mr-2",children:e.jsx(ve,{href:"/call-history",children:e.jsxs("a",{className:"flex items-center gap-1 px-2 py-1 rounded bg-primary-dark text-white text-xs sm:text-sm",children:[e.jsx(Ge,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Call History"})]})})})]})}),e.jsxs("div",{className:"relative w-full h-full",id:"interfaceContainer",children:[e.jsx(Ll,{isActive:n==="interface1"}),e.jsx(Wl,{isActive:n==="interface2"}),e.jsx(Hl,{isActive:n==="interface3"}),e.jsx(Xl,{isActive:n==="interface3vi"}),e.jsx(Yl,{isActive:n==="interface3fr"}),e.jsx(Ul,{isActive:n==="interface4"})]})]})},Be=o.forwardRef(({className:n,...t},s)=>e.jsx("div",{ref:s,className:U("rounded-lg border bg-card text-card-foreground shadow-sm",n),...t}));Be.displayName="Card";const Jl=o.forwardRef(({className:n,...t},s)=>e.jsx("div",{ref:s,className:U("flex flex-col space-y-1.5 p-6",n),...t}));Jl.displayName="CardHeader";const Zl=o.forwardRef(({className:n,...t},s)=>e.jsx("h3",{ref:s,className:U("text-2xl font-semibold leading-none tracking-tight",n),...t}));Zl.displayName="CardTitle";const Ql=o.forwardRef(({className:n,...t},s)=>e.jsx("p",{ref:s,className:U("text-sm text-muted-foreground",n),...t}));Ql.displayName="CardDescription";const ze=o.forwardRef(({className:n,...t},s)=>e.jsx("div",{ref:s,className:U("p-6 pt-0",n),...t}));ze.displayName="CardContent";const ed=o.forwardRef(({className:n,...t},s)=>e.jsx("div",{ref:s,className:U("flex items-center p-6 pt-0",n),...t}));ed.displayName="CardFooter";function td(){return e.jsx("div",{className:"min-h-screen w-full flex items-center justify-center bg-gray-50",children:e.jsx(Be,{className:"w-full max-w-md mx-4",children:e.jsxs(ze,{className:"pt-6",children:[e.jsxs("div",{className:"flex mb-4 gap-2",children:[e.jsx(Je,{className:"h-8 w-8 text-red-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"404 Page Not Found"})]}),e.jsx("p",{className:"mt-4 text-sm text-gray-600",children:"Did you forget to add the page to the router?"})]})})})}const sd=()=>{const[n,t]=o.useState(!1),[s,r]=o.useState(null),[a,u]=o.useState(null),[h,c]=o.useState(!1),[m,E]=o.useState(!1),[v,T]=o.useState("tuans2@gmail.com"),C=async()=>{try{t(!0),r(null),u(null),c(!1);const N=/iPhone|iPad|iPod|Android|Mobile|webOS|BlackBerry/i.test(navigator.userAgent);try{const p=await fetch("/api/test-email",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({toEmail:v,isMobile:N}),cache:"no-cache"});if(!p.ok)throw new Error(`Standard endpoint failed: ${p.statusText}`);const M=await p.json();if(M.success){r(`Email sent successfully using standard method! Provider: ${M.provider||"unknown"}`),c(!0),setTimeout(()=>c(!1),1500),t(!1);return}else console.warn("Standard method failed, trying mobile-specific endpoint")}catch(p){console.error("Error with standard endpoint:",p)}try{const p=new Date().getTime(),M=await fetch(`/api/mobile-test-email?_=${p}`,{method:"POST",headers:{"Content-Type":"application/json","X-Device-Type":N?"mobile":"desktop","Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"},body:JSON.stringify({toEmail:v,timestamp:p,deviceInfo:navigator.userAgent}),cache:"no-cache",credentials:"same-origin",keepalive:!0});if(!M.ok)throw new Error(`Mobile endpoint failed: ${M.statusText}`);const x=await M.json();if(x.success)r(`Email đang được xử lý qua endpoint tối ưu hóa cho ${N?"di động":"desktop"}! Vui lòng kiểm tra hộp thư sau vài giây.`),c(!0),setTimeout(()=>c(!1),1500);else throw new Error(x.error||"Lỗi không xác định với endpoint di động")}catch(p){throw console.error("Chi tiết lỗi mobile endpoint:",p),new Error(`Không thể gửi email: ${(p==null?void 0:p.message)||"Lỗi không xác định"}`)}}catch(N){u(N instanceof Error?N.message:"An unexpected error occurred"),E(!0),setTimeout(()=>E(!1),500)}finally{t(!1)}};return e.jsxs("div",{className:`p-4 bg-white rounded-lg shadow transition-all duration-300 hover:shadow-xl ${m?"animate-shake":""}`,children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Email Tester"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Test Email Address"}),e.jsx("input",{type:"email",id:"email",value:v,onChange:N=>T(N.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-200 focus:border-blue-400",disabled:n})]}),e.jsx("button",{onClick:C,disabled:n,className:`w-full py-2 px-4 rounded-md text-white font-medium transition-all duration-200 hover:scale-105 active:scale-95 hover:shadow-lg focus:ring-2 focus:ring-blue-400 ${n?"bg-blue-400 cursor-not-allowed":h?"bg-green-500":"bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"}`,children:n?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),"Sending..."]}):h?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(Te,{className:"h-5 w-5 text-white mr-2 animate-bounceIn"}),"Đã gửi!"]}):"Send Test Email"}),a&&e.jsxs("div",{className:"mt-4 bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded relative",role:"alert",children:[e.jsx("strong",{className:"font-bold",children:"Error: "}),e.jsx("span",{className:"block sm:inline",children:a})]}),s&&e.jsxs("div",{className:"mt-4 bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded relative",role:"alert",children:[e.jsx("strong",{className:"font-bold",children:"Success: "}),e.jsx("span",{className:"block sm:inline",children:s})]})]})},nd=({onLogin:n})=>{const[t,s]=o.useState(""),[r,a]=o.useState(""),[u,h]=o.useState(""),[c,m]=o.useState(!1),[E,v]=o.useState(!1),[T,C]=o.useState(!1),N=async p=>{if(p.preventDefault(),!t||!r){h("Please enter both username and password."),C(!0),setTimeout(()=>C(!1),500);return}h(""),m(!0),v(!1);try{const M=await fetch("/api/staff/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:t,password:r})});if(!M.ok){const d=await M.json();throw new Error(d.error||"Login failed.")}const x=await M.json();if(x.token)localStorage.setItem("staff_token",x.token),v(!0),setTimeout(()=>v(!1),1500),n();else throw new Error("Login failed: No token received.")}catch(M){console.error("Login error:",M),h(M instanceof Error?M.message:"Login failed: Network or server error."),C(!0),setTimeout(()=>C(!1),500)}finally{m(!1)}};return e.jsx("div",{className:`min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8 ${T?"animate-shake":""}`,children:e.jsxs("div",{className:"max-w-md w-full space-y-8",children:[e.jsx("div",{children:e.jsx("h2",{className:"mt-6 text-center text-3xl font-extrabold text-gray-900",children:"Staff Login"})}),e.jsxs("form",{className:"mt-8 space-y-6",onSubmit:N,children:[e.jsxs("div",{className:"rounded-md shadow-sm -space-y-px",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"username",className:"sr-only",children:"Username"}),e.jsx("input",{id:"username",name:"username",type:"text",required:!0,className:"appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-t-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 focus:z-10 sm:text-sm transition-all duration-200 focus:ring-2",placeholder:"Username",value:t,onChange:p=>s(p.target.value),disabled:c})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"sr-only",children:"Password"}),e.jsx("input",{id:"password",name:"password",type:"password",required:!0,className:"appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-b-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 focus:z-10 sm:text-sm transition-all duration-200 focus:ring-2",placeholder:"Password",value:r,onChange:p=>a(p.target.value),disabled:c})]})]}),u&&e.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded relative",role:"alert",children:[e.jsx("strong",{className:"font-bold",children:"Error: "}),e.jsx("span",{className:"block sm:inline",children:u})]}),e.jsx("div",{children:e.jsx("button",{type:"submit",disabled:c,className:`group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white transition-all duration-200 hover:scale-105 active:scale-95 hover:shadow-lg focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 ${c?"bg-blue-400 cursor-not-allowed":E?"bg-green-500":"bg-blue-600 hover:bg-blue-700"}`,children:c?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"absolute left-0 inset-y-0 flex items-center pl-3",children:e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"})}),e.jsx("span",{className:"pl-6",children:"Logging in..."})]}):E?e.jsxs(e.Fragment,{children:[e.jsx(Te,{className:"h-5 w-5 text-white mr-2 animate-bounceIn"}),"Đăng nhập thành công!"]}):"Sign in"})})]})]})})},rd=["Đã ghi nhận","Đang thực hiện","Đã thực hiện và đang bàn giao cho khách","Hoàn thiện","Lưu ý khác"],od=({request:n,onClose:t,onStatusChange:s,onOpenMessage:r})=>{const[a,u]=o.useState(n.status),[h,c]=o.useState(!1),[m,E]=o.useState(null),[v,T]=o.useState(null),C=o.useRef(null);if(!n)return null;o.useEffect(()=>{const p='button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])',M=C.current;if(!M)return;const x=M.querySelectorAll(p),d=x[0],S=x[x.length-1],y=$=>{if($.key==="Escape"&&($.preventDefault(),t()),$.key==="Tab"){if(x.length===0)return;$.shiftKey?document.activeElement===d&&($.preventDefault(),S.focus()):document.activeElement===S&&($.preventDefault(),d.focus())}};return M.addEventListener("keydown",y),setTimeout(()=>d==null?void 0:d.focus(),0),()=>M.removeEventListener("keydown",y)},[t]);const N=async()=>{if(a!==n.status){c(!0),E(null),T(null);try{await Promise.resolve(s(a)),T("Cập nhật trạng thái thành công!")}catch{E("Cập nhật trạng thái thất bại. Vui lòng thử lại.")}finally{c(!1)}}};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40",children:e.jsxs("div",{ref:C,className:"bg-white rounded-xl shadow-xl p-6 w-full max-w-lg relative transition-all duration-300 focus-within:ring-2 focus-within:ring-blue-400",role:"dialog","aria-modal":"true","aria-labelledby":"modal-title",tabIndex:-1,children:[e.jsx("button",{className:"absolute top-2 right-2 text-gray-500 hover:text-blue-700 transition-all duration-200 focus:ring-2 focus:ring-blue-400",onClick:t,"aria-label":"Đóng modal",children:"×"}),e.jsx("h3",{id:"modal-title",className:"text-xl font-bold text-blue-900 mb-4",children:"Request Details"}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("div",{children:[e.jsx("b",{children:"Room:"})," ",n.room]}),e.jsxs("div",{children:[e.jsx("b",{children:"Order ID:"})," ",n.id]}),e.jsxs("div",{children:[e.jsx("b",{children:"Guest Name:"})," ",n.guestName]}),e.jsxs("div",{children:[e.jsx("b",{children:"Content:"})," ",n.content]}),e.jsxs("div",{children:[e.jsx("b",{children:"Time:"})," ",n.time]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("b",{children:"Status:"}),e.jsx("select",{className:"border rounded px-2 py-1 text-xs",value:a,onChange:p=>u(p.target.value),disabled:h,children:rd.map(p=>e.jsx("option",{value:p,children:p},p))})]}),e.jsxs("div",{children:[e.jsx("b",{children:"Notes:"})," ",n.notes||"-"]})]}),m&&e.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-700 px-3 py-2 rounded mb-2 text-sm",role:"alert",children:[e.jsx("strong",{className:"font-bold",children:"Lỗi: "}),e.jsx("span",{children:m})]}),v&&e.jsxs("div",{className:"bg-green-50 border border-green-200 text-green-700 px-3 py-2 rounded mb-2 text-sm",role:"alert",children:[e.jsx("strong",{className:"font-bold",children:"Thành công: "}),e.jsx("span",{children:v})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsxs("button",{className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded font-semibold flex items-center justify-center transition-all duration-200 hover:scale-105 active:scale-95 hover:shadow-lg focus:ring-2 focus:ring-blue-400",onClick:N,disabled:h||a===n.status,children:[h?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}):null,"Cập Nhật"]}),e.jsx("button",{className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded font-semibold transition-all duration-200 hover:scale-105 active:scale-95 hover:shadow-lg focus:ring-2 focus:ring-green-400",onClick:r,disabled:h,children:"Nhắn khách"}),e.jsx("button",{className:"bg-gray-300 hover:bg-gray-400 text-gray-800 px-4 py-2 rounded font-semibold transition-all duration-200 hover:scale-105 active:scale-95 hover:shadow-lg focus:ring-2 focus:ring-gray-400",onClick:t,disabled:h,children:"Đóng"})]})]})})},id=({messages:n,onSend:t,onClose:s,loading:r})=>{const[a,u]=o.useState(""),[h,c]=o.useState(null),m=o.useRef(null);o.useEffect(()=>{const v='button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])',T=m.current;if(!T)return;const C=T.querySelectorAll(v),N=C[0],p=C[C.length-1],M=x=>{if(x.key==="Escape"&&(x.preventDefault(),s()),x.key==="Tab"){if(C.length===0)return;x.shiftKey?document.activeElement===N&&(x.preventDefault(),p.focus()):document.activeElement===p&&(x.preventDefault(),N.focus())}};return T.addEventListener("keydown",M),setTimeout(()=>N==null?void 0:N.focus(),0),()=>T.removeEventListener("keydown",M)},[s]);const E=()=>{if(a.trim()){c(null);try{t(a),u("")}catch{c("Không thể gửi tin nhắn. Vui lòng thử lại.")}}};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40",children:e.jsxs("div",{ref:m,className:"bg-white rounded-xl shadow-xl p-5 w-full max-w-md relative flex flex-col transition-all duration-300 focus-within:ring-2 focus-within:ring-blue-400",role:"dialog","aria-modal":"true","aria-labelledby":"popup-title",tabIndex:-1,children:[e.jsx("button",{className:"absolute top-2 right-2 text-gray-500 hover:text-blue-700 transition-all duration-200 focus:ring-2 focus:ring-blue-400",onClick:s,"aria-label":"Đóng popup",children:"×"}),e.jsx("h3",{id:"popup-title",className:"text-lg font-bold text-blue-900 mb-3",children:"Nhắn tin tới Guest"}),e.jsx("div",{className:"flex-1 overflow-y-auto mb-3 max-h-60 border rounded p-2 bg-gray-50",children:n.length===0?e.jsx("div",{className:"text-gray-400 text-sm text-center",children:"Chưa có tin nhắn"}):n.map(v=>e.jsxs("div",{className:`mb-2 ${v.sender==="staff"?"text-right":"text-left"}`,children:[e.jsxs("div",{className:`inline-block px-3 py-1 rounded-lg ${v.sender==="staff"?"bg-blue-100 text-blue-900":"bg-gray-200 text-gray-800"}`,children:[e.jsxs("span",{className:"font-semibold",children:[v.sender==="staff"?"Staff":"Guest",":"]})," ",v.content]}),e.jsx("div",{className:"text-xs text-gray-400 mt-0.5",children:v.time})]},v.id))}),h&&e.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-700 px-3 py-2 rounded mb-2 text-sm",role:"alert",children:[e.jsx("strong",{className:"font-bold",children:"Lỗi: "}),e.jsx("span",{children:h})]}),e.jsxs("div",{className:"flex gap-2 mt-2 items-center",children:[e.jsx("input",{type:"text",className:"flex-1 border rounded px-2 py-1 transition-all duration-200 focus:ring-2 focus:ring-blue-400 focus:border-blue-400",placeholder:"Nhập tin nhắn...",value:a,onChange:v=>u(v.target.value),onKeyDown:v=>{v.key==="Enter"&&E()},disabled:r}),e.jsx("button",{className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-1 rounded font-semibold flex items-center justify-center transition-all duration-200 hover:scale-105 active:scale-95 hover:shadow-lg focus:ring-2 focus:ring-blue-400",onClick:E,disabled:r||!a.trim(),children:r?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}):"Gửi"})]})]})})},me=["Tất cả","Đã ghi nhận","Đang thực hiện","Đã thực hiện và đang bàn giao cho khách","Hoàn thiện","Lưu ý khác"],ye=n=>{switch(n){case"Đã ghi nhận":return"bg-gray-300 text-gray-800";case"Đang thực hiện":return"bg-yellow-200 text-yellow-800";case"Đã thực hiện và đang bàn giao cho khách":return"bg-blue-200 text-blue-800";case"Hoàn thiện":return"bg-green-200 text-green-800";case"Lưu ý khác":return"bg-red-200 text-red-800";default:return"bg-gray-100 text-gray-700"}},ad=()=>{const[n,t]=o.useState([]),[s,r]=o.useState(null),[a,u]=o.useState(!1),[h,c]=o.useState(!1),[m,E]=o.useState([]),[v,T]=o.useState(!1),[C,N]=o.useState(!1),[p,M]=o.useState(null),[x,d]=o.useState("Tất cả"),[S,y]=o.useState(""),[$,D]=o.useState(""),[j,l]=o.useState(null),[k,F]=o.useState(!1),[B,g]=o.useState(!1),[b,_]=o.useState(""),[I,z]=o.useState(""),[L,P]=o.useState({}),R=it(),H=()=>localStorage.getItem("staff_token"),W=async()=>{const i=H();if(!i){R("/staff");return}try{N(!0),M(null);const f=await fetch("/api/staff/requests",{headers:{Authorization:`Bearer ${i}`},credentials:"include"});if(f.status===401){localStorage.removeItem("staff_token"),R("/staff");return}if(!f.ok)throw new Error(`Failed to fetch requests: ${f.statusText}`);const A=await f.json();t(A)}catch(f){console.error("Failed to fetch requests:",f),M("Failed to load requests. Please try again later.")}finally{N(!1)}};o.useEffect(()=>{W();const i=setInterval(W,3e4);return()=>clearInterval(i)},[]);const X=()=>{u(!1),r(null)},Z=async(i,f)=>{const A=H();if(!A)return R("/staff");try{await fetch(`/api/staff/requests/${f}/status`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${A}`},credentials:"include",body:JSON.stringify({status:i})}),t(J=>J.map(K=>K.id===f?{...K,status:i}:K)),s&&s.id===f&&r({...s,status:i})}catch(J){console.error("Failed to update status:",J)}},Q=async()=>{if(c(!0),!s)return;const i=H();if(!i)return R("/staff");try{const A=await(await fetch(`/api/staff/requests/${s.id}/messages`,{headers:{Authorization:`Bearer ${i}`},credentials:"include"})).json();E(A)}catch{E([])}},ue=()=>c(!1),he=async i=>{T(!0);const f=H();if(!f)return R("/staff");try{await fetch(`/api/staff/requests/${s.id}/message`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${f}`},credentials:"include",body:JSON.stringify({content:i})}),E(A=>[...A,{id:(A.length+1).toString(),sender:"staff",content:i,time:new Date().toLocaleTimeString().slice(0,5)}])}catch{}T(!1)},ce=async()=>{g(!0),_(""),z("")},q=async()=>{if(b!=="2208"){z("Mật khẩu không đúng");return}F(!0);try{const i=H();if(!i)return g(!1),R("/staff");const A=await(await fetch("/api/staff/requests/all",{method:"DELETE",headers:{Authorization:`Bearer ${i}`},credentials:"include"})).json();g(!1),A.success?(alert(`${A.message}`),t([])):alert(`Lỗi: ${A.error||"Không thể xóa requests"}`)}catch(i){console.error("Error deleting all requests:",i),alert("Đã xảy ra lỗi khi xóa requests"),g(!1)}finally{F(!1),_("")}},O=n.filter(i=>{if(x!=="Tất cả"&&i.status!==x)return!1;if(S||$){const f=new Date(i.created_at);if(S){const A=new Date(S);if(A.setHours(0,0,0,0),f<A)return!1}if($){const A=new Date($);if(A.setHours(23,59,59,999),f>A)return!1}}return!0}),V=i=>{i.key==="Enter"&&q(),I&&z("")},ee=i=>{i.stopPropagation()};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-blue-200 p-2 sm:p-6",children:[e.jsxs("div",{className:"max-w-7xl mx-auto bg-white rounded-xl shadow-lg p-3 sm:p-6 border border-gray-200",children:[e.jsxs("div",{className:"flex flex-col items-center mb-6",children:[e.jsx("img",{src:"/assets/references/images/minhon-logo.jpg",alt:"Minhon Logo",className:"h-16 object-contain mb-2"}),e.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-blue-900 text-center",children:"Staff Request Management"})]}),p&&e.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded relative mb-4",role:"alert",children:[e.jsx("strong",{className:"font-bold",children:"Error: "}),e.jsx("span",{className:"block sm:inline",children:p}),e.jsxs("button",{onClick:()=>M(null),className:"absolute top-0 bottom-0 right-0 px-4 py-3",children:[e.jsx("span",{className:"sr-only",children:"Dismiss"}),e.jsx("svg",{className:"h-6 w-6 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})]})]}),C?e.jsxs("div",{className:"flex items-center justify-center p-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"}),e.jsx("span",{className:"ml-2",children:"Loading requests..."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between mb-4",children:[e.jsx("button",{onClick:ce,disabled:k||n.length===0,className:`w-auto bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded font-semibold transition-all duration-200 hover:scale-105 active:scale-95 hover:shadow-lg focus:ring-2 focus:ring-red-400 ${k||n.length===0?"opacity-50 cursor-not-allowed":""}`,children:k?e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Deleting..."]}):"Delete All Requests"}),e.jsx("button",{onClick:W,className:"w-auto bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded font-semibold transition-all duration-200 hover:scale-105 active:scale-95 hover:shadow-lg focus:ring-2 focus:ring-blue-400",children:"Refresh"})]}),e.jsxs("div",{className:"mb-4 grid grid-cols-1 gap-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2 sm:gap-3",children:[e.jsx("label",{className:"font-semibold text-blue-900 w-full sm:w-auto",children:"Lọc theo trạng thái:"}),e.jsx("select",{className:"w-full sm:w-auto border rounded px-3 py-1 text-sm",value:x,onChange:i=>d(i.target.value),children:me.map(i=>e.jsx("option",{value:i,children:i},i))})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 sm:gap-3",children:[e.jsx("label",{className:"font-semibold text-blue-900 w-full sm:w-auto",children:"Lọc theo thời gian:"}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-2 w-full sm:w-auto",children:[e.jsxs("div",{className:"flex items-center gap-2 w-full sm:w-auto",children:[e.jsx("label",{className:"text-sm text-gray-600 min-w-10",children:"Từ:"}),e.jsx("input",{type:"date",className:"border rounded px-2 py-1 text-sm w-full",value:S,onChange:i=>y(i.target.value)})]}),e.jsxs("div",{className:"flex items-center gap-2 w-full sm:w-auto",children:[e.jsx("label",{className:"text-sm text-gray-600 min-w-10",children:"Đến:"}),e.jsx("input",{type:"date",className:"border rounded px-2 py-1 text-sm w-full",value:$,onChange:i=>D(i.target.value)})]}),(S||$)&&e.jsx("button",{onClick:()=>{y(""),D("")},className:"text-blue-600 hover:text-blue-800 text-sm mt-2 sm:mt-0",children:"Xóa lọc"})]})]})]}),e.jsx("div",{className:"block sm:hidden",children:e.jsxs("div",{className:"space-y-4",children:[(console.log("Mobile rendering - filteredRequests:",O),null),O.length>0?[...O].sort((i,f)=>new Date(f.created_at).getTime()-new Date(i.created_at).getTime()).map(i=>e.jsxs("div",{className:"border rounded-lg p-3 bg-white shadow-sm transition-all duration-200 hover:shadow-lg hover:scale-[1.02]",children:[e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsxs("div",{className:"font-semibold",children:["Phòng: ",i.room_number||"N/A"]}),e.jsx("div",{className:`px-2 py-1 rounded-full text-xs font-semibold ${ye(i.status)}`,children:i.status||"Chưa xác định"})]}),e.jsxs("div",{className:"text-sm text-gray-500 mb-2",children:["Order ID: ",i.orderId||i.id||"N/A"]}),e.jsx("div",{className:"text-xs text-gray-500 mb-3",children:i.created_at?e.jsxs(e.Fragment,{children:[new Date(i.created_at).toLocaleDateString()," ",new Date(i.created_at).toLocaleTimeString()]}):"Thời gian không xác định"}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("button",{onClick:()=>l(j===i.id?null:i.id),className:"w-full flex justify-between items-center py-1 px-2 border rounded bg-gray-50 hover:bg-gray-100",children:[e.jsx("span",{className:"text-sm font-medium text-blue-700",children:j===i.id?"Ẩn nội dung":"Xem nội dung"}),e.jsx("svg",{className:`w-4 h-4 text-blue-700 transition-transform ${j===i.id?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 9l-7 7-7-7"})})]}),j===i.id&&e.jsx("div",{className:"mt-2 p-2 bg-gray-50 rounded-md whitespace-pre-line break-words text-sm",children:i.request_content||"Không có nội dung"})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("select",{className:"border rounded px-2 py-2 text-sm w-full",value:L[i.id]??i.status,onChange:f=>P(A=>({...A,[i.id]:f.target.value})),children:me.filter(f=>f!=="Tất cả").map(f=>e.jsx("option",{value:f,children:f},f))}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("button",{className:"bg-blue-600 hover:bg-blue-700 text-white px-2 py-2 rounded text-sm font-semibold transition-all duration-200 hover:scale-105 active:scale-95 hover:shadow-lg focus:ring-2 focus:ring-blue-400",onClick:async()=>{const f=L[i.id];f&&f!==i.status&&(await Z(f,i.id),P(A=>{const{[i.id]:J,...K}=A;return K}))},children:"Cập Nhật"}),e.jsx("button",{className:"bg-green-600 hover:bg-green-700 text-white px-2 py-2 rounded text-sm font-semibold transition-all duration-200 hover:scale-105 active:scale-95 hover:shadow-lg focus:ring-2 focus:ring-green-400",onClick:()=>{r(i),Q()},children:"Nhắn khách"})]})]})]},i.id)):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("p",{children:"Không có yêu cầu nào"}),e.jsx("p",{className:"mt-2 text-sm",children:"Nhấn Refresh để tải lại dữ liệu"})]})]})}),e.jsx("div",{className:"hidden sm:block overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-blue-100 text-blue-900",children:[e.jsx("th",{className:"py-2 px-3 text-left",children:"Room"}),e.jsx("th",{className:"py-2 px-3 text-left",children:"Order ID"}),e.jsx("th",{className:"py-2 px-6 text-left w-3/5",children:"Content"}),e.jsx("th",{className:"py-2 px-3 text-left",children:"Time"}),e.jsx("th",{className:"py-2 px-2 text-left w-1/12",children:"Status"}),e.jsx("th",{className:"py-2 px-3 text-left",children:"Action"})]})}),e.jsxs("tbody",{children:[(Array.isArray(O)?[...O].sort((i,f)=>new Date(f.created_at).getTime()-new Date(i.created_at).getTime()):[]).map(i=>e.jsxs("tr",{className:"border-b hover:bg-blue-50",children:[e.jsx("td",{className:"py-2 px-3 font-semibold",children:i.room_number}),e.jsx("td",{className:"py-2 px-3",children:i.orderId||i.id}),e.jsx("td",{className:"py-2 px-6 whitespace-pre-line break-words max-w-4xl",children:i.request_content}),e.jsxs("td",{className:"py-2 px-3",children:[i.created_at&&e.jsx("span",{className:"block whitespace-nowrap",children:new Date(i.created_at).toLocaleDateString()}),i.created_at&&e.jsx("span",{className:"block whitespace-nowrap text-xs text-gray-500",children:new Date(i.created_at).toLocaleTimeString()})]}),e.jsx("td",{className:"py-2 px-2",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-semibold ${ye(i.status)} break-words whitespace-normal block text-center`,children:i.status})}),e.jsxs("td",{className:"py-2 px-3 space-x-2",children:[e.jsx("select",{className:"border rounded px-2 py-1 text-xs",value:L[i.id]??i.status,onChange:f=>P(A=>({...A,[i.id]:f.target.value})),children:me.filter(f=>f!=="Tất cả").map(f=>e.jsx("option",{value:f,children:f},f))}),e.jsx("button",{className:"bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-xs font-semibold transition-all duration-200 hover:scale-105 active:scale-95 hover:shadow-lg focus:ring-2 focus:ring-blue-400",onClick:async()=>{const f=L[i.id];f&&f!==i.status&&(await Z(f,i.id),P(A=>{const{[i.id]:J,...K}=A;return K}))},children:"Cập Nhật"}),e.jsx("button",{className:"bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-xs font-semibold transition-all duration-200 hover:scale-105 active:scale-95 hover:shadow-lg focus:ring-2 focus:ring-green-400",onClick:()=>{r(i),Q()},children:"Nhắn khách"})]})]},i.id)),O.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"py-8 text-center text-gray-500",children:"Không có yêu cầu nào"})})]})]})})]})]}),a&&s&&e.jsx(od,{request:s,onClose:X,onStatusChange:i=>Z(i,s.id),onOpenMessage:Q}),h&&s&&e.jsx(id,{messages:m,onClose:ue,onSend:he,loading:v}),B&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg w-full max-w-md mx-4",onClick:ee,children:[e.jsx("h3",{className:"text-lg font-bold text-red-600 mb-4",children:"Confirm Delete All Requests"}),e.jsx("p",{className:"mb-4 text-gray-700",children:"This action will delete all requests and cannot be undone. Please enter the password to confirm:"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("input",{type:"password",value:b,onChange:i=>_(i.target.value),onKeyDown:V,className:`w-full px-3 py-2 border rounded ${I?"border-red-500":"border-gray-300"} focus:outline-none focus:ring-2 focus:ring-red-500`,placeholder:"Enter confirmation password",autoFocus:!0}),I&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:I}),e.jsx("p",{className:"text-gray-500 text-xs mt-2 italic",children:"Security measure: Delete function requires password confirmation to prevent accidental data loss."})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:()=>g(!1),className:"px-4 py-2 bg-gray-300 hover:bg-gray-400 rounded transition duration-200",children:"Cancel"}),e.jsx("button",{onClick:q,disabled:k,className:"px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded transition duration-200 flex items-center disabled:opacity-70",children:k?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Deleting..."]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"Confirm Delete"]})})]})]})})]})},cd=()=>{const[n,t]=o.useState(!1),s=()=>t(!0);return n?e.jsx(ad,{}):e.jsx(nd,{onLogin:s})},ld=re.lazy(()=>Ee(()=>import("./CallHistory-ChEkosKA.js"),__vite__mapDeps([0,1,2,3,4,5,6]))),dd=re.lazy(()=>Ee(()=>import("./CallDetails-BQOH_du0.js"),__vite__mapDeps([7,1,2,3,4,5,6]))),md=()=>e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsxs("div",{className:"container mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Kiểm tra Tính năng Email"}),e.jsx(ve,{href:"/",className:"px-4 py-2 bg-primary text-white rounded-md hover:bg-primary/90",children:"Quay lại Trang Chính"})]}),e.jsx(sd,{})]})});function ud(){return e.jsx(ct,{mode:"wait",children:e.jsxs(Ve,{children:[e.jsx(te,{path:"/call-history",component:()=>e.jsx(se.div,{initial:{opacity:0,x:40},animate:{opacity:1,x:0},exit:{opacity:0,x:-40},transition:{duration:.3},children:e.jsx(ld,{})})}),e.jsx(te,{path:"/call-details/:callId",component:()=>e.jsx(se.div,{initial:{opacity:0,x:40},animate:{opacity:1,x:0},exit:{opacity:0,x:-40},transition:{duration:.3},children:e.jsx(dd,{})})}),e.jsx(te,{path:"/email-test",component:()=>e.jsx(se.div,{initial:{opacity:0,y:40},animate:{opacity:1,y:0},exit:{opacity:0,y:-40},transition:{duration:.3},children:e.jsx(md,{})})}),e.jsx(te,{path:"/staff",component:()=>e.jsx(se.div,{initial:{opacity:0,y:40},animate:{opacity:1,y:0},exit:{opacity:0,y:-40},transition:{duration:.3},children:e.jsx(cd,{})})}),e.jsx(te,{path:"/",component:()=>e.jsx(se.div,{initial:{opacity:0,scale:.98},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.98},transition:{duration:.3},children:e.jsx(Gl,{})})}),e.jsx(te,{component:()=>e.jsx(se.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},children:e.jsx(td,{})})})]})})}function hd(){return qe(),e.jsx(at,{children:e.jsx(Le,{children:e.jsxs(ht,{children:[e.jsx(ud,{}),e.jsx(jt,{})]})})})}async function xd(n){if(!n.ok){const t=await n.text()||n.statusText;throw new Error(`${n.status}: ${t}`)}}const pd=({on401:n})=>async({queryKey:t})=>{const s=await fetch(t[0],{credentials:"include"});return await xd(s),await s.json()},fd=new lt({defaultOptions:{queries:{queryFn:pd({on401:"throw"}),refetchInterval:!1,refetchOnWindowFocus:!1,staleTime:1/0,retry:!1},mutations:{retry:!1}}});We(document.getElementById("root")).render(e.jsx(dt,{client:fd,children:e.jsx(Le,{children:e.jsx(hd,{})})}));
