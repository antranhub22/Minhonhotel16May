import{r as u,R as b,j as e}from"./react-BlJs-Rj_.js";import{u as p}from"./@tanstack-H40tjzcj.js";import{u as f,L as j}from"./wouter-DSgBA37d.js";import"./@daily-co-CRt2XSsO.js";import"./regexparam-CPXopyEH.js";import"./use-sync-external-store-T8uco2Ip.js";const D=()=>{const{callId:r}=f(),[l,n]=u.useState(!1),[i,c]=u.useState(null),{data:t,isLoading:m,isError:x}=p({queryKey:["summary",r],queryFn:async()=>{const s=await fetch(`/api/summaries/${r}`);if(!s.ok)throw new Error(`Failed to fetch call summary: ${s.statusText}`);return s.json()}}),{data:a,isLoading:h,isError:g}=p({queryKey:["transcripts",r],queryFn:async()=>{const s=await fetch(`/api/transcripts/${r}`);if(!s.ok)throw new Error(`Failed to fetch call transcripts: ${s.statusText}`);return s.json()}});b.useEffect(()=>{x?c("Failed to load call summary. Please try again later."):g&&c("Failed to load call transcripts. Please try again later.")},[x,g]);const o=s=>s?(s instanceof Date?s:new Date(s)).toLocaleString("en-US",{year:"numeric",month:"numeric",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"}):"Unknown",y=s=>s||"00:00",N=async()=>{if(a!=null&&a.length)try{n(!0);const s=a.map(d=>`${d.role==="assistant"?"Assistant":"Guest"}: ${d.content}`).join(`

`);await navigator.clipboard.writeText(s),setTimeout(()=>{n(!1)},1500)}catch(s){console.error("Could not copy text: ",s),n(!1)}};return e.jsxs("div",{className:"container mx-auto p-5",children:[e.jsx("header",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h1",{className:"text-3xl font-bold text-primary",children:"Call Details"}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx(j,{to:"/call-history",children:e.jsxs("button",{className:"px-4 py-2 rounded-md bg-gray-200 text-gray-700 hover:bg-gray-300 transition-colors flex items-center",children:[e.jsx("span",{className:"material-icons align-middle mr-1 text-sm",children:"history"}),"Call History"]})}),e.jsx(j,{to:"/",children:e.jsxs("button",{className:"px-4 py-2 rounded-md bg-gray-200 text-gray-700 hover:bg-gray-300 transition-colors flex items-center",children:[e.jsx("span",{className:"material-icons align-middle mr-1 text-sm",children:"home"}),"Home"]})})]})]})}),i&&e.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded relative mb-4",role:"alert",children:[e.jsx("strong",{className:"font-bold",children:"Error: "}),e.jsx("span",{className:"block sm:inline",children:i}),e.jsxs("button",{onClick:()=>c(null),className:"absolute top-0 bottom-0 right-0 px-4 py-3",children:[e.jsx("span",{className:"sr-only",children:"Dismiss"}),e.jsx("svg",{className:"h-6 w-6 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})]})]}),(m||h)&&e.jsxs("div",{className:"flex items-center justify-center p-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"}),e.jsx("span",{className:"ml-2",children:"Loading call details..."})]}),!m&&!h&&!i&&e.jsxs("main",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"col-span-1 lg:col-span-3",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"Call Information"}),e.jsxs("div",{className:"bg-blue-100 px-3 py-1 rounded-full text-blue-700 text-xs font-medium",children:["ID: ",r]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Time"}),e.jsx("p",{className:"text-sm font-medium",children:o(t==null?void 0:t.timestamp)})]}),e.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Room"}),e.jsx("p",{className:"text-sm font-medium",children:(t==null?void 0:t.roomNumber)||"Unknown"})]}),e.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Duration"}),e.jsx("p",{className:"text-sm font-medium",children:y(t==null?void 0:t.duration)})]}),e.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Messages"}),e.jsx("p",{className:"text-sm font-medium",children:(a==null?void 0:a.length)||0})]})]})]})}),e.jsx("div",{className:"col-span-1 lg:col-span-2",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm h-full",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"Conversation History"}),e.jsxs("button",{onClick:N,disabled:l||!(a!=null&&a.length),className:`px-3 py-1 rounded-md text-sm flex items-center ${l?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[e.jsx("span",{className:"material-icons text-sm mr-1",children:l?"check":"content_copy"}),l?"Copied":"Copy"]})]}),a!=null&&a.length?e.jsx("div",{className:"space-y-4 overflow-y-auto max-h-[500px] pr-2",children:a.map(s=>e.jsx("div",{className:`flex ${s.role==="assistant"?"justify-start":"justify-end"}`,children:e.jsxs("div",{className:`max-w-[75%] p-3 rounded-lg relative ${s.role==="assistant"?"bg-blue-50 text-blue-900":"bg-gray-100 text-gray-900"}`,children:[e.jsxs("div",{className:"text-xs text-gray-500 mb-1",children:[s.role==="assistant"?"Assistant":"Guest"," â€¢ ",o(s.timestamp)]}),e.jsx("p",{className:"text-sm",children:s.content})]})},s.id))}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-center",children:[e.jsx("span",{className:"material-icons text-gray-300 text-4xl mb-2",children:"chat"}),e.jsx("p",{className:"text-gray-500",children:"No conversation data"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Conversation details may have been deleted or not recorded."})]})]})}),e.jsx("div",{className:"col-span-1",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm h-full",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:"Call Summary"}),t!=null&&t.content?e.jsxs("div",{className:"p-4 bg-blue-50 rounded-lg overflow-y-auto",style:{maxHeight:"500px"},children:[e.jsx("div",{className:"text-sm text-blue-900 whitespace-pre-line",children:t.content}),e.jsx("div",{className:"mt-3 text-right",children:e.jsxs("span",{className:"text-xs text-gray-500",children:["Generated at ",o(t.timestamp)]})})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-center",children:[e.jsx("span",{className:"material-icons text-gray-300 text-4xl mb-2",children:"summarize"}),e.jsx("p",{className:"text-gray-500",children:"No summary available"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Call summary could not be generated."})]})]})})]}),e.jsx("div",{className:"mt-6 text-center text-gray-500 text-sm",children:e.jsx("p",{children:"Call history is stored for the last 24 hours"})})]})};export{D as default};
