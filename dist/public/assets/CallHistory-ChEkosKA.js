import{r as o,j as e}from"./react-BlJs-Rj_.js";import{u as j}from"./@tanstack-H40tjzcj.js";import{L as m}from"./wouter-DSgBA37d.js";import"./@daily-co-CRt2XSsO.js";import"./regexparam-CPXopyEH.js";import"./use-sync-external-store-T8uco2Ip.js";const S=()=>{const[s,d]=o.useState(24),[a,x]=o.useState(""),{data:r,isLoading:h,isError:u,refetch:c}=j({queryKey:["summaries","recent",s],queryFn:async()=>{const t=await fetch(`/api/summaries/recent/${s}`);if(!t.ok)throw new Error("Failed to fetch recent call summaries");return t.json()}}),g=t=>(t instanceof Date?t:new Date(t)).toLocaleString("en-US",{year:"numeric",month:"numeric",day:"numeric",hour:"2-digit",minute:"2-digit"}),b=t=>{if(!t)return"00:00";const n=parseInt(t,10);if(!isNaN(n)&&/^\d+$/.test(t)){const p=Math.floor(n/60).toString().padStart(2,"0"),f=(n%60).toString().padStart(2,"0");return`${p}:${f}`}return t},i=t=>{d(t)},l=r==null?void 0:r.summaries.filter(t=>a?t.roomNumber&&t.roomNumber.toLowerCase().includes(a.toLowerCase()):!0);return e.jsxs("div",{className:"container mx-auto p-5",children:[e.jsxs("header",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h1",{className:"text-3xl font-bold text-primary",children:"Call History"}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx(m,{to:"/",children:e.jsxs("button",{className:"px-4 py-2 rounded-md bg-gray-200 text-gray-700 hover:bg-gray-300 transition-colors flex items-center",children:[e.jsx("span",{className:"material-icons align-middle mr-1 text-sm",children:"home"}),"Home"]})}),e.jsxs("button",{onClick:()=>c(),className:"px-4 py-2 rounded-md bg-blue-100 text-blue-700 hover:bg-blue-200 transition-colors flex items-center",children:[e.jsx("span",{className:"material-icons align-middle mr-1 text-sm",children:"refresh"}),"Refresh"]})]})]}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow-sm mb-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"font-medium text-gray-700",children:"Time Period"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>i(24),className:`px-3 py-1 rounded-md ${s===24?"bg-blue-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"24 hours"}),e.jsx("button",{onClick:()=>i(48),className:`px-3 py-1 rounded-md ${s===48?"bg-blue-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"48 hours"}),e.jsx("button",{onClick:()=>i(72),className:`px-3 py-1 rounded-md ${s===72?"bg-blue-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"72 hours"})]})]}),e.jsxs("div",{className:"space-y-2 md:w-1/3",children:[e.jsx("h3",{className:"font-medium text-gray-700",children:"Filter by Room"}),e.jsx("input",{type:"text",placeholder:"Enter room number...",value:a,onChange:t=>x(t.target.value),className:"w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})})]}),e.jsx("main",{children:h?e.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm flex justify-center items-center h-64",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500 mb-4"}),e.jsx("p",{className:"text-gray-500",children:"Loading call history..."})]})}):u?e.jsx("div",{className:"bg-red-50 p-6 rounded-lg shadow-sm flex justify-center items-center h-64",children:e.jsxs("div",{className:"flex flex-col items-center text-center",children:[e.jsx("span",{className:"material-icons text-red-500 text-4xl mb-3",children:"error_outline"}),e.jsx("p",{className:"text-red-700 mb-2",children:"Unable to load call history"}),e.jsx("p",{className:"text-red-500 text-sm",children:"Please try again later or contact administrator."}),e.jsx("button",{onClick:()=>c(),className:"mt-4 px-4 py-2 bg-red-100 text-red-700 rounded-md hover:bg-red-200 transition-colors",children:"Try Again"})]})}):l!=null&&l.length?e.jsx("div",{className:"bg-white p-4 rounded-lg shadow overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50",children:[e.jsx("th",{className:"p-3 text-left text-sm font-medium text-gray-500",children:"Time"}),e.jsx("th",{className:"p-3 text-left text-sm font-medium text-gray-500",children:"Room"}),e.jsx("th",{className:"p-3 text-left text-sm font-medium text-gray-500",children:"Duration"}),e.jsx("th",{className:"p-3 text-left text-sm font-medium text-gray-500",children:"Summary"}),e.jsx("th",{className:"p-3 text-center text-sm font-medium text-gray-500",children:"Actions"})]})}),e.jsx("tbody",{children:l.map(t=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"p-3 text-sm text-gray-700",children:g(t.timestamp)}),e.jsx("td",{className:"p-3 text-sm text-gray-700",children:t.roomNumber||"Unknown"}),e.jsx("td",{className:"p-3 text-sm text-gray-700",children:b(t.duration)}),e.jsx("td",{className:"p-3 text-sm text-gray-700 max-w-md",children:e.jsx("div",{className:"truncate",children:t.content})}),e.jsx("td",{className:"p-3 text-center",children:e.jsx(m,{to:`/call-details/${t.callId}`,children:e.jsxs("button",{className:"inline-flex items-center px-2 py-1 bg-blue-100 text-blue-700 rounded-md hover:bg-blue-200 text-xs",children:[e.jsx("span",{className:"material-icons text-sm mr-1",children:"visibility"}),"View Details"]})})})]},t.id))})]})})}):e.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm flex justify-center items-center h-64",children:e.jsxs("div",{className:"flex flex-col items-center text-center",children:[e.jsx("span",{className:"material-icons text-gray-400 text-4xl mb-3",children:"history"}),e.jsx("p",{className:"text-gray-500 mb-2",children:"No calls found"}),e.jsx("p",{className:"text-gray-400 text-sm",children:a?`No calls from room "${a}" in the last ${s} hours.`:`No calls found in the last ${s} hours.`})]})})}),e.jsx("div",{className:"mt-6 text-center text-gray-500 text-sm",children:e.jsxs("p",{children:["Showing call history from the last ",s," hours â€¢ Total: ",(r==null?void 0:r.count)||0," calls"]})})]})};export{S as default};
