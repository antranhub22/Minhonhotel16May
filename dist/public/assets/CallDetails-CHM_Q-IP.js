import{r as N,j as e}from"./react-BlJs-Rj_.js";import{u as d}from"./@tanstack-H40tjzcj.js";import{u as b,L as o}from"./wouter-DSgBA37d.js";import"./@daily-co-CRt2XSsO.js";import"./regexparam-CPXopyEH.js";import"./use-sync-external-store-T8uco2Ip.js";const D=()=>{const{callId:l}=b(),[r,n]=N.useState(!1),{data:t,isLoading:m,isError:x}=d({queryKey:["summary",l],queryFn:async()=>{const s=await fetch(`/api/summaries/${l}`);if(!s.ok)throw new Error("Failed to fetch call summary");return s.json()}}),{data:a,isLoading:h,isError:g}=d({queryKey:["transcripts",l],queryFn:async()=>{const s=await fetch(`/api/transcripts/${l}`);if(!s.ok)throw new Error("Failed to fetch call transcripts");return s.json()}}),i=s=>s?(s instanceof Date?s:new Date(s)).toLocaleString("en-US",{year:"numeric",month:"numeric",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"}):"Unknown",u=s=>s||"00:00",p=async()=>{if(a!=null&&a.length)try{n(!0);const s=a.map(c=>`${c.role==="assistant"?"Assistant":"Guest"}: ${c.content}`).join(`

`);await navigator.clipboard.writeText(s),setTimeout(()=>{n(!1)},1500)}catch(s){console.error("Could not copy text: ",s),n(!1)}},j=m||h,y=x||g;return e.jsxs("div",{className:"container mx-auto p-5",children:[e.jsx("header",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h1",{className:"text-3xl font-bold text-primary",children:"Call Details"}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx(o,{to:"/call-history",children:e.jsxs("button",{className:"px-4 py-2 rounded-md bg-gray-200 text-gray-700 hover:bg-gray-300 transition-colors flex items-center",children:[e.jsx("span",{className:"material-icons align-middle mr-1 text-sm",children:"history"}),"Call History"]})}),e.jsx(o,{to:"/",children:e.jsxs("button",{className:"px-4 py-2 rounded-md bg-gray-200 text-gray-700 hover:bg-gray-300 transition-colors flex items-center",children:[e.jsx("span",{className:"material-icons align-middle mr-1 text-sm",children:"home"}),"Home"]})})]})]})}),e.jsx("main",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:j?e.jsx("div",{className:"col-span-1 lg:col-span-3 bg-white p-6 rounded-lg shadow-sm flex justify-center items-center h-64",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500 mb-4"}),e.jsx("p",{className:"text-gray-500",children:"Loading call details..."})]})}):y?e.jsx("div",{className:"col-span-1 lg:col-span-3 bg-red-50 p-6 rounded-lg shadow-sm flex justify-center items-center h-64",children:e.jsxs("div",{className:"flex flex-col items-center text-center",children:[e.jsx("span",{className:"material-icons text-red-500 text-4xl mb-3",children:"error_outline"}),e.jsx("p",{className:"text-red-700 mb-2",children:"Unable to load call details"}),e.jsx("p",{className:"text-red-500 text-sm",children:"The call may not exist or has been deleted."}),e.jsx(o,{to:"/call-history",children:e.jsx("button",{className:"mt-4 px-4 py-2 bg-red-100 text-red-700 rounded-md hover:bg-red-200 transition-colors",children:"Return to Call History"})})]})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"col-span-1 lg:col-span-3",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"Call Information"}),e.jsxs("div",{className:"bg-blue-100 px-3 py-1 rounded-full text-blue-700 text-xs font-medium",children:["ID: ",l]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Time"}),e.jsx("p",{className:"text-sm font-medium",children:i(t==null?void 0:t.timestamp)})]}),e.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Room"}),e.jsx("p",{className:"text-sm font-medium",children:(t==null?void 0:t.roomNumber)||"Unknown"})]}),e.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Duration"}),e.jsx("p",{className:"text-sm font-medium",children:u(t==null?void 0:t.duration)})]}),e.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Messages"}),e.jsx("p",{className:"text-sm font-medium",children:(a==null?void 0:a.length)||0})]})]})]})}),e.jsx("div",{className:"col-span-1 lg:col-span-2",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm h-full",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"Conversation History"}),e.jsxs("button",{onClick:p,disabled:r||!(a!=null&&a.length),className:`px-3 py-1 rounded-md text-sm flex items-center ${r?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[e.jsx("span",{className:"material-icons text-sm mr-1",children:r?"check":"content_copy"}),r?"Copied":"Copy"]})]}),a!=null&&a.length?e.jsx("div",{className:"space-y-4 overflow-y-auto max-h-[500px] pr-2",children:a.map(s=>e.jsx("div",{className:`flex ${s.role==="assistant"?"justify-start":"justify-end"}`,children:e.jsxs("div",{className:`max-w-[75%] p-3 rounded-lg relative ${s.role==="assistant"?"bg-blue-50 text-blue-900":"bg-gray-100 text-gray-900"}`,children:[e.jsxs("div",{className:"text-xs text-gray-500 mb-1",children:[s.role==="assistant"?"Assistant":"Guest"," â€¢ ",i(s.timestamp)]}),e.jsx("p",{className:"text-sm",children:s.content})]})},s.id))}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-center",children:[e.jsx("span",{className:"material-icons text-gray-300 text-4xl mb-2",children:"chat"}),e.jsx("p",{className:"text-gray-500",children:"No conversation data"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Conversation details may have been deleted or not recorded."})]})]})}),e.jsx("div",{className:"col-span-1",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm h-full",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:"Call Summary"}),t!=null&&t.content?e.jsxs("div",{className:"p-4 bg-blue-50 rounded-lg overflow-y-auto",style:{maxHeight:"500px"},children:[e.jsx("div",{className:"text-sm text-blue-900 whitespace-pre-line",children:t.content}),e.jsx("div",{className:"mt-3 text-right",children:e.jsxs("span",{className:"text-xs text-gray-500",children:["Generated at ",i(t.timestamp)]})})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-center",children:[e.jsx("span",{className:"material-icons text-gray-300 text-4xl mb-2",children:"summarize"}),e.jsx("p",{className:"text-gray-500",children:"No summary available"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Call summary could not be generated."})]})]})})]})}),e.jsx("div",{className:"mt-6 text-center text-gray-500 text-sm",children:e.jsx("p",{children:"Call history is stored for the last 24 hours"})})]})};export{D as default};
